/*!
 * EasyData.JS CRUD
 * Copyright 2024 Korzh.com
 * Licensed under MIT
 !*/
var easydata=function(t){"use strict";
/*!
	 * EasyData.JS Core
	 * Copyright 2023 Korzh.com
	 * Licensed under MIT
	 !*/var e,i;!function(t){t[t.Unknown=0]="Unknown",t[t.String=1]="String",t[t.Byte=2]="Byte",t[t.Word=3]="Word",t[t.Int32=4]="Int32",t[t.Int64=5]="Int64",t[t.Bool=6]="Bool",t[t.Float=7]="Float",t[t.Currency=8]="Currency",t[t.BCD=9]="BCD",t[t.Date=10]="Date",t[t.Time=11]="Time",t[t.DateTime=12]="DateTime",t[t.Autoinc=13]="Autoinc",t[t.Memo=14]="Memo",t[t.Blob=15]="Blob",t[t.FixedChar=16]="FixedChar",t[t.Guid=17]="Guid",t[t.Geometry=18]="Geometry",t[t.Geography=19]="Geography"}(e||(e={})),function(t){t[t.Data=0]="Data",t[t.Virtual=1]="Virtual",t[t.Lookup=2]="Lookup"}(i||(i={}));const s={Unknown:"Unknown",Edit:"EDIT",DateTime:"DATETIME",List:"LIST",CustomList:"CUSTOMLIST",File:"FILE"};let n=class{getDateByName(t,e){return this[t]?this[t](e):void 0}Today(t){return new Date}Yesterday(t){let e=new Date;return e.setDate(e.getDate()-1),e}Tomorrow(t){let e=new Date;return e.setDate(e.getDate()+1),e}FirstDayOfMonth(t){let e=new Date;return e.setDate(1),e}LastDayOfMonth(t){let e=new Date;return e.setMonth(e.getMonth()+1,0),e}FirstDayOfNextMonth(t){let e=new Date;return e.setMonth(e.getMonth()+1,1),e}FirstDayOfPrevMonth(t){let e=new Date;return e.setMonth(e.getMonth()-1,1),e}FirstDayOfYear(t){const e=new Date;return e.setMonth(0,1),e}FirstDayOfPrevYear(t){let e=new Date;return e.setFullYear(e.getFullYear()-1,0,1),e}FirstDayOfNextYear(t){let e=new Date;return e.setFullYear(e.getFullYear()+1,0,1),e}FirstDayOfWeek(t){const e=new Date;let i=e.getDay();return i=0==i?6:i-1,e.setDate(e.getDate()-i),e}FirstDayOfPrevWeek(t){let e=new Date,i=e.getDay();return i=0==i?1:8-i,e.setDate(e.getDate()-i),e}FirstDayOfNextWeek(t){let e=new Date;var i=e.getDay();return i=0==i?1:8-i,e.setDate(e.getDate()+i),e}};var a,o,r,l,h,d=new n;!function(t){t.Trace="TRACE",t.Options="OPTIONS",t.Get="GET",t.Put="PUT",t.Post="POST",t.Delete="DELETE"}(a||(a={}));let c=class{constructor(t,e){this.xhr=t,this.method=e.method,this.url=e.url,this.headers=e.headers,this.queryParams=e.queryParams,this.data=e.data}setHeader(t,e){this.headers[t]=e}setQueryParam(t,e){this.queryParams[t]=e}getXMLHttpRequest(){return this.xhr}getResponseHeaders(){if(this.xhr.readyState==this.xhr.HEADERS_RECEIVED){const t=this.xhr.getAllResponseHeaders().trim().split(/[\r\n]+/),e={};for(const i of t){const t=i.split(": "),s=t.shift(),n=t.join(": ");e[s]=n}return e}return{}}open(){if(this.xhr.readyState!==this.xhr.UNSENT)return;let t=this.url;this.queryParams&&Object.keys(this.queryParams).length>0&&(t+=encodeURI("?"+Object.keys(this.queryParams).map((t=>t+"="+this.queryParams[t])).join("&"))),this.xhr.open(this.method,t,!0),this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");for(const t in this.headers)this.xhr.setRequestHeader(t,this.headers[t])}abort(){this.xhr.abort()}};!function(t){t.getAllDataTypes=function(){return Object.values(e).filter((t=>"number"==typeof t))},t.getDateDataTypes=function(){return[e.Time,e.Date,e.DateTime]},t.getStringDataTypes=function(){return[e.String,e.Memo,e.FixedChar]};const i=[e.Byte,e.Word,e.Int32,e.Int64,e.Float,e.Currency,e.Autoinc];t.getNumericDataTypes=function(){return i};const s=[e.Byte,e.Word,e.Int32,e.Int64,e.Autoinc];function n(t,e,i){e||(e={});for(let s of i)if(s)for(let i in s)if(s.hasOwnProperty(i)){let o=s[i];null!==o&&"object"==typeof o?t.has(o)?e[i]=t.get(o):Array.isArray(o)?(e[i]=a(o),t.set(o,e[i])):(void 0!==e[i]&&null!=e[i]||(e[i]=Object.create(Object.getPrototypeOf(o))),t.set(o,e[i]),n(t,e[i],[o])):e[i]=o}return e}function a(t){let e=[];for(let i of t)e.push(i);return e}t.assign=function(t,...e){for(let i=0;i<e.length;i++){let s=e[i];if(s)for(let e in s)s.hasOwnProperty(e)&&(t[e]=s[e])}return t},t.assignDeep=function(t,...e){return n(new WeakMap,t,e)},t.getIfDefined=function(t,e){return void 0!==t?t:e},t.IsDefinedAndNotNull=function(t){return null!=t},t.copyArrayTo=function(t,e){const i=t.length,s=e.length;for(let n=0;n<i&&n<s;n++)e[n]=t[n]},t.createArrayFrom=a,t.findItemById=function(t,e){for(var i=t.length,s=0;s<i;s++)if(t[s].id===e)return t[s];return null},t.findItemIndexById=function(t,e){for(var i=t.length,s=0;s<i;s++)if(t[s].id===e)return s;return-1},t.indexOfArrayItem=function(t,e){if(t.indexOf)return t.indexOf(e);{let i=t.length;for(let s=0;s<i;s++)if(e==t[s])return s;return-1}},t.moveArrayItem=function(t,e,i){if(e>=t.length)throw"Index out of bounds: "+e;i>=t.length&&(i=t.length-1);let s=t.splice(e,1)[0];t.splice(i,0,s)},t.removeArrayItem=function(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1)[0]},t.insertArrayItem=function(t,e,i){t.splice(e,0,i)},t.fillArray=function(t,e,i=0,s){let n=t.length>>>0;var a=i>>0,o=a<0?Math.max(n+a,0):Math.min(a,n),r=void 0===s?n:s>>0;let l=r<0?Math.max(n+r,0):Math.min(r,n);for(;o<l;)t[o]=e,o++;return t},t.shiftToFitWindow=function(t,e){let i=document.getElementsByTagName("body")[0],s=window.innerWidth||document.documentElement.clientWidth||i.clientWidth;var n=t+e;let a=0;return n>s&&(a=s-n-10,t+a<0&&(a=10-t)),a},t.isObject=function(t){return null!==t&&("function"==typeof t||"object"==typeof t)},t.isNumericType=function(t){return i.indexOf(t)>=0},t.isIntType=function(t){return s.indexOf(t)>=0},t.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},t.areCompatibleDataTypes=function(t,i){return void 0===t||void 0===i||t==e.Unknown||i==e.Unknown||t==i||t==e.Date&&i==e.DateTime||t==e.DateTime&&i==e.Date},t.isPropSet=function(t,e){return t[e]||t[e.toLowerCase()]||t[e.toUpperCase()]};const o="0123456789abcdefghijklmnopqrstuvwxyz";function r(t,e){const i=t.length;if(i>e){let s=i/e,n="";n+=t[0];let a,o=s;for(let e=1;e<i;e++)a=t[e],e+1>o&&(n+=a,o+=s);return n}return t}function l(t,e){return Math.floor(Math.random()*(e-t))+t}function h(t){const e=parseInt(t);if(isNaN(e))throw`"${t}" is not a valid number`;return e}t.generateId=function(t){t||(t="easy");let e=t.length>4?function(t,e){let i=t.split("-"),s=1,n=4;i.length<4&&(s=4/i.length,n=i.length);let a="";for(let t=0;t<n;t++)a+=r(i[t],s);return a}(t):t;e&&e.length>0&&(e+="-");var i=o[l(0,36)]+o[l(0,36)]+o[l(0,36)],s=l(0,1e4);return e+i+function(t,e=36){var i="",s=t;do{i=o[s%e]+i,s=Math.floor(s/=e)}while(s>0);return i}(621355968e9+1e4*(new Date).getTime()-0x8d60e562e627800-s)},t.strToDateTime=function(t,e){if(!t||0==t.length)return new Date;const i=t.replace(/[^a-zA-Z0-9_]/g,"-"),s=e.replace(/[^a-zA-Z0-9_]/g,"-").split("-"),n=i.split("-"),a=s.indexOf("MM"),o=s.indexOf("dd"),r=s.indexOf("yyyy"),l=s.indexOf("HH"),d=s.indexOf("mm"),c=s.indexOf("ss"),u=new Date;try{const t=r>-1&&r<n.length?h(n[r]):u.getFullYear(),e=a>-1&&a<n.length?h(n[a])-1:u.getMonth()-1;if(e>11)throw"";const i=o>-1&&o<n.length?h(n[o]):u.getDate();if(i>function(t,e){return new Date(e,t+1,0).getDate()}(e,t))throw"";const s=l>-1&&l<n.length?h(n[l]):0;if(s>23)throw"";const g=d>-1&&d<n.length?h(n[d]):0;if(g>59)throw"";const p=c>-1&&c<n.length?h(n[c]):0;if(p>59)throw"";return new Date(t,e,i,s,g,p)}catch(e){throw`${t} is not a valid date.`}},t.strToTime=function(t){const e=t.split(":");try{const t=e.length>0?h(e[0]):0;if(t>23)throw"";const i=e.length>1?h(e[1]):0;if(i>59)throw"";const s=e.length>1?h(e[1]):0;if(s>59)throw"";return new Date(0,0,0,t,i,s)}catch(e){throw`${t} is not a valid time.`}}}(o||(o={}));let u=class{constructor(t,e){this.request=t,this.promise=e}getPromise(){return this.promise}getRequest(){return this.request}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}},g=class extends Error{constructor(t,e){super(e),this.status=t}};!function(t){let i,s={shortDateFormat:"MM/dd/yyyy",longDateFormat:"dd MMM, yyyy",editDateFormat:"MM/dd/yyyy",shortTimeFormat:"HH:mm",editTimeFormat:"HH:mm",longTimeFormat:"HH:mm:ss",shortMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longMonthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],shortWeekDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longWeekDayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],decimalSeparator:".",currency:"USD"},n={localeId:"en-US",englishName:"English",displayName:"English",texts:{ButtonOK:"OK",ButtonCancel:"Cancel",Yes:"Yes",No:"No",True:"True",False:"False"},settings:s},a={"en-US":n};const r=[];function l(t){for(const e of r)e(t)}function h(){return i.localeId}function d(t){const e=a[t];e?o.assignDeep(i,e):(i.englishName=t,i.displayName=t,i.texts=o.assignDeep({},n.texts)),i.localeId=t}function c(){return i.settings}function u(t){i.settings||(i.settings=o.assignDeep({},s)),i.settings=o.assignDeep(i.settings,t)}function g(t,e){l(e);let s=i;t&&(e.localeId||(e.localeId=t),s=a[t],s||(s=o.assignDeep({},n),a[t]=s)),o.assignDeep(s,e)}t.addMapper=function(t){r.push(t)},t.getLocales=function(){let t=[];for(let e in a)t.push({locale:e,englishName:a[e].englishName,displayName:a[e].displayName});return t.sort(((t,e)=>t.englishName>e.englishName?1:t.englishName===e.englishName?0:-1))},t.getCurrentLocale=h,t.setLocale=function(t){console.warn("This method is deprecated. Use setCurrentLocale instead"),d(t)},t.setCurrentLocale=d,t.getText=function(...t){let e=i.texts,s="";if(t&&t.length){const i=t.length;for(let n=0;n<i&&(s=e[t[n]],"object"==typeof s);n++)e=s}return s},t.getLocaleSettings=c,t.getOneLocaleSetting=function(t){return i.settings[t]},t.getShortMonthName=function(t){const e=c();if(t>0&&t<13)return e.shortMonthNames[t-1];throw"Wrong month number: "+t},t.getLongMonthName=function(t){const e=c();if(t>0&&t<13)return e.longMonthNames[t-1];throw"Wrong month number: "+t},t.getShortWeekDayName=function(t){const e=c();if(t>0&&t<8)return e.shortWeekDayNames.length>=t?e.shortWeekDayNames[t-1]:t.toString();throw"Wrong month number: "+t},t.getLongWeekDayName=function(t){const e=c();if(t>0&&t<8)return e.longWeekDayNames.length>=t?e.longWeekDayNames[t-1]:t.toString();throw"Wrong month number: "+t},t.updateLocaleSettings=u,t.updateLocaleTexts=function(t){"object"==typeof t?(l({localeId:i.localeId,texts:t}),o.assignDeep(i.texts,t)):console.error("Wrong parameter type in updateLocaleTexts function call.The first parameter (localeId) is not necessary. Use updateLocaleTexts(texts) instead")},t.updateDefaultTexts=function(t){for(let e in a){let i=a[e];i.texts=o.assignDeep({},t,i.texts)}i.texts=o.assignDeep({},t,i.texts)},t.updateLocaleInfo=g,t.addLocale=function(t,e){g(t,e)},t.resetLocales=function(){i||(i=o.assignDeep({},n),function(t){const e=new Date(2020,5,7,19,34,56,88),s=e.toLocaleDateString(t,{year:"numeric",month:"numeric",day:"numeric"}),n=e.toLocaleTimeString(t,{hour:"numeric",minute:"numeric",second:"numeric"});let a=s.replace("07","dd").replace("7","d").replace("06","MM").replace("6","M").replace("2020","yyyy").replace("20","yy"),o=n.replace("19","HH").replace("07","hh").replace("7","h").replace("34","mm").replace("56","ss").replace("PM","tt");i.settings||(i.settings={}),u({shortDateFormat:a,shortTimeFormat:o})}("object"==typeof navigator?navigator.language:void 0))};const p=/\[([^\]]+)]|y{2,4}|M{1,4}|d{1,2}|H{1,2}|h{1,2}|m{2}|s{2}|t{2}/g;function m(e,i){const s=e.getFullYear().toString(),n=e.getMonth()+1,a=e.getDate(),o=e.getHours(),r=e.getMinutes(),l=e.getSeconds(),h=o%12||12,d=o>11,c={yyyy:s,yy:s.substring(s.length-2),MMMM:t.getLongMonthName(n),MMM:t.getShortMonthName(n),MM:n<10?"0"+n:n.toString(),M:n.toString(),dd:a<10?"0"+a:a.toString(),d:a.toString(),HH:o<10?"0"+o:o.toString(),H:o.toString(),hh:h<10?"0"+h:h.toString(),h:h.toString(),tt:d?"PM":"AM",mm:r<10?"0"+r:r.toString(),ss:l<10?"0"+l:l.toString()};return i.replace(p,((t,e)=>e||c[t]))}function f(t){const i=c();let s;switch(t){case e.Date:s=i.shortDateFormat;break;case e.Time:s=i.shortTimeFormat;break;default:s=i.shortDateFormat+" "+i.shortTimeFormat}return s}function y(t){const i=c();let s;switch(t){case e.Date:s=i.longDateFormat;break;case e.Time:s=i.longTimeFormat;break;default:s=i.longDateFormat+" "+i.longTimeFormat}return s}t.dateTimeToStr=m,t.dateTimeToStrEx=function(t,i,s){return s?"d"==s?s=f(e.Date):"D"==s?s=y(e.Date):"f"==s?s=f(e.DateTime):"F"==s&&(s=y(e.DateTime)):s=f(i),m(t,s)},t.numberToStr=function(e,i,s){if(i&&i.length>0){const s=i.charAt(0).toUpperCase();if("S"===s)return function(e,i){if(!D[i]){const t=i.split("|").filter((t=>t.length>0)).map((t=>t.split("=")));if(D[i]={},t.length>0)if(t[0].length>1)for(const e of t)D[i][Number.parseInt(e[1])]=e[0];else t.forEach(((t,e)=>{D[i][e]=t[0]}))}const s=D[i];if(void 0!==s[e]){const i=s[e];return t.getText(i)||i}return e.toString()}(e,i.slice(1));if(["D","F","C"].indexOf(s)>=0){const t=h();return e.toLocaleString(t,function(t){const e=c(),i=t[0].toUpperCase(),s=t.length>1?Number.parseInt(t.slice(1)):"D"==i?1:2;switch(i){case"D":return{style:"decimal",useGrouping:!1,minimumIntegerDigits:s};case"C":return{style:"currency",currency:e.currency,minimumFractionDigits:s};default:return{style:"decimal",minimumFractionDigits:s,maximumFractionDigits:s}}}(i))}return function(t,e){let i=t.toString(),s="",n=i.length-1;for(let t=e.length-1;t>=0;t--){const a=e.charAt(t);"#"===a||"0"===a?n>=0?(s+=i.charAt(n),n--):"0"===a&&(s+=0):s+=a}return s.split("").reverse().join("")}(Math.trunc(e),i)}const n=c();return s=s||n.decimalSeparator,e.toString().replace(".",s)},t.booleanToStr=function(e,i){if(i&&i.length>0&&"S"===i.charAt(0).toUpperCase()){const s=i.slice(1).split("|");if(s.length>1){const i=s[e?1:0];return t.getText(i)||i}}return`${e}`};const D={}}(r||(r={}));let p=class{constructor(t){this.isEditable=!0,this.name="",this.caption="",this.description="",this.parent=t,this.attributes=new Array,this.subEntities=new Array}loadFromData(t,e){if(e){if(this.id=e.id,this.name=e.name,this.captionPlural=e.namePlur,this.caption=e.name,this.description=e.desc,void 0!==e.ied&&(this.isEditable=e.ied),this.subEntities=new Array,e.ents)for(let i=0;i<e.ents.length;i++){let s=t.createEntity(this);s.loadFromData(t,e.ents[i]),this.subEntities.push(s)}if(this.attributes=new Array,e.attrs)for(let i=0;i<e.attrs.length;i++){let s=t.createEntityAttr(this);s.loadFromData(t,e.attrs[i]),this.attributes.push(s)}}}scan(t,e){let i={stop:!1},s=n=>{if(e&&e(n,i),n.attributes){let e=n.attributes.length;for(let s=0;s<e&&!i.stop;s++){let e=n.attributes[s];if(t&&t(e,i),i.stop)return}}if(n.subEntities){let t=n.subEntities.length;for(let e=0;e<t&&!i.stop;e++)s(n.subEntities[e])}};s(this)}getFirstPrimaryAttr(){return this.getPrimaryAttrs()[0]}getPrimaryAttrs(){return this.attributes.filter((t=>t.isPrimaryKey))}},m=class{constructor(t){this.id="",this.caption="{Unrecognized attribute}",this.dataType=e.String,this.size=0,this.isPrimaryKey=!1,this.isForeignKey=!1,this.isNullable=!0,this.showOnView=!0,this.isEditable=!0,this.showOnCreate=!0,this.showOnEdit=!0,this.showInLookup=!1,this.lookupAttr="",this.expr="",this.entity=t,this.kind=i.Data}loadFromData(t,e){if(e){this.id=e.id,this.description=e.desc,this.caption=e.cptn,this.dataType=e.dtype,this.isPrimaryKey=e.ipk,this.isForeignKey=e.ifk,this.size=e.size,this.lookupAttr=e.lattr,this.lookupEntity=e.lent,this.dataAttr=e.dattr,this.lookupDataAttr=e.ldattr;const i=o.getDateDataTypes().indexOf(this.dataType);this.defaultValue=e.defVal&&i?new Date(e.defVal):e.defVal,this.isNullable=o.getIfDefined(e.nul,this.isNullable),this.isEditable=o.getIfDefined(e.ied,this.isEditable),this.showOnView=o.getIfDefined(e.ivis||e.sov,this.showOnView),this.showOnCreate=o.getIfDefined(e.soc,this.showOnCreate),this.showOnEdit=o.getIfDefined(e.soe,this.showOnEdit),this.showInLookup=o.getIfDefined(e.sil,this.showInLookup),this.kind=e.kind,this.displayFormat=e.dfmt,e.udata&&(this.userData=e.udata),e.edtr&&(this.defaultEditor=t.getEditorById(e.edtr)||t.createValueEditor())}}},f=class{constructor(){this.id="",this.tag=s.Unknown,this.resType=e.Unknown,this.defValue=""}loadFromData(t){t&&(this.id=t.id,this.tag=t.tag,this.defValue=t.defval,this.resType=t.rtype,this.accept=t.accept,this.multiline=t.multiline,t.subType&&(this.resType=t.subType),t.name&&(this.name=t.name),t.values&&(this.values=t.values))}getValueText(t){let e="";if(!this.values)return e;if(Array.isArray(t))for(let i of this.values)t.indexOf(i.id)>=0&&(e+=i.text+",");else for(let i of this.values)i.id===t&&(e+=i.text+",");return e&&(e=e.substring(0,e.length-1)),e}};!function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Center=2]="Center",t[t.Right=3]="Right"}(l||(l={}));let y=class{constructor(t){if(!t)throw Error("Options are required");if(!t.id)throw Error("Field Id is required");if(!t.label)throw Error("Label is required");this.id=t.id,this.type=o.getIfDefined(t.type,e.String),this.label=t.label,this.originAttrId=t.originAttrId,this.isAggr=t.isAggr||!1,this.displayFormat=t.dfmt,this.groupFooterColumnTemplate=t.gfct,this.style=t.style||{},this.description=t.description,this.calculatedWidth=0}},D=class{constructor(){this.items=[],this.mapper={},this._dateColumnIdx=[]}get count(){return this.items.length}add(t){let i;i=t instanceof y?t:new y(t);const s=this.items.length;return this.items.push(i),this.mapper[i.id]=s,[e.Date,e.DateTime,e.Time].indexOf(i.type)>=0&&this._dateColumnIdx.push(s),s}updateDateColumnIdx(){this._dateColumnIdx=this.getItems().filter((t=>[e.Date,e.DateTime,e.Time].indexOf(t.type)>=0)).map(((t,e)=>e))}put(t,e){t>=0&&t<this.count&&(this.items[t]=e,this.updateDateColumnIdx())}move(t,e){let i=this.items.indexOf(t);i>=0&&i!=e&&(o.moveArrayItem(this.items,i,e),this.updateDateColumnIdx())}get(t){return t>=0&&t<this.count?this.items[t]:null}getIndex(t){return this.mapper[t]}getItems(){return this.items}getDateColumnIndexes(){return this._dateColumnIdx}removeAt(t){const e=this.get(t);this.items.splice(t,1);const i=this._dateColumnIdx.indexOf(t);i>=0&&this._dateColumnIdx.splice(i,1),delete this.mapper[e.id]}clear(){this.items=[],this._dateColumnIdx=[],this.mapper={}}},w=class{constructor(t,e){this.columns=t,this.values=e}toArray(){return Array.from(this.values)}size(){return this.values.length}getValue(t){let e;if("string"==typeof t){if(e=this.columns.getIndex(t),void 0===e)throw new RangeError(`No column with id '${t}'`)}else e=t;if(e>=this.values.length)throw new RangeError("Out of range: "+e);return this.values[e]}setValue(t,e){let i;if("string"==typeof t){if(i=this.columns.getIndex(t),void 0===i)throw new RangeError(`No column with id '${t}'`)}else i=t;if(i>=this.values.length)throw new RangeError("Out of range: "+i);this.values[i]=e}},v=class{static newGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}};!function(t){t.renderLiquidTemplate=function(t,e){let i=t;if(e)for(let t in e){const s=new RegExp("{{"+t+"}}","g");i=i.replace(s,e[t])}return i}}(h||(h={})),r.resetLocales(),"function"!=typeof Object.values&&(Object.values=function(t){return Object.keys(t).map((e=>t[e]))}),"function"!=typeof Math.trunc&&(Math.trunc=function(t){return isNaN(t)?NaN:t>0?Math.floor(t):Math.ceil(t)});var C,T,b,E,x,I,S,M,R=Object.freeze({__proto__:null,AggregationSettings:class{constructor(t){this.colStore=t,this.aggregates=[],this.groups=[],this.useGrandTotals=!1,this.useRecordCount=!1,this._caseSensitiveGroups=!1,this.COUNT_FIELD_NAME="GRPRECCNT"}get caseSensitiveGroups(){return this._caseSensitiveGroups}set caseSensitiveGroups(t){this._caseSensitiveGroups=t,this.updateCompareProc()}updateCompareProc(){this.compareValues=this._caseSensitiveGroups?this.strictCompare:this.caseInsensitiveCompare}addGroup(t){const e=t.columns||this.colStore.getColumnIds(t.from,t.to);if(!this.colStore.validateColumns(e))throw"Invalid columns: "+e;if(this.hasColumnsInUse(e))throw"Can't add same columns to different groups/aggregates";return this.groups.push(Object.assign({columns:e},t)),this}addAggregateColumn(t,e){const i="string"==typeof t?t:this.colStore.getColumnIds(t,t)[0];if(this.hasColumnsInUse([i])||!this.colStore.validateAggregate(i,e))throw"Invalid aggregation function for the column: "+i;return this.aggregates.push({colId:i,funcId:e}),this}addGrandTotals(){return this.useGrandTotals=!0,this}addCounts(){return this.useRecordCount=!0,this}getGroups(){let t=[];return this.groups.map((e=>(t=t.concat(e.columns),Object.assign(Object.assign({},e),{columns:Array.from(t),aggregates:Array.from(this.aggregates)}))))}getInternalGroups(){return this.groups}lastGroup(){const t=this.getGroups();return t[t.length-1]}getAggregates(){return this.aggregates}hasAggregates(){return this.aggregates.length>0}hasGroups(){return this.groups.length>0}hasGrandTotals(){return this.useGrandTotals}hasRecordCount(){return this.useRecordCount}isEmpty(){return!(this.hasAggregates()||this.hasGroups()||this.hasAggregates()||this.hasRecordCount())}drop(){console.warn('"drop()" method is obsolete. Use "clear()" instead'),this.clear()}clear(){return this.groups=[],this.aggregates=[],this.useGrandTotals=!1,this.useRecordCount=!1,this.caseSensitiveGroups=!1,this}hasColumnsInUse(t){for(const e of this.groups)if(e.columns.filter((e=>t.indexOf(e)>=0)).length>0)return!0;for(const e of this.aggregates)if(t.indexOf(e.colId)>=0)return!0;return!1}needAggrCalculation(){return(this.hasAggregates()||this.hasRecordCount())&&(this.hasGrandTotals()||this.hasGroups())}saveToData(){return{groups:Array.from(this.groups),ugt:this.useGrandTotals,urc:this.useRecordCount,csg:this.caseSensitiveGroups,aggregates:Array.from(this.aggregates)}}loadFromData(t){t&&(void 0!==t.ugt&&(this.useGrandTotals=t.ugt),void 0!==t.urc&&(this.useRecordCount=t.urc),void 0!==t.csg&&(this.caseSensitiveGroups=t.csg),t.groups&&(this.groups=Array.from(t.groups)),t.aggregates&&(this.aggregates=Array.from(t.aggregates)))}buildGroupKey(t,e){const i=!this.caseSensitiveGroups;let s={};if(t)for(const n of t.columns){let t=e.getValue(n);i&&"string"==typeof t&&(t=t.toLowerCase()),s[n]=t}return s}strictCompare(t,e){return t instanceof Date?t.getTime()===e.getTime():t===e}caseInsensitiveCompare(t,e){return t instanceof Date?t.getTime()===e.getTime():("string"==typeof t?t.toLowerCase():t)===("string"==typeof e?e.toLowerCase():e)}},get ColumnAlignment(){return l},DataColumn:y,DataColumnList:D,DataRow:w,get DataType(){return e},EasyDataTable:class{constructor(t){if(this._chunkSize=1e3,this._elasticChunks=!1,this.cachedRows=[],this.total=0,this.loader=null,this.needTotal=!0,this.isInMemory=!1,t=t||{},this._chunkSize=t.chunkSize||this._chunkSize,this._elasticChunks=t.elasticChunks||this._elasticChunks,this.loader=t.loader,void 0!==t.inMemory&&(this.isInMemory=t.inMemory),this.isInMemory&&(this.needTotal=!1),this._columns=new D,this.onUpdate=t.onUpdate,t.columns)for(const e of t.columns)this._columns.add(e);if(t.rows)for(const e of t.rows){const t=this.createRow(e);this.addRow(t)}this.needTotal=!this._elasticChunks}get columns(){return this._columns}get chunkSize(){return this._chunkSize}set chunkSize(t){this._chunkSize=t,this.total=0,this.needTotal=!this.elasticChunks,this.cachedRows=[]}get elasticChunks(){return this._elasticChunks}set elasticChunks(t){this._elasticChunks=t,this.total=0,this.needTotal=!this.elasticChunks,this.cachedRows=[]}getRows(t){let e=0,i=this._chunkSize;t&&("page"in t?(e=t.pageSize*(t.page-1),i=t.pageSize):(e=t.offset,i=t.limit));let s=e+i;if(!this.needTotal&&!this.elasticChunks){if(e>=this.total)return Promise.resolve([]);s>this.total&&(s=this.total)}if(this.isInMemory&&s>this.cachedRows.length&&(s=this.cachedRows.length),s<=this.cachedRows.length)return Promise.resolve(this.cachedRows.slice(e,s));if(!this.loader)throw`Loader is not defined. Can't get the rows from ${e} to ${s}`;const n=this.needTotal;this.needTotal&&(this.needTotal=!1);let a=this.cachedRows.length,o=s-a;return o<this._chunkSize&&(o=this._chunkSize),this.loader.loadChunk({offset:a,limit:o,needTotal:n}).then((t=>(n&&(this.total=t.total),Array.prototype.push.apply(this.cachedRows,t.table.getCachedRows()),s>this.cachedRows.length&&(s=this.cachedRows.length),this.elasticChunks&&t.table.getCachedCount()<o&&(this.total=this.cachedRows.length),this.fireUpdated(),this.cachedRows.slice(e,s))))}getRow(t){return this.getRows({offset:t,limit:1}).then((t=>t.length>0?t[0]:null))}getTotal(){return this.total}setTotal(t){this.total=t,this.needTotal=!1}getCachedCount(){return this.cachedRows.length}clear(){this.columns.clear(),this.cachedRows=[],this.total=0,this.needTotal=!this._elasticChunks,this.fireUpdated()}createRow(t){const e=this._columns.getDateColumnIndexes(),i=new Array(this._columns.count),s=t instanceof w?e=>t.getValue(e):e=>t[e];return t&&this.columns.getItems().forEach((t=>{const n=s(t.id),a=this.columns.getIndex(t.id);i[a]=e.indexOf(a)>=0?this.mapDate(n,t.type):n})),new w(this._columns,i)}mapDate(t,i){if(t){let s=new Date(t);return isNaN(s.getTime())&&i==e.Time&&(s=o.strToTime(t)),s}return null}addRow(t){let e;if(Array.isArray(t)){let i=t;const s=this._columns.getDateColumnIndexes();if(s.length>0)for(const t of s)i[t]&&(i[t]=this.mapDate(i[t],this._columns.get(t).type));e=new w(this._columns,i)}else e=this.createRow(t);this.cachedRows.push(e);const i=this.getCachedCount();return i>this.total&&(this.total=i),e}getCachedRows(){return this.cachedRows}totalIsKnown(){return this.elasticChunks?this.getCachedCount()===this.total:!this.needTotal}fireUpdated(){this.onUpdate&&this.onUpdate(this)}},EasyGuid:v,EditorTag:s,get EntityAttrKind(){return i},EventEmitter:class{constructor(t){this.silentMode=0,this.events=new Array,this.source=t}subscribe(t,e){let i=this.getEventRecByType(t);const s={id:v.newGuid(),callback:e};return i?i.eventCallbacks.push(s):(i={type:t,eventCallbacks:new Array(s)},this.events.push(i)),s.id}unsubscribe(t,e){let i=this.getEventRecByType(t);if(i){let t=-1;for(t=0;t<i.eventCallbacks.length&&i.eventCallbacks[t].id!==e;t++);t>=0&&i.eventCallbacks.splice(t,1)}}fire(t,e,i=0,s=!1){if(this.silentMode&&!s)return;let n=this.getEventRecByType(t);if(n){const s={type:t,source:this.source,data:e};let a=()=>{for(let t of n.eventCallbacks)t.callback(s)};i>0?setTimeout(a,i):a()}}enterSilentMode(){this.silentMode++}exitSilentMode(){this.silentMode&&this.silentMode--}isSilent(){return this.silentMode>0}getEventRecByType(t){for(let e of this.events)if(e.type==t)return e;return null}},HttpClient:class t{get responseBody(){return this._responseBody}constructor(){this.defaultHeaders={},this.customPayload=void 0}get(t,e){return this.send(a.Get,t,null,e)}post(t,e,i){return this.send(a.Post,t,e,i)}put(t,e,i){return this.send(a.Put,t,e,i)}delete(t,e,i){return this.send(a.Delete,t,e,i)}send(e,i,s,n){const a=(n=n||{}).dataType||"json",r=n.contentType||"form-data"!==a?"application/json":null;s&&"form-data"!=a&&this.customPayload&&(s.data=o.assignDeep(s.data||{},this.customPayload));const l=new("onload"in new XMLHttpRequest?XMLHttpRequest:window.XDomainRequest),h={method:e,url:i,headers:Object.assign(Object.assign({},this.defaultHeaders),n.headers||{}),queryParams:n.queryParams||{},data:s};r&&(h.headers["Content-Type"]=r);const d=new c(l,h);this.beforeEachRequest&&(console.warn("HttpClient: 'beforeEachRequest' is deprecated and will be removed in future updates.\n            Use 'onRequest' instead"),this.beforeEachRequest(d)),this.onRequest&&this.onRequest(d);const p=d.data&&"string"!=typeof d.data&&"json"==a?JSON.stringify(d.data):d.data;return d.open(),new u(d,new Promise(((e,s)=>{n.responseType&&(l.responseType=n.responseType),l.onerror=t=>{s(new g(l.status,l.responseText))},l.onreadystatechange=()=>{if(4!=l.readyState)return;const n=l.getResponseHeader("Content-Type")||"",a=l.status;if(0===a)s(new g(a,"Network error or the request was aborted"));else if(a>=200&&a<400){const t="arraybuffer"===l.responseType||"blob"===l.responseType?l.response:0==n.indexOf("application/json")?JSON.parse(l.responseText):l.responseText;this._responseBody=t,this.onResponse&&this.onResponse(l),e(t)}else("arraybuffer"===l.responseType||"blob"===l.responseType?t.decodeArrayBuffer(l.response):Promise.resolve(l.responseText)).then((t=>{const e=0==n.indexOf("application/json")?JSON.parse(t):t;this._responseBody=e;const o=e.message||(404==a?`No such endpoint: ${i}`:e);s(new g(a,o))}))},l.send(p)})))}static decodeArrayBuffer(t){var e=new FileReader;return new Promise((i=>{e.onloadend=function(){e.readyState==FileReader.DONE&&i(e.result)},e.readAsText(new Blob([t]))}))}},get HttpMethod(){return a},HttpRequest:c,HttpResponseError:g,MetaData:class{constructor(){this.mainEntity=null,this.id="__none",this.name="Empty model",this.rootEntity=this.createEntity(),this.displayFormats=new Map}getMainEntity(){return this.mainEntity}createEntity(t){return new p(t)}createEntityAttr(t){return new m(t)}createValueEditor(){return new f}loadFromJSON(t){let e=JSON.parse(t);this.loadFromData(e)}loadFromData(t){if(this.id=t.id,this.name=t.name,this.version=t.vers,this.editors=new Array,t.editors)for(let e=0;e<t.editors.length;e++){let i=this.createValueEditor();i.loadFromData(t.editors[e]),this.editors.push(i)}if(this.rootEntity.loadFromData(this,t.entroot),this.displayFormats=new Map,t.displayFormats)for(const i in t.displayFormats){const s=e[i],n=t.displayFormats[i]||new Array;this.displayFormats.set(s,n)}}getDisplayFormats(){return this.displayFormats}getDisplayFormatsForType(t){return this.displayFormats.has(t)?this.displayFormats.get(t):[]}getDefaultFormat(t){return this.displayFormats.has(t)?this.displayFormats.get(t).filter((t=>t.isdef))[0]:null}setData(t){"string"==typeof t?this.loadFromJSON(t):this.loadFromData(t)}isEmpty(){return 0===this.rootEntity.subEntities.length&&0===this.rootEntity.attributes.length}getId(){return this.id}getName(){return this.name}getRootEntity(){return this.rootEntity}getEditorById(t){for(let e of this.editors)if(e.id===t)return e;return null}getAttributeById(t){return this.getEntityAttrById(this.getRootEntity(),t)||null}checkAttrProperty(t,e){let i=this.getAttributeById(t);if(i){if(void 0===i[e])throw"No such property: "+e;return!!i[e]||!!i.lookupAttr&&(t=i.lookupAttr,i=this.getAttributeById(t),i&&i[e])}return!1}getEntityAttrById(t,e){let i,s;if(t.attributes){let s=t.attributes.length;for(i=0;i<s;i++)if(t.attributes[i].id==e)return t.attributes[i]}if(t.subEntities){let n=t.subEntities.length;for(i=0;i<n;i++)if(s=this.getEntityAttrById(t.subEntities[i],e),s)return s}return null}listByEntityWithFilter(t,e){let i,s=new Array,n=null;if(t.subEntities){let a=t.subEntities.length;for(let l=0;l<a;l++)if(n=t.subEntities[l],!e||e(n,null)){i=r.getText("Entities",n.name),i||(i=n.caption);let t=o.assign(this.createEntity(),{id:n.name,text:i,items:[],isEntity:!0});t.items=this.listByEntityWithFilter(n,e),t.items.length>0&&s.push(t)}}let a=null;if(t.attributes){let n=t.attributes.length;for(let l=0;l<n;l++)if(a=t.attributes[l],!e||e(t,a)){i=r.getText("Attributes",a.id),i||(i=a.caption);let t=o.assign(this.createEntity(),{id:a.id,text:i,dataType:a.dataType});s.push(t)}}return s}listByEntity(t,e,i){e=e||{};let s,n=[],a=[],l=null;if(t.subEntities){let a=t.subEntities.length;for(let h=0;h<a;h++)if(l=t.subEntities[h],!i||i(l,null)){s=r.getText("Entities",l.name)||l.caption;let t=o.assign(this.createEntity(),{id:l.name,text:s,items:[],isEntity:!0,description:l.description}),a=o.assign({},e);a.includeRootData=!1,t.items=this.listByEntity(l,a,i),t.items.length>0&&n.push(t)}}let h=null;if(t.attributes){let e=t.attributes.length;for(let n=0;n<e;n++)h=t.attributes[n],i&&!i(t,h)||(s=r.getText("Attributes",h.id)||h.caption,a.push(o.assign(this.createEntityAttr(t),{id:h.id,text:s,dataType:h.dataType,lookupAttr:h.lookupAttr,description:h.description})))}let d,c=(t,e)=>t.text.toLowerCase()==e.text.toLowerCase()?0:t.text.toLowerCase()>e.text.toLowerCase()?1:-1;return e.sortEntities&&(n.sort(c),a.sort(c)),d=e.attrPlacement&&0!=e.attrPlacement?a.concat(n):n.concat(a),2==e.attrPlacement&&d.sort(c),e.includeRootData?(s=r.getText("Entities",t.name),s||(s=t.caption),{id:t.name,text:s,items:d}):d}clear(){this.rootEntity=this.createEntity(),this.editors=[],this.version=""}addDefaultValueEditors(){let t;t=this.addOrUpdateValueEditor("_DTE",s.Edit,e.String),t.defValue="",this.addOrUpdateValueEditor("_DPDE",s.DateTime,e.DateTime),this.addOrUpdateValueEditor("_DPTE",s.DateTime,e.DateTime)}addOrUpdateValueEditor(t,e,i){let s=o.findItemById(this.editors,t);return s||(s=this.createValueEditor(),s.id=t,this.editors.push(s)),s.tag=e,s.resType=i,s}getEntitiesTree(t,e){return this.listByEntity(this.getRootEntity(),t,e)}getEntitiesTreeWithFilter(t){return this.listByEntityWithFilter(this.getRootEntity(),t)}getFullEntityPathByAttr(t,e){return e=e||" ",this.getEntityPathByAttr(this.getRootEntity(),t,e,!0)}getEntityPathByAttr(t,e,i,s){if(!t)return"";i=i||" ";let n="";if(t.caption&&!s){n=r.getText("Entities",t.caption)||t.caption}if(t.attributes){let i=t.attributes.length;for(let s=0;s<i;s++)if(t.attributes[s].id==e)return n}if(t.subEntities){let s=t.subEntities.length;for(let a=0;a<s;a++){let s=t.subEntities[a],o=this.getEntityPathByAttr(s,e,i,!1);if(""!==o)return""!==n&&(o=n+i+o),o}}return""}getAttributeText(t,e){let i=r.getText("Attributes",t.id);if(i||(i=t.caption),!e)return i;let s="",n=this.getFullEntityPathByAttr(t.id," ");return n?(s=e.replace(new RegExp("{attr}","g"),i),s=s.replace(new RegExp("{entity}","g"),n)):s=i,s.trim()}runThroughEntities(t,e){this.getRootEntity().scan(t,e)}getFirstAttributeByFilter(t){let e=null;return this.runThroughEntities((function(i,s){t(i)&&(s.stop=!0,e=i)}),null),e}},MetaEntity:p,MetaEntityAttr:m,SpecialDatesResolver:n,TimeValue:class{constructor(t){t instanceof Date?this.date=t:this._name=t}asTime(t){if(this.date)return this.date;d.getDateByName(this._name)}get name(){return this.name}},ValueEditor:f,combinePath:function(t,e){let i=t;return null!=i&&i.length>0?("/"!=i.charAt(i.length-1)&&(i+="/"),i+=e):i=e,i},get i18n(){return r},get liquid(){return h},registerSpecialDatesResolver:function(t){d=t},repeatString:function(t,e){return t.repeat(e)},reverseString:function(t){return t.split("").reverse().join("")},strEndsWith:function(t,e){return t&&t.lastIndexOf(e)==t.length-e.length},get utils(){return o}});
/*!
	 * EasyData.JS UI
	 * Copyright 2020 - 2024 Korzh.com
	 * Licensed under MIT
	 !*/
/*!
	 * EasyData.JS Core
	 * Copyright 2023 Korzh.com
	 * Licensed under MIT
	 !*/!function(t){t[t.Unknown=0]="Unknown",t[t.String=1]="String",t[t.Byte=2]="Byte",t[t.Word=3]="Word",t[t.Int32=4]="Int32",t[t.Int64=5]="Int64",t[t.Bool=6]="Bool",t[t.Float=7]="Float",t[t.Currency=8]="Currency",t[t.BCD=9]="BCD",t[t.Date=10]="Date",t[t.Time=11]="Time",t[t.DateTime=12]="DateTime",t[t.Autoinc=13]="Autoinc",t[t.Memo=14]="Memo",t[t.Blob=15]="Blob",t[t.FixedChar=16]="FixedChar",t[t.Guid=17]="Guid",t[t.Geometry=18]="Geometry",t[t.Geography=19]="Geography"}(C||(C={})),function(t){t[t.Data=0]="Data",t[t.Virtual=1]="Virtual",t[t.Lookup=2]="Lookup"}(T||(T={})),function(t){t.Trace="TRACE",t.Options="OPTIONS",t.Get="GET",t.Put="PUT",t.Post="POST",t.Delete="DELETE"}(b||(b={})),function(t){t.getAllDataTypes=function(){return Object.values(C).filter((t=>"number"==typeof t))},t.getDateDataTypes=function(){return[C.Time,C.Date,C.DateTime]},t.getStringDataTypes=function(){return[C.String,C.Memo,C.FixedChar]};const e=[C.Byte,C.Word,C.Int32,C.Int64,C.Float,C.Currency,C.Autoinc];t.getNumericDataTypes=function(){return e};const i=[C.Byte,C.Word,C.Int32,C.Int64,C.Autoinc];function s(t,e,i){e||(e={});for(let a of i)if(a)for(let i in a)if(a.hasOwnProperty(i)){let o=a[i];null!==o&&"object"==typeof o?t.has(o)?e[i]=t.get(o):Array.isArray(o)?(e[i]=n(o),t.set(o,e[i])):(void 0!==e[i]&&null!=e[i]||(e[i]=Object.create(Object.getPrototypeOf(o))),t.set(o,e[i]),s(t,e[i],[o])):e[i]=o}return e}function n(t){let e=[];for(let i of t)e.push(i);return e}t.assign=function(t,...e){for(let i=0;i<e.length;i++){let s=e[i];if(s)for(let e in s)s.hasOwnProperty(e)&&(t[e]=s[e])}return t},t.assignDeep=function(t,...e){return s(new WeakMap,t,e)},t.getIfDefined=function(t,e){return void 0!==t?t:e},t.IsDefinedAndNotNull=function(t){return null!=t},t.copyArrayTo=function(t,e){const i=t.length,s=e.length;for(let n=0;n<i&&n<s;n++)e[n]=t[n]},t.createArrayFrom=n,t.findItemById=function(t,e){for(var i=t.length,s=0;s<i;s++)if(t[s].id===e)return t[s];return null},t.findItemIndexById=function(t,e){for(var i=t.length,s=0;s<i;s++)if(t[s].id===e)return s;return-1},t.indexOfArrayItem=function(t,e){if(t.indexOf)return t.indexOf(e);{let i=t.length;for(let s=0;s<i;s++)if(e==t[s])return s;return-1}},t.moveArrayItem=function(t,e,i){if(e>=t.length)throw"Index out of bounds: "+e;i>=t.length&&(i=t.length-1);let s=t.splice(e,1)[0];t.splice(i,0,s)},t.removeArrayItem=function(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1)[0]},t.insertArrayItem=function(t,e,i){t.splice(e,0,i)},t.fillArray=function(t,e,i=0,s){let n=t.length>>>0;var a=i>>0,o=a<0?Math.max(n+a,0):Math.min(a,n),r=void 0===s?n:s>>0;let l=r<0?Math.max(n+r,0):Math.min(r,n);for(;o<l;)t[o]=e,o++;return t},t.shiftToFitWindow=function(t,e){let i=document.getElementsByTagName("body")[0],s=window.innerWidth||document.documentElement.clientWidth||i.clientWidth;var n=t+e;let a=0;return n>s&&(a=s-n-10,t+a<0&&(a=10-t)),a},t.isObject=function(t){return null!==t&&("function"==typeof t||"object"==typeof t)},t.isNumericType=function(t){return e.indexOf(t)>=0},t.isIntType=function(t){return i.indexOf(t)>=0},t.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},t.areCompatibleDataTypes=function(t,e){return void 0===t||void 0===e||t==C.Unknown||e==C.Unknown||t==e||t==C.Date&&e==C.DateTime||t==C.DateTime&&e==C.Date},t.isPropSet=function(t,e){return t[e]||t[e.toLowerCase()]||t[e.toUpperCase()]};const a="0123456789abcdefghijklmnopqrstuvwxyz";function o(t,e){const i=t.length;if(i>e){let s=i/e,n="";n+=t[0];let a,o=s;for(let e=1;e<i;e++)a=t[e],e+1>o&&(n+=a,o+=s);return n}return t}function r(t,e){return Math.floor(Math.random()*(e-t))+t}function l(t){const e=parseInt(t);if(isNaN(e))throw`"${t}" is not a valid number`;return e}t.generateId=function(t){t||(t="easy");let e=t.length>4?function(t,e){let i=t.split("-"),s=1,n=4;i.length<4&&(s=4/i.length,n=i.length);let a="";for(let t=0;t<n;t++)a+=o(i[t],s);return a}(t):t;e&&e.length>0&&(e+="-");var i=a[r(0,36)]+a[r(0,36)]+a[r(0,36)],s=r(0,1e4);return e+i+function(t,e=36){var i="",s=t;do{i=a[s%e]+i,s=Math.floor(s/=e)}while(s>0);return i}(621355968e9+1e4*(new Date).getTime()-0x8d60e562e627800-s)},t.strToDateTime=function(t,e){if(!t||0==t.length)return new Date;const i=t.replace(/[^a-zA-Z0-9_]/g,"-"),s=e.replace(/[^a-zA-Z0-9_]/g,"-").split("-"),n=i.split("-"),a=s.indexOf("MM"),o=s.indexOf("dd"),r=s.indexOf("yyyy"),h=s.indexOf("HH"),d=s.indexOf("mm"),c=s.indexOf("ss"),u=new Date;try{const t=r>-1&&r<n.length?l(n[r]):u.getFullYear(),e=a>-1&&a<n.length?l(n[a])-1:u.getMonth()-1;if(e>11)throw"";const i=o>-1&&o<n.length?l(n[o]):u.getDate();if(i>function(t,e){return new Date(e,t+1,0).getDate()}(e,t))throw"";const s=h>-1&&h<n.length?l(n[h]):0;if(s>23)throw"";const g=d>-1&&d<n.length?l(n[d]):0;if(g>59)throw"";const p=c>-1&&c<n.length?l(n[c]):0;if(p>59)throw"";return new Date(t,e,i,s,g,p)}catch(e){throw`${t} is not a valid date.`}},t.strToTime=function(t){const e=t.split(":");try{const t=e.length>0?l(e[0]):0;if(t>23)throw"";const i=e.length>1?l(e[1]):0;if(i>59)throw"";const s=e.length>1?l(e[1]):0;if(s>59)throw"";return new Date(0,0,0,t,i,s)}catch(e){throw`${t} is not a valid time.`}}}(E||(E={})),function(t){let e,i={shortDateFormat:"MM/dd/yyyy",longDateFormat:"dd MMM, yyyy",editDateFormat:"MM/dd/yyyy",shortTimeFormat:"HH:mm",editTimeFormat:"HH:mm",longTimeFormat:"HH:mm:ss",shortMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longMonthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],shortWeekDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longWeekDayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],decimalSeparator:".",currency:"USD"},s={localeId:"en-US",englishName:"English",displayName:"English",texts:{ButtonOK:"OK",ButtonCancel:"Cancel",Yes:"Yes",No:"No",True:"True",False:"False"},settings:i},n={"en-US":s};const a=[];function o(t){for(const e of a)e(t)}function r(){return e.localeId}function l(t){const i=n[t];i?E.assignDeep(e,i):(e.englishName=t,e.displayName=t,e.texts=E.assignDeep({},s.texts)),e.localeId=t}function h(){return e.settings}function d(t){e.settings||(e.settings=E.assignDeep({},i)),e.settings=E.assignDeep(e.settings,t)}function c(t,i){o(i);let a=e;t&&(i.localeId||(i.localeId=t),a=n[t],a||(a=E.assignDeep({},s),n[t]=a)),E.assignDeep(a,i)}t.addMapper=function(t){a.push(t)},t.getLocales=function(){let t=[];for(let e in n)t.push({locale:e,englishName:n[e].englishName,displayName:n[e].displayName});return t.sort(((t,e)=>t.englishName>e.englishName?1:t.englishName===e.englishName?0:-1))},t.getCurrentLocale=r,t.setLocale=function(t){console.warn("This method is deprecated. Use setCurrentLocale instead"),l(t)},t.setCurrentLocale=l,t.getText=function(...t){let i=e.texts,s="";if(t&&t.length){const e=t.length;for(let n=0;n<e&&(s=i[t[n]],"object"==typeof s);n++)i=s}return s},t.getLocaleSettings=h,t.getOneLocaleSetting=function(t){return e.settings[t]},t.getShortMonthName=function(t){const e=h();if(t>0&&t<13)return e.shortMonthNames[t-1];throw"Wrong month number: "+t},t.getLongMonthName=function(t){const e=h();if(t>0&&t<13)return e.longMonthNames[t-1];throw"Wrong month number: "+t},t.getShortWeekDayName=function(t){const e=h();if(t>0&&t<8)return e.shortWeekDayNames.length>=t?e.shortWeekDayNames[t-1]:t.toString();throw"Wrong month number: "+t},t.getLongWeekDayName=function(t){const e=h();if(t>0&&t<8)return e.longWeekDayNames.length>=t?e.longWeekDayNames[t-1]:t.toString();throw"Wrong month number: "+t},t.updateLocaleSettings=d,t.updateLocaleTexts=function(t){"object"==typeof t?(o({localeId:e.localeId,texts:t}),E.assignDeep(e.texts,t)):console.error("Wrong parameter type in updateLocaleTexts function call.The first parameter (localeId) is not necessary. Use updateLocaleTexts(texts) instead")},t.updateDefaultTexts=function(t){for(let e in n){let i=n[e];i.texts=E.assignDeep({},t,i.texts)}e.texts=E.assignDeep({},t,e.texts)},t.updateLocaleInfo=c,t.addLocale=function(t,e){c(t,e)},t.resetLocales=function(){e||(e=E.assignDeep({},s),function(t){const i=new Date(2020,5,7,19,34,56,88),s=i.toLocaleDateString(t,{year:"numeric",month:"numeric",day:"numeric"}),n=i.toLocaleTimeString(t,{hour:"numeric",minute:"numeric",second:"numeric"});let a=s.replace("07","dd").replace("7","d").replace("06","MM").replace("6","M").replace("2020","yyyy").replace("20","yy"),o=n.replace("19","HH").replace("07","hh").replace("7","h").replace("34","mm").replace("56","ss").replace("PM","tt");e.settings||(e.settings={}),d({shortDateFormat:a,shortTimeFormat:o})}("object"==typeof navigator?navigator.language:void 0))};const u=/\[([^\]]+)]|y{2,4}|M{1,4}|d{1,2}|H{1,2}|h{1,2}|m{2}|s{2}|t{2}/g;function g(e,i){const s=e.getFullYear().toString(),n=e.getMonth()+1,a=e.getDate(),o=e.getHours(),r=e.getMinutes(),l=e.getSeconds(),h=o%12||12,d=o>11,c={yyyy:s,yy:s.substring(s.length-2),MMMM:t.getLongMonthName(n),MMM:t.getShortMonthName(n),MM:n<10?"0"+n:n.toString(),M:n.toString(),dd:a<10?"0"+a:a.toString(),d:a.toString(),HH:o<10?"0"+o:o.toString(),H:o.toString(),hh:h<10?"0"+h:h.toString(),h:h.toString(),tt:d?"PM":"AM",mm:r<10?"0"+r:r.toString(),ss:l<10?"0"+l:l.toString()};return i.replace(u,((t,e)=>e||c[t]))}function p(t){const e=h();let i;switch(t){case C.Date:i=e.shortDateFormat;break;case C.Time:i=e.shortTimeFormat;break;default:i=e.shortDateFormat+" "+e.shortTimeFormat}return i}function m(t){const e=h();let i;switch(t){case C.Date:i=e.longDateFormat;break;case C.Time:i=e.longTimeFormat;break;default:i=e.longDateFormat+" "+e.longTimeFormat}return i}t.dateTimeToStr=g,t.dateTimeToStrEx=function(t,e,i){return i?"d"==i?i=p(C.Date):"D"==i?i=m(C.Date):"f"==i?i=p(C.DateTime):"F"==i&&(i=m(C.DateTime)):i=p(e),g(t,i)},t.numberToStr=function(e,i,s){if(i&&i.length>0){const s=i.charAt(0).toUpperCase();if("S"===s)return function(e,i){if(!f[i]){const t=i.split("|").filter((t=>t.length>0)).map((t=>t.split("=")));if(f[i]={},t.length>0)if(t[0].length>1)for(const e of t)f[i][Number.parseInt(e[1])]=e[0];else t.forEach(((t,e)=>{f[i][e]=t[0]}))}const s=f[i];if(void 0!==s[e]){const i=s[e];return t.getText(i)||i}return e.toString()}(e,i.slice(1));if(["D","F","C"].indexOf(s)>=0){const t=r();return e.toLocaleString(t,function(t){const e=h(),i=t[0].toUpperCase(),s=t.length>1?Number.parseInt(t.slice(1)):"D"==i?1:2;switch(i){case"D":return{style:"decimal",useGrouping:!1,minimumIntegerDigits:s};case"C":return{style:"currency",currency:e.currency,minimumFractionDigits:s};default:return{style:"decimal",minimumFractionDigits:s,maximumFractionDigits:s}}}(i))}return function(t,e){let i=t.toString(),s="",n=i.length-1;for(let t=e.length-1;t>=0;t--){const a=e.charAt(t);"#"===a||"0"===a?n>=0?(s+=i.charAt(n),n--):"0"===a&&(s+=0):s+=a}return s.split("").reverse().join("")}(Math.trunc(e),i)}const n=h();return s=s||n.decimalSeparator,e.toString().replace(".",s)},t.booleanToStr=function(e,i){if(i&&i.length>0&&"S"===i.charAt(0).toUpperCase()){const s=i.slice(1).split("|");if(s.length>1){const i=s[e?1:0];return t.getText(i)||i}}return`${e}`};const f={}}(x||(x={})),function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Center=2]="Center",t[t.Right=3]="Right"}(I||(I={}));let O=class{constructor(t,e){this.columns=t,this.values=e}toArray(){return Array.from(this.values)}size(){return this.values.length}getValue(t){let e;if("string"==typeof t){if(e=this.columns.getIndex(t),void 0===e)throw new RangeError(`No column with id '${t}'`)}else e=t;if(e>=this.values.length)throw new RangeError("Out of range: "+e);return this.values[e]}setValue(t,e){let i;if("string"==typeof t){if(i=this.columns.getIndex(t),void 0===i)throw new RangeError(`No column with id '${t}'`)}else i=t;if(i>=this.values.length)throw new RangeError("Out of range: "+i);this.values[i]=e}},A=class{static newGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}},k=class{constructor(t){this.silentMode=0,this.events=new Array,this.source=t}subscribe(t,e){let i=this.getEventRecByType(t);const s={id:A.newGuid(),callback:e};return i?i.eventCallbacks.push(s):(i={type:t,eventCallbacks:new Array(s)},this.events.push(i)),s.id}unsubscribe(t,e){let i=this.getEventRecByType(t);if(i){let t=-1;for(t=0;t<i.eventCallbacks.length&&i.eventCallbacks[t].id!==e;t++);t>=0&&i.eventCallbacks.splice(t,1)}}fire(t,e,i=0,s=!1){if(this.silentMode&&!s)return;let n=this.getEventRecByType(t);if(n){const s={type:t,source:this.source,data:e};let a=()=>{for(let t of n.eventCallbacks)t.callback(s)};i>0?setTimeout(a,i):a()}}enterSilentMode(){this.silentMode++}exitSilentMode(){this.silentMode&&this.silentMode--}isSilent(){return this.silentMode>0}getEventRecByType(t){for(let e of this.events)if(e.type==t)return e;return null}};function P(t){t.style.display="none"}function N(t,e){e||(e=""),t.style.display=e}function L(){const t=document.body,e=document.documentElement;return{top:window.pageYOffset||e.scrollTop||t.scrollTop,left:window.pageXOffset||e.scrollLeft||t.scrollLeft}}function F(t){let e={x:0,y:0};if(null!==t){const i=function(t){const e={top:0,right:0,bottom:0,left:0,width:0,height:0};let i;try{i=t.getBoundingClientRect()}catch(t){i=e}const s=document.body,n=document.documentElement,a=L(),o=a.top,r=a.left,l=n.clientTop||s.clientTop||0,h=n.clientLeft||s.clientLeft||0,d=i.top+o-l,c=i.left+r-h;return{top:Math.round(d),left:Math.round(c)}}(t);e={x:i.left,y:i.top}}return e}function $(){return{width:window.innerWidth,height:window.innerHeight}}(S||(S={})).renderLiquidTemplate=function(t,e){let i=t;if(e)for(let t in e){const s=new RegExp("{{"+t+"}}","g");i=i.replace(s,e[t])}return i},x.resetLocales(),"function"!=typeof Object.values&&(Object.values=function(t){return Object.keys(t).map((e=>t[e]))}),"function"!=typeof Math.trunc&&(Math.trunc=function(t){return isNaN(t)?NaN:t>0?Math.floor(t):Math.ceil(t)}),function(t){let e=null,i=null;function s(){if(null===i){const t=navigator.userAgent;i=t.indexOf("MSIE ")>-1||t.indexOf("Trident/")>-1}return i}t.IsIE=s,t.IsEdge=function(){const t=window.navigator.userAgent;return!s()&&t.includes("Edge/")},t.IsFirefox=function(){if(null===e){const t=navigator.userAgent;e=t.toLowerCase().indexOf("firefox")>-1}return e};let n,a,o=!1,r=()=>{const t=l();o=window.matchMedia("only screen and (max-width: 840px)").matches||window.matchMedia("only screen and (max-height: 420px)").matches;const e=l();e!==t&&a&&a(e)};function l(){return void 0!==n?n:o}r(),window.addEventListener("resize",(()=>r())),t.isMobileMode=l,t.setIsMobileMode=function(t){const e=l();n=t;const i=l();i!==e&&a&&a(i)},t.onMobileModeChanged=function(t){a=t},t.getMobileCssClass=function(){return l()?"k-mobile":null}}(M||(M={}));const B="eqjs";function H(t,e){const i={9:"[0-9]",a:"[a-z]"},s=e.split(""),n=e=>{if("focus"===e.type&&""!==t.value)return;let n=[],a=t.selectionStart;s.forEach(((e,s)=>{if(i[e]){let a=new RegExp(i[e],"i").test(t.value.charAt(s));n.push(a?t.value.charAt(s):"_")}else n.push(e)})),t.value=n.join(""),t.selectionStart=t.selectionEnd=a};t.addEventListener("keydown",(e=>{if(8===e.keyCode||46===e.keyCode){e.preventDefault();let n=[],a=t.selectionStart;if(0==a)return;let o=a,r=!0;for(let e=s.length-1;e>=0;e--){const l=s[e];if(i[l]){let s=new RegExp(i[l],"i").test(t.value.charAt(e));s&&e!=a-1&&(r=!1),e===a-1&&o--,n.push(s&&e!=a-1?t.value.charAt(e):"_")}else e===o-1&&o--,a-1===e&&a--,n.push(l)}t.value=r?"":n.reverse().join(""),t.selectionStart=t.selectionEnd=o<0?0:o;const l=document.createEvent("Event");l.initEvent("input",!0,!0),t.dispatchEvent(l)}})),t.addEventListener("keypress",(e=>{const n=String.fromCharCode(e.charCode);if(n){e.preventDefault();let a=[],o=t.selectionStart,r=o;s.forEach(((e,s)=>{if(i[e]){const l=s!=o?t.value.charAt(s):n;let h=new RegExp(i[e],"i").test(l);a.push(h?l:"_"),h&&o===s&&r++}else a.push(e),r===s&&r++,o===s&&o++})),t.value=a.join(""),t.selectionStart=t.selectionEnd=r;const l=document.createEvent("Event");l.initEvent("input",!0,!0),t.dispatchEvent(l)}})),t.addEventListener("input",n),t.addEventListener("focus",n)}let _=class{constructor(t,e){this.element="string"==typeof t?document.createElement(t):t,e&&this.element.parentElement!==e&&e.appendChild(this.element)}addChild(t,e){const i=Y(t,this.element);return e&&e(i),this}addChildElement(t){return t&&this.element.appendChild(t),this}attr(t,e){return this.element.setAttribute(t,e),this}id(t){return this.attr("id",t)}focus(){return this.element.focus(),this}title(t){return this.attr("title",t)}data(t,e=null){return null===e?(this.element.removeAttribute("data-"+t),this):this.attr("data-"+t,e)}show(){return this.removeStyle("display")}hide(t=!0){return t?this.setStyle("display","none"):this}visible(t=!0){return t?this.setStyle("visibility","visible"):this.setStyle("visibility","hidden")}isVisible(){return!!(this.element.offsetWidth||this.element.offsetHeight||this.element.getClientRects().length)}addClass(t,...e){if(t){const i=[...t.trim().split(" "),...e];for(let t=0;t<i.length;t++)this.element.classList.add(i[t])}return this}removeClass(t,...e){if(t){const i=[...t.trim().split(" "),...e];for(let t=0;t<i.length;t++)this.element.classList.remove(i[t])}return this}toggleClass(t,e=void 0){return t&&this.element.classList.toggle(t,e),this}on(t,e){const i=t.split(" ");for(let t=0;t<i.length;t++)this.element.addEventListener(i[t],e);return this}off(t,e){const i=t.split(" ");for(let t=0;t<i.length;t++)this.element.removeEventListener(i[t],e);return this}setStyle(t,e){return this.element.style.setProperty(t,e),this}removeStyle(t){return this.element.style.removeProperty(t),this}text(t){return this.element.innerText=t,this}html(t){return this.element.innerHTML=t,this}clear(){const t=this.element;this.element=document.createElement(this.element.tagName),t.replaceWith(this.element)}addText(t){const e=document.createTextNode(t);return this.element.appendChild(e),this}addHtml(t){return this.element.innerHTML+=t,this}toDOM(){return this.element}appendTo(t){return t&&t.appendChild(this.element),this}},W=class extends _{constructor(t,e){super(t||"textarea",e)}name(t){return this.element.name=t,this}rows(t){return this.element.rows=t,this}cols(t){return this.element.cols=t,this}value(t){return this.element.value=t,this}},V=class extends _{constructor(t,e){super(t||"input",e)}name(t){return this.element.name=t,this}type(t){return this.element.type=t,this}size(t){return this.element.size=t,this}value(t){return t instanceof Date?this.element.valueAsDate=t:"number"==typeof t?this.element.valueAsNumber=t:this.element.value=t,this}mask(t){return H(this.element,t),this}},G=class extends _{constructor(t,e){super(t||"select",e)}addOption(t){const e=document.createElement("option");return"string"==typeof t?(e.value=t,e.innerHTML=t):(e.value=t.value,e.innerHTML=t.title||t.value,e.selected=t.selected||!1),this.element.appendChild(e),this}value(t){return this.element.value=t,this}};function Y(t,e){return"div"===t||t instanceof HTMLDivElement||"span"===t||t instanceof HTMLSpanElement||"a"===t||t instanceof HTMLAnchorElement||"button"===t||t instanceof HTMLButtonElement||"img"===t||t instanceof HTMLImageElement?new _(t,e):"input"===t||t instanceof HTMLInputElement?new V(t instanceof HTMLInputElement?t:null,e):"textarea"===t||t instanceof HTMLTextAreaElement?new W(t instanceof HTMLTextAreaElement?t:null,e):"select"===t||t instanceof HTMLSelectElement?new G(t instanceof HTMLSelectElement?t:null,e):new _(t,e)}const z="undefined"!=typeof TouchEvent;var U;!function(t){t.None="none",t.Allow="allow",t.Forbid="forbid"}(U||(U={}));let j=class{constructor(t,e,i){this.dropEffect=U.Allow,this.pageX=0,this.pageY=0,this.item=t,this.dragImage=e,this.data=t.data,this.sourceEvent=i,i&&i instanceof MouseEvent&&(this.pageX=i.pageX,this.pageY=i.pageY),i&&z&&i instanceof TouchEvent&&i.touches[0]&&(this.pageX=i.touches[0].pageX,this.pageY=i.touches[0].pageY)}},q=class{constructor(t){t&&t instanceof MouseEvent&&(this.x=t.pageX,this.y=t.pageY),t&&z&&t instanceof TouchEvent&&t.touches[0]&&(this.x=t.touches[0].pageX,this.y=t.touches[0].pageY)}},K=class{constructor(){this.delta=5,this.draggableItem=null,this.dragImage=null,this.finishedSuccessfully=!1,this.mouseDownPosition=null,this.containerDescriptors=[],this.containerDescriptorIndex=-1,this.dropEffect=U.None,this.classPrefix="eqjs-drop",this.DRAG_DISABLED_ATTR="drag-disabled"}registerDraggableItem(t){const e=t.element;if(!e)throw Error("Element in draggle item is null or undefined");e.ondragstart=function(){return!1};const i=t=>{if(e.hasAttribute(this.DRAG_DISABLED_ATTR))return;t.preventDefault(),t instanceof MouseEvent&&t.stopPropagation();const i=new q(t);(Math.abs(i.x-this.mouseDownPosition.x)>this.delta||Math.abs(i.y-this.mouseDownPosition.y)>this.delta)&&n(t)},s=t=>{this.mouseMoveDragListener(t)},n=n=>{n.preventDefault(),n.stopPropagation(),e.removeEventListener("mousemove",i),e.removeEventListener("touchmove",i),this.finishedSuccessfully=!1,t.beforeDragStart&&t.beforeDragStart(),this.dragImage=Y("div").setStyle("position","absolute").setStyle("z-index","65530").toDOM(),document.body.appendChild(this.dragImage),this.dragImage.appendChild(e.cloneNode(!0)),t.renderer&&t.renderer(this.dragImage),this.dropEffect=U.None,this.updateCusror(this.dropEffect),this.updateImageClass(this.dropEffect),this.draggableItem={element:e,scope:t.scope,data:t.data},this.updateDragItemPosition(n);const a=new j(this.draggableItem,this.dragImage,n);a.dropEffect=this.dropEffect,t.onDragStart&&t.onDragStart(a),this.dropEffect!==a.dropEffect&&(this.dropEffect=a.dropEffect,this.updateImageClass(this.dropEffect)),document.addEventListener("mousemove",s,!0),document.addEventListener("touchmove",s,!0)},a=t=>{z&&t instanceof TouchEvent&&t.preventDefault(),this.mouseDownPosition=new q(t),e.addEventListener("mousemove",i),e.addEventListener("touchmove",i),document.addEventListener("mouseup",o),document.addEventListener("touchend",o)};e.addEventListener("mousedown",a),e.addEventListener("touchstart",a);const o=t=>{this.mouseDownPosition=null,e.removeEventListener("mousemove",i),e.removeEventListener("touchmove",i),document.removeEventListener("mousemove",s,!0),document.removeEventListener("touchmove",s,!0),this.draggableItem&&r(t)},r=e=>{try{if(this.containerDescriptorIndex>=0){const t=this.containerDescriptors[this.containerDescriptorIndex],i={element:t.element,scopes:t.scopes,data:t.data},s=new j(this.draggableItem,this.dragImage,e);try{i.scopes.indexOf(this.draggableItem.scope)>=0&&this.dropEffect===U.Allow&&(this.finishedSuccessfully=!0,t.onDrop&&t.onDrop(i,s))}finally{t.onDragLeave&&t.onDragLeave(i,s)}}}finally{try{const i=new j(this.draggableItem,this.dragImage,e);i.data.finishedSuccessfully=this.finishedSuccessfully,t.onDragEnd&&t.onDragEnd(i)}finally{this.draggableItem=null,this.dragImage&&this.dragImage.parentElement&&this.dragImage.parentElement.removeChild(this.dragImage),this.dragImage=null,this.finishedSuccessfully=!1,document.removeEventListener("mouseup",o),document.removeEventListener("touchend",o)}}}}registerDropContainer(t){if(!t.element)throw Error("Element in drop container is null or undefined");this.containerDescriptors.push(t)}removeDropContainer(t){const e=this.containerDescriptors.filter((e=>e===t||e.element==t));if(e)for(const t of e)E.removeArrayItem(this.containerDescriptors,t)}mouseMoveDragListener(t){if(t instanceof MouseEvent&&t.preventDefault(),t.stopPropagation(),this.updateDragItemPosition(t),-1==this.containerDescriptorIndex){for(let e=0;e<this.containerDescriptors.length;e++){const i=this.containerDescriptors[e];if(this.detectDragEnterEvent(i.element,t)){this.containerDescriptorIndex=e;break}}this.containerDescriptorIndex>=0&&this.dragEnterEvent(t)}else{const e=this.containerDescriptors[this.containerDescriptorIndex];this.detectDragLeaveEvent(e.element,t)&&(this.dragLeaveEvent(t),this.containerDescriptorIndex=-1)}if(this.containerDescriptorIndex>=0){const e=this.containerDescriptors[this.containerDescriptorIndex],i={element:e.element,scopes:e.scopes,data:e.data};if(i.scopes.indexOf(this.draggableItem.scope)>=0){const s=new j(this.draggableItem,this.dragImage,t);s.dropEffect=this.dropEffect,e.onDragOver&&e.onDragOver(i,s)}}}updateCusror(t){switch(t){case U.Allow:this.setCursorStyle(this.dragImage,"grabbing");break;case U.Forbid:this.setCursorStyle(this.dragImage,"no-drop");break;default:this.setCursorStyle(this.dragImage,"grabbing")}}updateImageClass(t){switch(this.dragImage.classList.remove(`${this.classPrefix}-allow`),this.dragImage.classList.remove(`${this.classPrefix}-forbid`),this.dragImage.classList.remove(`${this.classPrefix}-none`),t){case U.Allow:this.dragImage.classList.add(`${this.classPrefix}-allow`);break;case U.None:this.dragImage.classList.add(`${this.classPrefix}-none`);break;case U.Forbid:this.dragImage.classList.add(`${this.classPrefix}-forbid`);break;default:this.dragImage.classList.add(`${this.classPrefix}-none`)}}setCursorStyle(t,e){if(t){t.style.cursor=e;for(let i=0;i<t.children.length;i++)this.setCursorStyle(t.children[i],e)}}updateDragItemPosition(t){if(this.dragImage){const e=new q(t);this.dragImage.style.top=e.y-this.dragImage.offsetHeight/2+"px",this.dragImage.style.left=e.x-this.dragImage.offsetWidth/2+"px"}}dragEnterEvent(t){const e=this.containerDescriptors[this.containerDescriptorIndex],i={element:e.element,scopes:e.scopes,data:e.data};if(i.scopes.indexOf(this.draggableItem.scope)>=0){const s=new j(this.draggableItem,this.dragImage,t);s.dropEffect=U.Allow,e.onDragEnter&&e.onDragEnter(i,s),this.dropEffect=s.dropEffect,this.updateCusror(this.dropEffect),this.updateImageClass(this.dropEffect)}else this.dropEffect!==U.Forbid&&(this.dropEffect=U.None,this.updateCusror(this.dropEffect),this.updateImageClass(this.dropEffect))}dragLeaveEvent(t){const e=this.containerDescriptors[this.containerDescriptorIndex],i={element:e.element,scopes:e.scopes,data:e.data};if(i.scopes.indexOf(this.draggableItem.scope)>=0){const s=new j(this.draggableItem,this.dragImage,t);s.dropEffect=U.None,e.onDragLeave&&e.onDragLeave(i,s),this.dropEffect=s.dropEffect,this.updateCusror(this.dropEffect),this.updateImageClass(this.dropEffect)}}detectDragEnterEvent(t,e){const i=F(t),s=new q(e);return!(s.y<i.y||s.y>i.y+t.offsetHeight||s.x<i.x||s.x>i.x+t.offsetWidth)}detectDragLeaveEvent(t,e){const i=F(t),s=new q(e);return!(s.y>i.y&&s.y<i.y+t.offsetHeight&&s.x>i.x&&s.x<i.x+t.offsetWidth)}};const J=new K;var X,Q;!function(t){t[t.Always=0]="Always",t[t.Once=1]="Once",t[t.Never=2]="Never"}(X||(X={})),function(t){t[t.NONE=1]="NONE",t[t.LEFT=2]="LEFT",t[t.CENTER=3]="CENTER",t[t.RIGHT=4]="RIGHT"}(Q||(Q={}));let Z=class{constructor(t,e,i=!1){this._label=null,this._description=null,this.align=Q.NONE,this.isVisible=!0,this.isRowNum=!1,this.dataColumn=t,this.grid=e;const s=e.options.columnWidths||{};t?(t.style.alignment&&(this.align=function(t){switch(t){case I.Left:return Q.LEFT;case I.Center:return Q.CENTER;case I.Right:return Q.RIGHT;default:return Q.NONE}}(t.style.alignment)),this.width=s&&s[this.type]?s[this.type].default:250,this._description=t.description):i&&(this.isRowNum=!0,this.width=s&&s.rowNumColumn?s.rowNumColumn.default:60,this._label="")}get label(){return this._label?this._label:this.isRowNum?"":this.dataColumn.label}set label(t){this._label=this.label}get description(){return this._description}get type(){return this.dataColumn?this.dataColumn.type:null}},tt=class{constructor(t,e){this.items=[],this.grid=e,this.sync(t)}sync(t,e=!0){this.clear();const i=new Z(null,this.grid,!0);if(this.add(i),e||(i.isVisible=!1),t)for(let e of t.getItems()){const t=new Z(e,this.grid);this.grid.options.onSyncGridColumn&&this.grid.options.onSyncGridColumn(t),this.add(t)}}get count(){return this.items.length}add(t){const e=this.items.length;return this.items.push(t),e}put(t,e){t>=0&&t<this.items.length&&(this.items[t]=e)}move(t,e){let i=this.items.indexOf(t);i>=0&&i!=e&&E.moveArrayItem(this.items,i,e)}get(t){return t>=0&&t<this.items.length?this.items[t]:null}getItems(){return this.items}removeAt(t){this.get(t),this.items.splice(t,1)}clear(){this.items=[]}};const et="keg",it=/{0:(.*?)}/g;var st;!function(t){t[t.STRING=1]="STRING",t[t.NUMBER=2]="NUMBER",t[t.DATETIME=3]="DATETIME",t[t.BOOL=4]="BOOL"}(st||(st={}));const nt=(t,e,i,s)=>{const n=t?t.toString().replace(/\n/g,"↵ "):"";i.innerText=n,i.title=n,e.align==Q.NONE&&i.classList.add(`${et}-cell-value-align-left`)},at=(t,e,i,s)=>{let n=(t||"").toString();"number"==typeof t&&(n=e.dataColumn&&e.dataColumn.displayFormat&&it.test(e.dataColumn.displayFormat)?e.dataColumn.displayFormat.replace(it,((e,i)=>x.numberToStr(t,i))):t.toLocaleString()),i.innerText=n,i.title=n,e.align==Q.NONE&&i.classList.add(`${et}-cell-value-align-right`)},ot=(t,e,i,s)=>{const n="[object Date]"===Object.prototype.toString.call(t);let a=(t||"").toString();if(n)if(e.dataColumn&&e.dataColumn.displayFormat&&it.test(e.dataColumn.displayFormat))a=e.dataColumn.displayFormat.replace(it,((i,s)=>x.dateTimeToStrEx(t,e.type,s)));else{const i=x.getCurrentLocale(),s={hour:"numeric",minute:"numeric",second:"numeric"};switch(e.type){case C.Date:a=t.toLocaleDateString(i);break;case C.Time:a=t.toLocaleTimeString(i,s);break;case C.DateTime:a=`${t.toLocaleDateString(i)} ${t.toLocaleTimeString(i,s)}`}}i.innerText=a,i.title=a,e.align==Q.NONE&&i.classList.add(`${et}-cell-value-align-right`)},rt=(t,e,i,s)=>{if(e.dataColumn&&e.dataColumn.displayFormat&&it.test(e.dataColumn.displayFormat)){const s=e.dataColumn.displayFormat.replace(it,((e,i)=>x.booleanToStr(t,i)));return nt(s,e,i)}i.classList.add(`${et}-cell-value-bool`),i.classList.add(`${et}-${t?"cell-value-true":"cell-value-false"}`)};let lt=class{constructor(t){this.renderers={},this.defaultRenderers={},this.registerRenderer("StringDefault",nt),this.setDefaultRenderer(st.STRING,nt),this.registerRenderer("NumberDefault",at),this.setDefaultRenderer(st.NUMBER,at),this.registerRenderer("DateTimeDefault",ot),this.setDefaultRenderer(st.DATETIME,ot),this.registerRenderer("BoolDefault",rt),this.setDefaultRenderer(st.BOOL,rt)}getDefaultRenderer(t){const e=this.getCellType(t);return this.defaultRenderers[st[e]]}getDefaultRendererByType(t){return this.defaultRenderers[st[t]]}setDefaultRenderer(t,e){e&&(this.defaultRenderers[st[t]]=e)}getRenderer(t){return this.renderers[t]}registerRenderer(t,e){this.renderers[t]=e}getCellType(t){switch(t){case C.Autoinc:case C.Byte:case C.Word:case C.Currency:case C.Float:case C.Int32:case C.Int64:return st.NUMBER;case C.Date:case C.DateTime:case C.Time:return st.DATETIME;case C.Bool:return st.BOOL;default:return st.STRING}}},ht=class{get cssPrefix(){return"kdtp-cal"}constructor(t,e){this.slot=t,this.options=e||{},this.options.yearRange||(this.options.yearRange="c-10:c+10")}setDate(t){this.currentDate=new Date(t)}getDate(){return new Date(this.currentDate)}dateChanged(t){this.options.onDateChanged&&this.options.onDateChanged(this.currentDate,t)}},dt=class{get cssPrefix(){return"kdtp"}constructor(t){this.calendar=null,this.timePicker=null,this.options=t,this.render()}setDateTime(t){this.currentDateTime=new Date(t),this.calendar&&this.calendar.setDate(this.currentDateTime),this.timePicker&&this.timePicker.setTime(this.currentDateTime)}getDateTime(){return new Date(this.currentDateTime)}render(){this.options.showCalendar&&(this.calendar=this.createCalendar({yearRange:this.options.yearRange,showDateTimeInput:this.options.showDateTimeInput,timePickerIsUsed:this.options.showTimePicker,oneClickDateSelection:this.options.oneClickDateSelection,onDateChanged:(t,e)=>{this.currentDateTime=t,this.timePicker&&this.timePicker.setTime(this.currentDateTime),this.options.showTimePicker&&this.dateTimeChanged(),e&&this.apply(this.currentDateTime)}}),this.calendar&&this.calendar.render()),this.options.showTimePicker&&(this.timePicker=this.createTimePicker({onTimeChanged:t=>{this.currentDateTime.setHours(t.getHours()),this.currentDateTime.setMinutes(t.getMinutes()),this.calendar&&this.calendar.setDate(this.currentDateTime),this.dateTimeChanged()}}),this.timePicker&&this.timePicker.render()),this.setDateTime(new Date)}createCalendar(t){return null}createTimePicker(t){return null}show(t){this.options.beforeShow&&this.options.beforeShow();const e=F(t||document.body);this.slot.style.top=e.y+t.clientHeight+"px",this.slot.style.left=e.x+"px"}apply(t){this.options.onApply&&this.options.onApply(t),this.destroy()}cancel(){this.options.onCancel&&this.options.onCancel(),this.destroy()}destroy(){this.slot&&this.slot.parentElement&&this.slot.parentElement.removeChild(this.slot)}dateTimeChanged(){this.options.onDateTimeChanged&&this.options.onDateTimeChanged(this.currentDateTime)}},ct=class extends ht{constructor(t,e){super(t,e),this.daysOfWeek=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.calendarBody=null,this.isManualInputChanging=!1;for(let t=0;t<this.daysOfWeek.length;t++)this.daysOfWeek[t]=x.getShortWeekDayName(t+1);for(let t=0;t<this.months.length;t++)this.months[t]=x.getLongMonthName(t+1)}setDate(t){super.setDate(t),this.selectedMonth=this.currentDate.getMonth(),this.selectedYear=this.currentDate.getFullYear(),this.rerenderMonth()}render(){const t=Y("div",this.slot).addClass(`${this.cssPrefix}-header`);this.options.showDateTimeInput?t.addChildElement(this.renderManualDateInput()):t.addChild("span",(t=>this.headerTextElem=t.toDOM())),Y(this.slot).addChildElement(this.renderCalendarButtons()),this.calendarBody=Y("div",this.slot).addClass(`${this.cssPrefix}-body`).toDOM()}getInputDateFormat(){const t=x.getLocaleSettings();return this.options.timePickerIsUsed?`${t.editDateFormat} ${t.editTimeFormat}`:t.editDateFormat}renderManualDateInput(){const t=this.getInputDateFormat(),e=Y("input").attr("placeholder",t).addClass(`${this.cssPrefix}-header-input`);return e.mask(t.replace("yyyy","9999").replace("MM","99").replace("dd","99").replace("HH","99").replace("mm","99").replace("ss","99")).on("input",(i=>{e.removeClass("error");try{this.isManualInputChanging=!0;const e=E.strToDateTime(this.manualInputElem.value,t);this.currentDate=e,this.jump(this.currentDate.getFullYear(),this.currentDate.getMonth()),this.dateChanged(!1)}catch(t){e.addClass("error")}finally{this.isManualInputChanging=!1}})).on("keydown",(t=>{13===t.keyCode&&(t.preventDefault(),t.stopPropagation(),this.manualInputElem.className.indexOf("error")<0&&!this.isManualInputChanging&&this.dateChanged(!0))})).on("focus",(()=>{setTimeout((()=>{this.manualInputElem.selectionStart=0,this.manualInputElem.selectionEnd=0}),50)})),this.manualInputElem=e.toDOM(),this.manualInputElem}updateDisplayedDateValue(){if(this.manualInputElem){if(!this.isManualInputChanging){const t=this.getInputDateFormat();this.manualInputElem.value=x.dateTimeToStr(this.currentDate,t),this.manualInputElem.focus()}}else if(this.headerTextElem){const t=x.getCurrentLocale();this.headerTextElem.innerText=this.currentDate.toLocaleString("en"==t?void 0:t,{year:"numeric",month:"long",day:"numeric"})}}renderCalendarButtons(){return Y("nav").addClass(`${this.cssPrefix}-nav`).addChild("div",(t=>t.addClass(`${this.cssPrefix}-nav-prev`).on("click",(()=>{this.prev()})).addChild("span",(t=>t.html("&lsaquo;"))))).addChild("div",(t=>t.addClass(`${this.cssPrefix}-nav-selectors`).addChild("div",(t=>t.addClass(`${this.cssPrefix}-nav-month`).addChild("select",(t=>{t.on("change",(()=>{this.jump(this.selectedYear,parseInt(this.selectMonthElem.value))}));for(let e=0;e<this.months.length;e++)t.addChild("option",(t=>t.attr("value",e.toString()).text(this.months[e])));this.selectMonthElem=t.toDOM()})))).addChild("div",(t=>t.addClass(`${this.cssPrefix}-nav-year`).addChild("select",(t=>this.selectYearElem=t.on("change",(()=>{this.jump(parseInt(this.selectYearElem.value),this.selectedMonth)})).toDOM())))))).addChild("div",(t=>t.addClass(`${this.cssPrefix}-nav-next`).on("click",(()=>{this.next()})).addChild("span",(t=>t.html("&rsaquo;"))))).toDOM()}prev(){this.selectedYear=0===this.selectedMonth?this.selectedYear-1:this.selectedYear,this.selectedMonth=0===this.selectedMonth?11:this.selectedMonth-1,this.rerenderMonth()}next(){this.selectedYear=11===this.selectedMonth?this.selectedYear+1:this.selectedYear,this.selectedMonth=(this.selectedMonth+1)%12,this.rerenderMonth()}rerenderSelectYear(){const t=/c-(\d*):c\+(\d*)/g.exec(this.options.yearRange);let e=0,i=1;null!==t&&(e=parseInt(t[1]),i=parseInt(t[2])),this.selectYearElem.innerHTML="";for(let t=0;t<=e+i;t++){let i=document.createElement("option"),s=this.selectedYear-e+t;i.value=s.toString(),i.innerText=s.toString(),this.selectYearElem.appendChild(i)}}jump(t,e){this.selectedYear=t,this.selectedMonth=e,this.rerenderMonth()}rerenderMonth(){this.updateDisplayedDateValue(),this.rerenderSelectYear();let t=new Date(this.selectedYear,this.selectedMonth).getDay(),e=new Date(this.selectedYear,this.selectedMonth+1,0).getDate();this.calendarBody.innerHTML="",this.selectYearElem.value=this.selectedYear.toString(),this.selectMonthElem.value=this.selectedMonth.toString(),this.daysOfWeek.forEach(((t,e)=>{Y("div",this.calendarBody).addClass(`${this.cssPrefix}-weekday`).addClass(0==e||6==e?`${this.cssPrefix}-weekend`:"").text(t)}));for(let e=0;e<t;e++)Y("div",this.calendarBody).addClass(`${this.cssPrefix}-day-empty`);const i=new Date;for(let s=1;s<=e;s++){const e=Y("div",this.calendarBody).addClass(`${this.cssPrefix}-day`).attr("data-date",s.toString()).text(s.toString()).on("click",(t=>{this.currentDate.setFullYear(this.selectedYear),this.currentDate.setMonth(this.selectedMonth),this.currentDate.setDate(parseInt(t.target.getAttribute("data-date"))),this.dateChanged(this.options.oneClickDateSelection)}));s===i.getDate()&&this.selectedYear===i.getFullYear()&&this.selectedMonth===i.getMonth()&&e.addClass(`${this.cssPrefix}-day-current`),s===this.currentDate.getDate()&&this.selectedYear===this.currentDate.getFullYear()&&this.selectedMonth===this.currentDate.getMonth()&&e.addClass(`${this.cssPrefix}-day-selected`);const n=(t+s-1)%7;0!=n&&6!=n||e.addClass(`${this.cssPrefix}-weekend`),"function"==typeof this.options.onDrawDay&&this.options.onDrawDay.apply(e.toDOM(),[e.toDOM(),new Date(this.selectedYear,this.selectedMonth,s)])}const s=(t+e)%7,n=0==s?0:7-s;for(let t=0;t<n;t++)Y("div",this.calendarBody).addClass(`${this.cssPrefix}-day-empty`)}dateChanged(t){super.dateChanged(t),this.rerenderMonth()}},ut=class{get cssPrefix(){return"kdtp-tp"}constructor(t,e){this.slot=t,this.options=e||{}}setTime(t){this.currentTime=new Date(t)}getTime(){return new Date(this.currentTime)}timeChanged(){this.options.onTimeChanged&&this.options.onTimeChanged(this.currentTime)}},gt=class extends ut{setTime(t){super.setTime(t),this.updateDisplayedTime(),this.hoursInput.valueAsNumber=t.getHours(),this.minutesInput.valueAsNumber=t.getMinutes()}render(){Y("div",this.slot).addClass(`${this.cssPrefix}-time`).addChild("span",(t=>this.timeText=t.toDOM())).toDOM();const t=Y("div",this.slot).addClass(`${this.cssPrefix}-sliders`);return t.addChild("div",(t=>t.addClass(`${this.cssPrefix}-time-row`).title("Hours").addChild("input",(t=>this.hoursInput=t.addClass(`${this.cssPrefix}-input-hours`).type("range").attr("min","0").attr("max","23").attr("step","1").on("input",(t=>{this.currentTime.setHours(this.hoursInput.valueAsNumber),this.updateDisplayedTime(),this.timeChanged()})).toDOM())))),t.addChild("div",(t=>t.addClass(`${this.cssPrefix}-time-row`).title("Minutes").addChild("input",(t=>this.minutesInput=t.addClass(`${this.cssPrefix}-input-minutes`).type("range").attr("min","0").attr("max","59").attr("step","1").on("input",(t=>{this.currentTime.setMinutes(this.minutesInput.valueAsNumber),this.updateDisplayedTime(),this.timeChanged()})).toDOM())))),this.slot}updateDisplayedTime(){const t=x.getCurrentLocale(),e=this.currentTime.toLocaleString("en"==t?void 0:t,{hour:"numeric",minute:"numeric"});this.timeText.innerText=e}};var pt;!function(t){t[t.Left=1]="Left",t[t.Center=2]="Center",t[t.Right=3]="Right"}(pt||(pt={}));const mt="kdlg";let ft=class t{openConfirm(t,e,i){const s={title:t,closable:!1,submitable:!0,cancelable:!0,body:`<div id="${mt}-dialog-confirm">${e}</div>`};return i?(s.onSubmit=()=>{i(!0)},s.onCancel=()=>{i(!1)},void this.open(s)):new Promise((t=>{s.onSubmit=()=>{t(!0)},s.onCancel=()=>{t(!1)},this.open(s)}))}openPrompt(t,e,i,s){const n={title:t,submitable:!0,closable:!0,cancelable:!0,submitOnEnter:!0,body:`<div id="${mt}-dialog-form" class="kfrm-form">\n            <div class="kfrm-fields label-above">\n                <label for="${mt}-dialog-form-input" id="${mt}-dialog-form-content">${e}</label>\n                <input type="text" name="${mt}-dialog-form-input" id="${mt}-dialog-form-input" />\n            </div>\n        </div>`,arrangeParents:!1,beforeOpen:()=>{const t=document.getElementById(`${mt}-dialog-form-input`);i&&(t.value=i),t.focus()}},a=t=>{const e=document.getElementById(`${mt}-dialog-form-input`),i=e.value;return i&&i.replace(/\s/g,"").length>0?(t(i),!0):(e.classList.add("eqjs-invalid"),!1)};return s?(n.onSubmit=()=>a(s),n.onCancel=()=>{s("")},void this.open(n)):new Promise((t=>{n.onSubmit=()=>a(t),n.onCancel=()=>{t("")},this.open(n)}))}open(t,e){const i=new yt(t,e),s=t.onDestroy;return t.onDestroy=t=>{this.untrack(t),s&&s(t)},i.open(),this.track(i),i}createSet(t){return new wt(t,this)}untrack(e){const i=t.openDialogs.indexOf(e);i>=0&&t.openDialogs.splice(i,1)}track(e){t.openDialogs.push(e)}openProgress(t){const e=new Dt(t),i=t.onDestroy;return t.onDestroy=t=>{this.untrack(t),i&&i(t)},e.open(),this.track(e),e}getAllDialogs(){return Array.from(t.openDialogs)}closeAllDialogs(){for(const e of Array.from(t.openDialogs))e.close()}};ft.openDialogs=[];let yt=class{constructor(t,e){this.options=t,this.submitHandler=t=>!(this.options.onSubmit&&!1===this.options.onSubmit(this,t)||(this.destroy(),0)),this.cancelHandler=()=>{this.options.onCancel&&this.options.onCancel(this),this.destroy()},this.keydownHandler=t=>13!=t.keyCode||!this.isActiveDialog()||(t.preventDefault(),t.stopPropagation(),!this.submitHandler())||(window.removeEventListener("keydown",this.keydownHandler,!1),!1),this.dialogId=E.generateId("dlg"),this.data=e,this.slot=Y("div",document.body).attr("tab-index","-1").data("dialog-id",this.dialogId).addClass(`${mt}-modal`,"is-active").focus().addChild("div",(t=>t.addClass("kdlg-modal-background"))).addChild("div",(i=>this.windowElement=i.addClass(`${mt}-modal-window`).addChild("header",(e=>{this.headerElement=e.addClass(`${mt}-header`).addChild("p",(e=>e.addClass(`${mt}-header-title`).addText(t.title))).toDOM(),!1!==t.closable&&e.addChild("button",(t=>t.addClass(`${mt}-modal-close`).on("click",(()=>{this.cancelHandler()})).focus()))})).addChild("div",(t=>{t.addClass(`${mt}-alert-container`),this.alertElement=t.toDOM()})).addChild("section",(i=>{if(this.bodyElement=i.addClass(`${mt}-body`).toDOM(),"string"==typeof t.body){const s=S.renderLiquidTemplate(t.body,e);i.addHtml(s)}else i.addChildElement(t.body)})).addChild("footer",(e=>{let i=null;i=t.footerAlignment&&t.footerAlignment==pt.Center?"align-center":"align-right",this.footerElement=e.addClass(`${mt}-footer`).toDOM(),e.addClass(i),!1!==t.submitable&&(e.addChild("button",(e=>{e.id(this.dialogId+"-btn-submit").addClass("kfrm-button","is-info").addText(t.submitButtonText||x.getText("ButtonOK")),t.recaptchaSiteKey?(e.data("sitekey",t.recaptchaSiteKey),e.addClass("g-recaptcha"),e.on("click",(e=>{grecaptcha?grecaptcha.ready((()=>{grecaptcha.execute(t.recaptchaSiteKey,{action:"submit"}).then((t=>{this.submitHandler(t)}))})):this.submitHandler()}))):e.on("click",(t=>{this.submitHandler()})),e.focus()})),!1!==t.cancelable&&e.addChild("button",(e=>e.id(this.dialogId+"-btn-cancel").addClass("kfrm-button").addText(t.cancelButtonText||x.getText("ButtonCancel")).on("click",(t=>{this.cancelHandler()})))))})).toDOM())).toDOM()}getData(){return this.data}getRootElement(){return this.slot}getSubmitButtonElement(){return document.getElementById(this.dialogId+"-btn-submit")}getCancelButtonElement(){return document.getElementById(this.dialogId+"-btn-cancel")}open(){this.options.beforeOpen&&this.options.beforeOpen(this),Y(this.slot).show(),this.options.arrangeParents&&this.arrangeParents(!0);const t=this.slot.querySelector(`.${mt}-modal-window`);this.options.height&&(t.style.height="string"==typeof this.options.height?this.options.height:`${this.options.height}px`),this.options.width&&(t.style.width="string"==typeof this.options.width?this.options.width:`${this.options.width}px`),this.options.submitOnEnter&&window.addEventListener("keydown",this.keydownHandler,!1),this.slot.querySelectorAll("input").forEach((t=>t.addEventListener("input",(()=>{this.clearAlert(),this.options.onInput&&this.options.onInput(this)})))),this.options.onShow&&this.options.onShow(this)}submit(){this.submitHandler()}cancel(){this.cancelHandler()}close(){this.destroy()}disableButtons(){this.slot.querySelectorAll("button").forEach((t=>t.disabled=!0))}enableButtons(){this.slot.querySelectorAll("button").forEach((t=>t.disabled=!1))}showAlert(t,e,i){let s=Y("div").addClass(`${mt}-alert ${e||""}`).addChild("span",(t=>t.addClass(`${mt}-alert-closebtn`).text("×").on("click",(t=>{const e=t.target.parentElement;e.parentElement.removeChild(e)})))).addText(t).toDOM();!0===i&&this.clearAlert(),this.alertElement.appendChild(s)}clearAlert(){this.alertElement.innerHTML=""}destroy(){document.querySelectorAll(`[data-dialog-id="${this.dialogId}"]`).length<=0||(this.options.arrangeParents&&this.arrangeParents(!1),document.body.removeChild(this.slot),this.options.submitOnEnter&&window.removeEventListener("keydown",this.keydownHandler,!1),this.options.onDestroy&&this.options.onDestroy(this))}isActiveDialog(){const t=document.documentElement.querySelectorAll(".kdlg-modal");return t[t.length-1]===this.slot}arrangeParents(t){const e=document.documentElement.querySelectorAll(".kdlg-modal-window");for(let i=0;i<e.length-1;i++)if(t){const t=0==i?20:40*i+20;Y(e[i]).setStyle("margin-top",`${t}px`).setStyle("margin-left",`${t}px`)}else Y(e[i]).removeStyle("margin-top").removeStyle("margin-left")}},Dt=class extends yt{constructor(t,e){let i,s;const n=Y("div").addChild("div",(e=>i=e.text(t.content||"").toDOM())).addChild("div",(e=>{e.addClass(`${mt}-progress-line`).addChild("div",(e=>{s=e.addClass("fill").toDOM(),t.determinated?e.setStyle("width","0%"):e.addClass("indeterminate")}))})).toDOM();super({title:t.title,body:n,beforeOpen:t.beforeOpen,onSubmit:t.onSubmit,width:t.width,height:t.height,submitable:!1,cancelable:!1,closable:!1,onDestroy:t.onDestroy},e),this.contentElement=i,this.progressElement=s}updateContent(t){this.contentElement.innerText=t}updateProgress(t){t=this.in01(t),this.progressElement.style.width=100*t+"%",1===t&&setTimeout((()=>{this.submit()}),500)}in01(t){return t>1?1:t<0?0:t}},wt=class{constructor(t,e){this.options=t,this.dialogService=e,this.currentDialog=null,this.currentIndex=0,this.options=t,this.dialogService=e}getCurrent(){return this.currentDialog}openNext(t){return this.open(this.currentIndex+1,t)}openPrev(t){return this.open(this.currentIndex-1,t)}open(t,e){if(t<0?this.currentIndex=0:t>=this.options.length?this.currentIndex=this.options.length-1:this.currentIndex=t,this.currentDialog)try{this.currentDialog.close()}catch(t){}const i=this.options[this.currentIndex];return this.currentDialog=this.dialogService.open(i,e),this.currentDialog}close(){this.currentDialog&&(this.currentDialog.close(),this.currentDialog=null)}};var vt,Ct;x.updateDefaultTexts({GridPageInfo:"{FirstPageRecordNum} - {LastPageRecordNum} of {Total} records",GridItemsPerPage:"items per page",ButtonOK:"OK",ButtonCancel:"Cancel",ButtonApply:"Apply",ButtonNow:"Now",LblTotal:"Total"}),function(t){t[t.THIS_WEEK=0]="THIS_WEEK",t[t.LAST_WEEK=1]="LAST_WEEK",t[t.THIS_MONTH=2]="THIS_MONTH",t[t.FIRST_MONTH=3]="FIRST_MONTH",t[t.LAST_MONTH=4]="LAST_MONTH",t[t.THIS_YEAR=5]="THIS_YEAR",t[t.QUARTER_1=6]="QUARTER_1",t[t.QUARTER_2=7]="QUARTER_2",t[t.QUARTER_3=8]="QUARTER_3",t[t.QUARTER_4=9]="QUARTER_4"}(vt||(vt={})),function(t){t.UNDEF="-1",t.TODAY="1",t.YESTERDAY="2",t.TOMORROW="3",t.WEEK_START="4",t.WEEK_END="5",t.MONTH_START="6",t.MONTH_END="7",t.YEAR_START="8",t.YEAR_END="9"}(Ct||(Ct={}));let Tt=class extends yt{constructor(t){super({title:t.title||"Select a period",body:"",submitButtonText:t.submitButtonText||"OK",cancelButtonText:t.cancelButtonText||"Cancel",submitable:!0,closable:!0,cancelable:!0,beforeOpen:t=>{this.setupDialog()},onSubmit:e=>{"function"==typeof t.onSubmit&&t.onSubmit.apply(e,[this.result(this.from),this.result(this.to)])}}),this.yearRange=t.yearRange,this.weekStart=t.weekStart||0,this.bodyElement.append(this.drawDialog()),this.calendar1.render(),this.calendar2.render(),this.from=this.alignDate(t.start?t.start:new Date),this.to=this.alignDate(t.finish&&this.alignDate(t.finish)>this.from?t.finish:new Date(this.from.getFullYear(),this.from.getMonth(),this.from.getDate()+1)),this.represent()}alignDate(t){return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}drawDialog(){const t=Y("div").addClass("tsp__container").addChild("div",(t=>{t.addClass("tsp__intervals").addChild("button",(t=>t.addClass("tsp__button").addText("This Week").on("click",(()=>{this.select(vt.THIS_WEEK)})))).addChild("button",(t=>t.addClass("tsp__button").addText("Last Week").on("click",(()=>{this.select(vt.LAST_WEEK)})))).addChild("button",(t=>t.addClass("tsp__button").addText("This Month").on("click",(()=>{this.select(vt.THIS_MONTH)})))).addChild("button",(t=>t.addClass("tsp__button").addText("First Month").on("click",(()=>{this.select(vt.FIRST_MONTH)})))).addChild("button",(t=>t.addClass("tsp__button").addText("Last Month").on("click",(()=>{this.select(vt.LAST_MONTH)})))).addChild("button",(t=>t.addClass("tsp__button").addText("This Year").on("click",(()=>{this.select(vt.THIS_YEAR)})))).addChild("button",(t=>t.addClass("tsp__button").addText("Quarter 1").on("click",(()=>{this.select(vt.QUARTER_1)})))).addChild("button",(t=>t.addClass("tsp__button").addText("Quarter 2").on("click",(()=>{this.select(vt.QUARTER_2)})))).addChild("button",(t=>t.addClass("tsp__button").addText("Quarter 3").on("click",(()=>{this.select(vt.QUARTER_3)})))).addChild("button",(t=>t.addClass("tsp__button").addText("Quarter 4").on("click",(()=>{this.select(vt.QUARTER_4)}))))})).addChild("div",(t=>{t.addClass("tsp__form").addChild("div",(t=>{t.addClass("tsp__date").addChild("div",(t=>{t.addClass("tsp__label").addChild("label",(t=>{t.addText("Start")})).addChild("select",(t=>{t.addOption({value:Ct.UNDEF,title:"Jump To"}).addOption({value:Ct.TODAY,title:"Today"}).addOption({value:Ct.YESTERDAY,title:"Yesterday"}).addOption({value:Ct.TOMORROW,title:"Tomorrow"}).addOption({value:Ct.WEEK_START,title:"Week Start"}).addOption({value:Ct.WEEK_END,title:"Week End"}).addOption({value:Ct.MONTH_START,title:"Month Start"}).addOption({value:Ct.MONTH_END,title:"Month End"}).addOption({value:Ct.YEAR_START,title:"Year Start"}).addOption({value:Ct.YEAR_END,title:"Year End"}),t.on("change",(t=>{this.jump(1,t.target.value,t.target)}))}))})).addChild("div",(t=>{t.addClass("tsp__calendar"),this.calendar1=new ct(t.toDOM(),{yearRange:this.yearRange,showDateTimeInput:!0,onDateChanged:t=>{this.from=this.alignDate(t),this.calendar1.setDate(this.from),this.to<this.from&&(this.to=this.from),this.represent()},onDrawDay:(t,e)=>{this.alignDate(e)>=this.from&&this.alignDate(e)<=this.to?t.classList.add("day-in-range"):t.classList.remove("day-in-range")}})}))})).addChild("div",(t=>{t.addClass("tsp__date").addChild("div",(t=>{t.addClass("tsp__label").addChild("label",(t=>{t.addText("Finish")})).addChild("select",(t=>{t.addOption({value:Ct.UNDEF,title:"Jump To"}).addOption({value:Ct.TODAY,title:"Today"}).addOption({value:Ct.YESTERDAY,title:"Yesterday"}).addOption({value:Ct.TOMORROW,title:"Tomorrow"}).addOption({value:Ct.WEEK_START,title:"Week Start"}).addOption({value:Ct.WEEK_END,title:"Week End"}).addOption({value:Ct.MONTH_START,title:"Month Start"}).addOption({value:Ct.MONTH_END,title:"Month End"}).addOption({value:Ct.YEAR_START,title:"Year Start"}).addOption({value:Ct.YEAR_END,title:"Year End"}),t.on("change",(t=>{this.jump(2,t.target.value,t.target)}))}))})).addChild("div",(t=>{t.addClass("tsp__calendar"),this.calendar2=new ct(t.toDOM(),{yearRange:this.yearRange,showDateTimeInput:!0,onDateChanged:t=>{this.alignDate(t)>=this.from?this.to=this.alignDate(t):this.calendar2.setDate(this.to),this.represent()},onDrawDay:(t,e)=>{this.alignDate(e)>=this.from&&this.alignDate(e)<=this.to?t.classList.add("day-in-range"):t.classList.remove("day-in-range")}})}))}))})).toDOM();return t}setupDialog(){}jump(t,e,i){let s,n=1===t?"from":"to";const a=new Date;switch(e){case Ct.TODAY:s=a;break;case Ct.YESTERDAY:s=new Date(a.getFullYear(),a.getMonth(),a.getDate()-1);break;case Ct.TOMORROW:s=new Date(a.getFullYear(),a.getMonth(),a.getDate()+1);break;case Ct.WEEK_START:s=new Date(a.setDate(a.getDate()-a.getDay()+this.weekStart));break;case Ct.WEEK_END:s=new Date(a.setDate(a.getDate()-a.getDay()+6+this.weekStart));break;case Ct.MONTH_START:s=new Date(a.getFullYear(),a.getMonth(),1);break;case Ct.MONTH_END:s=new Date(a.getFullYear(),a.getMonth()+1,0);break;case Ct.YEAR_START:s=new Date(a.getFullYear(),0,1);break;case Ct.YEAR_END:s=new Date(a.getFullYear(),12,0)}s=this.alignDate(s),i.value=Ct.UNDEF,"from"===n?(this.from=s,this.to<this.from&&(this.to=this.from)):s>=this.from&&(this[n]=s),this.represent()}represent(){this.calendar1.setDate(this.from),this.calendar2.setDate(this.to)}select(t){switch(t){case vt.THIS_WEEK:{const t=new Date;this.from=new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()),this.to=new Date(this.from.getFullYear(),this.from.getMonth(),this.from.getDate()+6);break}case vt.LAST_WEEK:{const t=new Date;this.from=new Date(t.getFullYear(),t.getMonth(),t.getDate()-t.getDay()-7),this.to=new Date(this.from.getFullYear(),this.from.getMonth(),this.from.getDate()+6);break}case vt.THIS_MONTH:{const t=new Date;this.from=new Date(t.getFullYear(),t.getMonth(),1),this.to=new Date(t.getFullYear(),t.getMonth()+1,0);break}case vt.FIRST_MONTH:{const t=new Date;this.from=new Date(t.getFullYear(),0,1),this.to=new Date(t.getFullYear(),1,0);break}case vt.LAST_MONTH:{const t=new Date;this.from=new Date(t.getFullYear(),t.getMonth()-1,1),this.to=new Date(t.getFullYear(),t.getMonth(),0);break}case vt.THIS_YEAR:{const t=new Date;this.from=new Date(t.getFullYear(),0,1),this.to=new Date(t.getFullYear(),12,0);break}case vt.QUARTER_1:{const t=new Date;this.from=new Date(t.getFullYear(),0,1),this.to=new Date(t.getFullYear(),3,0);break}case vt.QUARTER_2:{const t=new Date;this.from=new Date(t.getFullYear(),3,1),this.to=new Date(t.getFullYear(),6,0);break}case vt.QUARTER_3:{const t=new Date;this.from=new Date(t.getFullYear(),6,1),this.to=new Date(t.getFullYear(),9,0);break}case vt.QUARTER_4:{const t=new Date;this.from=new Date(t.getFullYear(),9,1),this.to=new Date(t.getFullYear(),12,0);break}}this.represent()}result(t){const e=this.alignDate(new Date),i={Today:this.alignDate(new Date),Yesterday:this.alignDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()-1)),Tomorrow:this.alignDate(new Date(e.getFullYear(),e.getMonth(),e.getDate()+1)),FirstDayOfMonth:this.alignDate(new Date(e.getFullYear(),e.getMonth(),1)),LastDayOfMonth:this.alignDate(new Date(e.getFullYear(),e.getMonth()+1,0)),FirstDayOfWeek:this.alignDate(new Date(e.setDate(e.getDate()-e.getDay()+this.weekStart))),FirstDayOfYear:this.alignDate(new Date(e.getFullYear(),0,1)),FirstDayOfNextWeek:this.alignDate(new Date(e.setDate(e.getDate()-e.getDay()+this.weekStart+7))),FirstDayOfNextMonth:this.alignDate(new Date(e.getFullYear(),e.getMonth()+1,1)),FirstDayOfNextYear:this.alignDate(new Date(e.getFullYear()+1,0,1))};for(let e in i)if(console.log(i[e],t),i[e].getTime()===t.getTime())return`\${{${e}}}`;return x.dateTimeToStr(t,x.getLocaleSettings().editDateFormat)}};const bt=new ft;var Et,xt,It=Object.freeze({__proto__:null,get AutoResizeColumns(){return X},Calendar:ht,get CellRendererType(){return st},DFMT_REGEX:it,DateTimePicker:dt,DefaultCalendar:ct,DefaultDateTimePicker:class extends dt{render(){const t=Y("div",document.body).addClass(`${this.cssPrefix}`).attr("tabIndex","0").setStyle("position","absolute").setStyle("top","-1000px").setStyle("left","-1000px").on("keydown",(t=>(27===t.keyCode?this.cancel():13===t.keyCode&&this.apply(this.getDateTime()),!1)));this.options.zIndex&&t.setStyle("z-index",`${this.options.zIndex}`),this.slot=t.toDOM(),super.render(),this.renderButtons(),this.globalMouseDownHandler=t=>{let e=window.event||t;return e.srcElement||e.target,!this.slot.contains(e.target)&&(document.removeEventListener("mousedown",this.globalMouseDownHandler,!0),this.cancel()),!0}}renderButtons(){const t=Y("div",this.slot).addClass(`${this.cssPrefix}-buttons`).addChild("button",(t=>this.nowButton=t.addClass(`${this.cssPrefix}-button ${this.cssPrefix}-button-now`).text(x.getText("ButtonNow")).on("click",(()=>(this.setDateTime(new Date),this.dateTimeChanged(),!1))).toDOM()));!this.options.showTimePicker&&this.options.oneClickDateSelection||t.addChild("button",(t=>this.submitButton=t.addClass(`${this.cssPrefix}-button ${this.cssPrefix}-button-apply`).text(x.getText("ButtonApply")).on("click",(()=>(this.apply(this.getDateTime()),!1))).toDOM())),t.addChild("button",(t=>this.submitButton=t.addClass(`${this.cssPrefix}-button ${this.cssPrefix}-button-cancel`).text(x.getText("ButtonCancel")).on("click",(()=>(this.cancel(),!1))).toDOM()))}createCalendar(t){return this.calendarSlot=Y("div",this.slot).addClass(`${this.cssPrefix}-cal`).toDOM(),new ct(this.calendarSlot,t)}createTimePicker(t){return this.timePickerSlot=Y("div",this.slot).addClass(`${this.cssPrefix}-tp`).toDOM(),new gt(this.timePickerSlot,t)}show(t){if(this.options.showDateTimeInput){this.options.beforeShow&&this.options.beforeShow();const e=F(t||document.body),i=F(t?t.parentElement||t:document.body);this.slot.style.top=i.y+"px",this.slot.style.left=e.x+"px"}else super.show(t),this.slot.focus();setTimeout((()=>{document.addEventListener("mousedown",this.globalMouseDownHandler,!0)}),1)}},DefaultDialog:yt,DefaultDialogService:ft,DefaultDialogSet:wt,DefaultProgressDialog:Dt,DefaultTimePicker:gt,get DialogFooterAlignment(){return pt},DomElementBuilder:_,DomInputElementBuilder:V,DomSelectElementBuilder:G,DomTextAreaElementBuilder:W,DragManager:K,get DropEffect(){return U},EasyGrid:class{constructor(t){if(this.cssPrefix="keg",this.pagination={page:1,pageSize:30,total:0},this.paginationOptions={maxButtonCount:10,useBootstrap:!1},this.defaultDataGridOptions={slot:null,dataTable:null,fixHeightOnFirstRender:!1,syncGridColumns:!0,useRowNumeration:!0,allowDragDrop:!1,aggregates:{settings:null,calculator:null},paging:{enabled:!0,pageSize:30,pageSizeItems:[20,30,50,100,200]},columnWidths:{autoResize:X.Always,stringColumns:{min:100,max:500,default:250},numberColumns:{min:60,default:120},boolColumns:{min:50,default:80},dateColumns:{min:80,default:200},otherColumns:{min:100,max:500,default:250},rowNumColumn:{min:40,default:60}},showPlusButton:!1,viewportRowsCount:null,showActiveRow:!0},this.rowsOnPagePromise=null,this.containerInitialHeight=0,this.firstRender=!0,this.prevRowTotals=null,this.landingIndex=-1,this.landingSlot=Y("div").addClass(`${this.cssPrefix}-col-landing-slot`).addChildElement(Y("div").toDOM()).toDOM(),this._activeRowIndex=-1,t&&t.paging&&(t.paging=E.assign(this.defaultDataGridOptions.paging,t.paging)),this.options=this.mergeOptions(t),this.processColumnWidthsOptions(),!this.options.slot)throw Error('"slot" parameter is required to initialize EasyDataGrid');if(!this.options.dataTable)throw Error('"dataTable" parameter is required to initialize EasyDataGrid');this.dataTable=t.dataTable,this.eventEmitter=new k(this),this.cellRendererStore=new lt(t),this.columns=new tt(this.dataTable.columns,this),this.setSlot(this.options.slot),this.init(this.options)}mergeOptions(t){const e=E.assignDeep({},this.defaultDataGridOptions.columnWidths,t.columnWidths),i=E.assignDeep({},this.defaultDataGridOptions.paging,t.paging),s=E.assign({},this.defaultDataGridOptions,t);return s.columnWidths=e,s.paging=i,s}processColumnWidthsOptions(){const t=this.options.columnWidths;if(!t)return;E.getStringDataTypes().forEach((e=>{t[e]=Object.assign(Object.assign({},t.stringColumns),t[e])})),E.getNumericDataTypes().forEach((e=>{t[e]=Object.assign(Object.assign({},t.numberColumns),t[e])})),t[C.Bool]=Object.assign(Object.assign({},t.boolColumns),t[C.Bool]),E.getDateDataTypes().forEach((e=>{t[e]=Object.assign(Object.assign({},t.dateColumns),t[e])}));const e=[...E.getStringDataTypes(),...E.getNumericDataTypes(),...E.getDateDataTypes(),C.Bool];E.getAllDataTypes().forEach((i=>{i in e||(t[i]=Object.assign(Object.assign({},t.otherColumns),t[i]))})),t[C.Unknown]=t.otherColumns}setSlot(t){if("string"==typeof t){if(t.length)if("#"===t[0])this.slot=document.getElementById(t.substring(1));else{if("."!==t[0])throw Error("Unrecognized slot parameter (Must be id, class or HTMLElement): "+t);{const e=document.getElementsByClassName(t.substring(1));e.length&&(this.slot=e[0])}}}else this.slot=t}init(t){t.onInit&&this.addEventListener("init",t.onInit),t.onRowClick&&this.addEventListener("rowClick",t.onRowClick),t.onRowDbClick&&this.addEventListener("rowDbClick",t.onRowDbClick),t.onPlusButtonClick&&this.addEventListener("plusButtonClick",t.onPlusButtonClick),t.onColumnChanged&&this.addEventListener("columnChanged",t.onColumnChanged),t.onColumnDeleted&&this.addEventListener("columnDeleted",t.onColumnDeleted),t.onColumnMoved&&this.addEventListener("columnMoved",t.onColumnMoved),t.onPageChanged&&this.addEventListener("pageChanged",t.onPageChanged),t.onActiveRowChanged&&this.addEventListener("activeRowChanged",t.onActiveRowChanged),this.addEventListener("pageChanged",(t=>this.activeRowIndex=-1)),E.assignDeep(this.paginationOptions,t.pagination),this.pagination.pageSize=this.options.paging.pageSize||this.pagination.pageSize,this.options.allowDragDrop&&J.registerDropContainer({element:this.slot,scopes:["gridColumnMove"],onDragEnter:(t,e)=>{this.slot.classList.add(`${B}-drophover`),this.showLandingSlot(e.pageX,e.pageY)},onDragOver:(t,e)=>{this.showLandingSlot(e.pageX,e.pageY)},onDragLeave:(t,e)=>{e.dropEffect=U.Forbid,this.slot.classList.remove(`${B}-drophover`),this.hideLandingSlot()},onDrop:(t,e)=>{this.dataTable.columns.move(e.data.column,this.landingIndex),this.refresh(),this.fireEvent({type:"columnMoved",columnId:e.data.column.id,newIndex:this.landingIndex})}}),this.refresh(),this.fireEvent("init")}fireEvent(t){"string"==typeof t?this.eventEmitter.fire(t):this.eventEmitter.fire(t.type,t)}setData(t){this.dataTable=t,this.clear(),this.refresh()}getData(){return this.dataTable}getColumns(){return this.columns}destroy(){this.slot.innerHTML=""}refresh(){this.clearDOM(),this.render()}clearDOM(){this.slot.innerHTML=""}clear(){this.pagination.page=1,this.clearDOM()}render(){if(!this.hasData()&&!this.options.showPlusButton)return;this.containerInitialHeight=this.slot.clientHeight,this.rootDiv=document.createElement("div"),this.rootDiv.style.width="100%",this.rootDiv.classList.add(`${this.cssPrefix}-root`),this.columns.sync(this.dataTable.columns,this.options.useRowNumeration),this.renderHeader(),this.rootDiv.appendChild(this.headerDiv),this.renderBody(),this.rootDiv.appendChild(this.bodyDiv),this.renderFooter(),this.rootDiv.appendChild(this.footerDiv);let t=document.createElement("div");t.classList.add(`${this.cssPrefix}-container`),t.appendChild(this.rootDiv),this.slot.appendChild(t);const e=this.options.columnWidths.autoResize!==X.Never;this.rowsOnPagePromise?this.rowsOnPagePromise.then((()=>this.updateHeight())).then((()=>{this.firstRender=!1,this.rowsOnPagePromise=null})):setTimeout((()=>{this.updateHeight().then((()=>{this.firstRender=!1,e&&this.resizeColumns()}))}),100)}updateHeight(){return new Promise((t=>{if(this.options.viewportRowsCount){const e=this.bodyCellContainerDiv.firstElementChild;let i=(e?e.offsetHeight:36)*this.options.viewportRowsCount;return Y(this.bodyViewportDiv).setStyle("height",`${i}px`),void setTimeout((()=>{const e=this.bodyViewportDiv.offsetHeight-this.bodyViewportDiv.clientHeight;i+=e,Y(this.bodyViewportDiv).setStyle("height",`${i}px`),t()}),100)}this.containerInitialHeight,t()})).then((()=>{this.options.fixHeightOnFirstRender&&this.firstRender&&(this.slot.style.height=`${this.slot.offsetHeight}px`)}))}getContainerWidth(){return this.columns.getItems().filter((t=>t.isVisible)).map((t=>t.width)).reduce(((t,e)=>t+e))}renderHeader(){this.headerDiv=Y("div").addClass(`${this.cssPrefix}-header`).toDOM(),this.headerViewportDiv=Y("div",this.headerDiv).addClass(`${this.cssPrefix}-header-viewport`).toDOM(),this.headerCellContainerDiv=Y("div",this.headerViewportDiv).addClass(`${this.cssPrefix}-header-cell-container`).toDOM(),this.headerRowDiv=Y("div",this.headerCellContainerDiv).addClass(`${this.cssPrefix}-header-row`).toDOM(),this.columns.getItems().forEach(((t,e)=>{if(!t.isVisible)return;let i=this.renderColumnHeader(t,e);this.headerRowDiv.appendChild(i),t.isRowNum&&Y(i).addChildElement(this.renderHeaderButtons())}));const t=this.getContainerWidth();Y(this.headerCellContainerDiv).setStyle("width",`${t}px`)}hasData(){return this.dataTable.columns.count>0}renderColumnHeader(t,e){let i=Y("div").addClass(`${this.cssPrefix}-header-cell`).data("col-idx",`${e}`).setStyle("width",`${t.width}px`);t.dataColumn&&i.data("col-id",`${t.dataColumn.id}`);let s=i.toDOM();return Y("div",s).addClass(`${this.cssPrefix}-header-cell-resize`),t.isRowNum||Y("div",s).addClass(`${this.cssPrefix}-header-cell-label`).text(t.label),t.description&&Y("div",s).addClass("question-mark").title(t.description),this.options.allowDragDrop&&J.registerDraggableItem({element:s,scope:"gridColumnMove",data:{column:t},renderer:e=>{e.innerHTML="";const i=document.createElement("div");i.innerText=t.label,e.classList.add(`${this.cssPrefix}-sortable-helper`),e.appendChild(i)},onDragStart:t=>{t.dropEffect=U.Allow}}),s}renderBody(){this.bodyDiv=Y("div").addClass(`${this.cssPrefix}-body`).toDOM(),this.bodyViewportDiv=Y("div",this.bodyDiv).addClass(`${this.cssPrefix}-body-viewport`).attr("tabIndex","0").toDOM(),this.bodyCellContainerDiv=Y("div",this.bodyViewportDiv).addClass(`${this.cssPrefix}-cell-container`).toDOM();const t=this.canShowAggregates();this.dataTable&&(this.showProgress(),this.rowsOnPagePromise=this.getRowsToRender().then((e=>{this.pagination.total=this.dataTable.getTotal(),this.hideProgress(),this.bodyCellContainerDiv.innerHTML="",this.prevRowTotals=null;let i=0;if(e.length){const s=t?this.options.aggregates.settings.getGroups():[];i=e.length<this.pagination.pageSize?e.length:this.pagination.pageSize,e.forEach(((e,n)=>{if(t&&this.updateTotalsState(s,e),n<i){const t=this.renderRow(e,n);this.bodyCellContainerDiv.appendChild(t)}}));const n=this.options.aggregates&&this.options.aggregates.showGrandTotalsOnEachPage;if(t&&(this.isLastPage()||n)){const t=new O(this.dataTable.columns,new Array(this.dataTable.columns.count));this.updateTotalsState(s,t,!0)}}if(this.options.columnWidths.autoResize!==X.Never)this.resizeColumns();else{const t=this.getContainerWidth();Y(this.bodyCellContainerDiv).setStyle("width",`${t}px`)}return i})).catch((t=>(console.error(t),0)))),this.bodyViewportDiv.addEventListener("scroll",(t=>{Y(this.headerViewportDiv).setStyle("margin-left",`-${this.bodyViewportDiv.scrollLeft}px`)})),this.bodyViewportDiv.addEventListener("keydown",this.onViewportKeydown.bind(this))}isLastPage(){return this.dataTable.elasticChunks?this.dataTable.totalIsKnown()&&this.pagination.page*this.pagination.pageSize>=this.pagination.total:this.pagination.page*this.pagination.pageSize>=this.pagination.total}canShowAggregates(){if(!this.options||!this.options.aggregates||!this.options.aggregates.settings)return!1;const t=this.options.aggregates.settings;return(t.hasAggregates()||t.hasRecordCount())&&(t.hasGroups()||t.hasGrandTotals())}updateTotalsState(t,e,i=!1){const s=this.options.aggregates.settings;if(this.prevRowTotals&&s.hasGroups()){let i=-1;for(let n=1;n<=t.length;n++){const a=t[n-1];for(const t of a.columns)if(!s.compareValues(this.prevRowTotals.getValue(t),e.getValue(t))){i=n;break}if(-1!==i)break}if(-1!==i)for(let e=t.length;e>=i;e--){const t=new O(this.dataTable.columns,this.prevRowTotals.toArray()),i=this.renderTotalsRow(e,t);this.bodyCellContainerDiv.appendChild(i)}}if(i&&s.hasGrandTotals()&&s.hasAggregates()){const t=this.renderTotalsRow(0,e);this.bodyCellContainerDiv.appendChild(t)}this.prevRowTotals=e}applyGroupColumnTemplate(t,e,i){let s=t.replace(/{{\s*GroupValue\s*}}/g,e?`${e}`:"-");return s=s.replace(/{{\s*GroupCount\s*}}/g,i?`${i}`:"-"),s}renderTotalsRow(t,e){const i=this.options.aggregates.settings,s=t>0?i.getGroups()[t-1]:{columns:[],aggregates:i.getAggregates()},n=Y("div").addClass(`${this.cssPrefix}-row`).addClass(`${this.cssPrefix}-row-totals`).addClass(`${this.cssPrefix}-totals-lv${t}`).data("totals-level",`${t}`).attr("tabindex","-1").toDOM();this.columns.getItems().forEach(((t,i)=>{if(!t.isVisible)return;let a="";const o=t.isRowNum?-1:this.dataTable.columns.getIndex(t.dataColumn.id);!t.isRowNum&&t.dataColumn&&s.columns.indexOf(t.dataColumn.id)>=0&&(a=e.getValue(o)),o==this.dataTable.columns.count-1&&(a=".  .  .  .  .  ."),n.appendChild(this.renderCell(t,i,a,n))}));const a=this.options.aggregates.calculator.getAggrContainer(),o=i.getAggregates().map((t=>t.colId)),r=i.buildGroupKey(s,e);return a.getAggregateData(t,r).then((a=>{for(const t of o)e.setValue(t,a[t]);n.innerHTML="",this.columns.getItems().forEach(((r,l)=>{if(!r.isVisible)return;let h="";const d=r.isRowNum?-1:this.dataTable.columns.getIndex(r.dataColumn.id);if(!r.isRowNum){let c=!1;if(r.dataColumn){const i=s.columns.indexOf(r.dataColumn.id),n=o.indexOf(r.dataColumn.id);c=t>0?i==s.columns.length-1:0==d,(i>=0||n>=0)&&(h=e.getValue(d))}let u="";t>0&&(u=r.dataColumn.groupFooterColumnTemplate,!u&&i.hasRecordCount()&&c&&(u="{{GroupValue}} ({{GroupCount}})")),u&&(h=this.renderCell(r,l,h,n).firstChild.innerHTML,h=this.applyGroupColumnTemplate(u,h,a[i.COUNT_FIELD_NAME]))}const c=this.renderCell(r,l,h,n);n.appendChild(c)}))})).catch((t=>console.error(t))),n}onViewportKeydown(t){if(this.options.showActiveRow){const e=this.bodyCellContainerDiv.querySelectorAll(`.${this.cssPrefix}-row`).length;let i;switch(t.key){case"ArrowLeft":case"ArrowRight":break;case"ArrowUp":t.preventDefault(),i=this.activeRowIndex<0||this.activeRowIndex>=e?e-1:this.activeRowIndex-1,this.activeRowIndex=i>=0?i:0;break;case"ArrowDown":t.preventDefault(),i=this.activeRowIndex<0||this.activeRowIndex>=e?0:this.activeRowIndex+1,this.activeRowIndex=i<e?i:e-1}}}ensureRowVisibility(t){const e="number"==typeof t?this.getDataRow(t):t;if(e){let t=e.getBoundingClientRect();const i=this.bodyViewportDiv.getBoundingClientRect(),s=t.top-i.top,n=t.bottom-i.top,a=this.bodyViewportDiv.clientHeight,o=window.innerHeight||document.documentElement.clientHeight;if(s>0&&n<=a&&t.top>0&&t.bottom<o)return;s<0?this.bodyViewportDiv.scrollTop=this.bodyViewportDiv.scrollTop+s:n>a&&(this.bodyViewportDiv.scrollTop=this.bodyViewportDiv.scrollTop+n-a),t=e.getBoundingClientRect(),t.top<0?document.documentElement.scrollTop=document.documentElement.scrollTop+t.top:t.bottom>o&&(document.documentElement.scrollTop=document.documentElement.scrollTop+t.bottom-o)}}getRowsToRender(){return!1===this.options.paging.enabled?Promise.resolve(this.dataTable.getCachedRows()):this.dataTable.getRows({offset:(this.pagination.page-1)*this.pagination.pageSize,limit:this.pagination.pageSize+1}).catch((t=>(console.error(t),[])))}renderFooter(){this.footerDiv=Y("div").addClass(`${this.cssPrefix}-footer`).toDOM(),this.rowsOnPagePromise&&this.rowsOnPagePromise.then((t=>{this.footerDiv.innerHTML="",this.footerPaginateDiv=this.renderPageNavigator(),this.footerDiv.appendChild(this.footerPaginateDiv);const e=this.renderPageInfoBlock(t);this.footerDiv.appendChild(e)}))}renderPageInfoBlock(t){const e=Y("div").addClass(`${this.cssPrefix}-page-info`).toDOM();if(this.dataTable.getTotal()>0){const i=t?(this.pagination.page-1)*this.pagination.pageSize+1:0,s=t?i+t-1:0;let n=this.dataTable.getTotal().toString();this.dataTable.elasticChunks&&this.dataTable.getCachedCount()!==this.dataTable.getTotal()&&(n="?"),e.innerHTML=x.getText("GridPageInfo").replace("{FirstPageRecordNum}",`<span>${i.toString()}</span>`).replace("{LastPageRecordNum}",`<span>${s.toString()}</span>`).replace("{Total}",`<span>${n}</span>`)}return e}showProgress(){}hideProgress(){}getLocalIndexByGlobal(t){return this.pagination?t%this.pagination.pageSize:t}getGlobalIndexByLocal(t){return this.pagination?(this.pagination.page-1)*this.pagination.pageSize+t:t}renderRow(t,e){let i=this.getGlobalIndexByLocal(e),s=Y("div").addClass(`${this.cssPrefix}-row`).addClass(`${this.cssPrefix}-row-${e%2==1?"odd":"even"}`).data("row-idx",`${i}`).attr("tabindex","-1").on("click",(i=>{this.activeRowIndex=e,this.fireEvent({type:"rowClick",row:t,rowIndex:e,sourceEvent:i})})).on("dblclick",(i=>{this.fireEvent({type:"rowDbClick",row:t,rowIndex:e,sourceEvent:i})}));0==e&&s.addClass(`${this.cssPrefix}-row-first`);let n=s.toDOM();return this.options.showActiveRow&&e==this.activeRowIndex&&s.addClass(`${this.cssPrefix}-row-active`),this.columns.getItems().forEach(((e,s)=>{if(!e.isVisible)return;const a=e.isRowNum?-1:this.dataTable.columns.getIndex(e.dataColumn.id);let o=e.isRowNum?i+1:t.getValue(a);n.appendChild(this.renderCell(e,s,o,n))})),n}renderCell(t,e,i,s){const n=Y("div").addClass(`${this.cssPrefix}-cell`).data("col-idx",`${e}`).attr("tabindex","-1").setStyle("width",`${t.width}px`);t.align==Q.LEFT?n.addClass(`${this.cssPrefix}-cell-align-left`):t.align==Q.RIGHT?n.addClass(`${this.cssPrefix}-cell-align-right`):t.align==Q.CENTER&&n.addClass(`${this.cssPrefix}-cell-align-center`);const a=n.toDOM(),o=a.appendChild(Y("div").addClass(`${this.cssPrefix}-cell-value`).toDOM()),r=this.getCellRenderer(t);return r&&r(i,t,o,s),a}getCellRenderer(t){let e;return e=t.isRowNum?this.cellRendererStore.getDefaultRendererByType(st.NUMBER):this.cellRendererStore.getDefaultRenderer(t.type),this.options&&this.options.onGetCellRenderer&&(e=this.options.onGetCellRenderer(t,e)||e),e}setPage(t){this.pagination.page=t,this.fireEvent({type:"pageChanged",page:t}),this.refresh(),this.bodyViewportDiv.focus()}renderPageNavigator(){let t=document.createElement("div");t.className=`${this.cssPrefix}-pagination-wrapper`;const e=this.dataTable.getTotal();if(this.options.paging&&this.options.paging.enabled&&e>0){const e=this.paginationOptions.useBootstrap?"":`${this.cssPrefix}-`,i=t=>{const e=t.target;if(e.hasAttribute("data-page")){const t=parseInt(e.getAttribute("data-page"));this.setPage(t)}},s=(t,s,n,a,o)=>{const r=document.createElement("li");if(r.className=`${e}page-item`,!a){o&&(r.className+=" active");const n=document.createElement("a");return n.setAttribute("href","javascript:void(0)"),n.innerHTML=s||t.toString(),n.setAttribute("data-page",`${t}`),n.className=`${e}page-link`,n.addEventListener("click",i),r.appendChild(n),r}let l=document.createElement("span");if(l.setAttribute("aria-hidden","true"),l.className=`${e}page-link`,n)r.className+=" disabled";else{if(this.paginationOptions.useBootstrap)l=document.createElement("a"),l.setAttribute("href","javascript:void(0)"),l.setAttribute("data-page",`${t}`);else{let e=document.createElement("a");e.setAttribute("href","javascript:void(0)"),e.setAttribute("data-page",`${t}`),l=e}l.className=`${e}page-link`,l.addEventListener("click",i)}return l.innerHTML=s,r.appendChild(l),r};if(this.dataTable.elasticChunks){const i=this.pagination.page||1;let n=document.createElement("ul");n.className=`${e}pagination`;let a=s(i-1,"&laquo;",1==i,!0,!1);n.appendChild(a),a=s(i+1,"&raquo;",this.isLastPage(),!0,!1),n.appendChild(a),t.appendChild(n)}else if(this.pagination.total>this.pagination.pageSize){const i=this.pagination.page||1,n=Math.ceil(this.pagination.total/this.pagination.pageSize)||1,a=this.paginationOptions.maxButtonCount||10,o=i-1;let r=o-o%a+1,l=r+a-1;l>n&&(l=n);let h=document.createElement("ul");h.className=`${e}pagination`;let d=s(r-1,"&laquo;",1==r,!0,!1);h.appendChild(d);for(let t=r;t<=l;t++)d=s(t,t.toString(),!1,!1,t==i),h.appendChild(d);d=s(l+1,"&raquo;",l==n,!0,!1),h.appendChild(d),t.appendChild(h)}if(this.options.paging.allowPageSizeChange){const e=t=>{const e=parseInt(t.target.value);this.pagination.pageSize=e,this.pagination.page=1,this.refresh()},i=document.createElement("div");i.className=`${this.cssPrefix}-page-sizes`;const s=document.createElement("div");s.className=`kfrm-select ${this.cssPrefix}-page-sizes-select`,i.appendChild(s);const n=document.createElement("select"),a=this.options.paging.pageSizeItems||[],o=new Set(a);o.add(this.options.paging.pageSize||20),Array.from(o).forEach((t=>{const e=document.createElement("option");e.value=t.toString(),e.text=t.toString(),n.appendChild(e)})),n.value=(this.pagination.pageSize||20).toString(),s.appendChild(n),n.addEventListener("change",e);const r=document.createElement("div");r.className=`${this.cssPrefix}-page-sizes-label`,i.appendChild(r);const l=document.createElement("span");l.innerText=x.getText("GridItemsPerPage"),r.appendChild(l),t.appendChild(i)}}return t}addEventListener(t,e){return this.eventEmitter.subscribe(t,(t=>e(t.data)))}removeEventListener(t,e){this.eventEmitter.unsubscribe(t,e)}renderHeaderButtons(){return this.options.showPlusButton?Y("div").addClass(`${this.cssPrefix}-header-btn-plus`).title(this.options.plusButtonTitle||"Add").addChild("a",(t=>t.attr("href","javascript:void(0)").on("click",(t=>{t.preventDefault(),this.fireEvent({type:"plusButtonClick",sourceEvent:t})})))).toDOM():Y("span").addText("#").toDOM()}showLandingSlot(t,e){const i=this.headerRowDiv.querySelectorAll(`[class*=${this.cssPrefix}-table-col]`),s=[];for(let t=1;t<i.length;t++){const e=i[t];"none"!==e.style.display&&s.push(e)}if(0===s.length)return this.landingIndex=0,void this.headerRowDiv.appendChild(this.landingSlot);const n=F(this.landingSlot);if(t>=n.x&&t<=n.x+this.landingSlot.offsetWidth)return;let a=this.landingIndex;for(let e of s){const i=F(e),s=e.offsetWidth;t>i.x&&t<i.x+s&&(a=parseInt(e.getAttribute("data-col-idx"))-1)}a!=this.landingIndex&&(this.landingIndex=a,this.landingIndex<s.length?this.headerRowDiv.insertBefore(this.landingSlot,s[this.landingIndex]):this.headerRowDiv.appendChild(this.landingSlot))}hideLandingSlot(){this.landingIndex=-1,setTimeout((()=>{this.landingSlot.parentElement&&this.landingSlot.parentElement.removeChild(this.landingSlot)}),10)}get activeRowIndex(){return this._activeRowIndex}set activeRowIndex(t){if(t!==this._activeRowIndex){const e=this._activeRowIndex;this._activeRowIndex=t,this.updateActiveRow(),this.fireEvent({type:"activeRowChanged",oldValue:e,newValue:this.activeRowIndex,rowIndex:this.getGlobalIndexByLocal(this.activeRowIndex)})}}updateActiveRow(){if(this.options.showActiveRow){this.bodyCellContainerDiv.querySelectorAll(`[class*=${this.cssPrefix}-row-active]`).forEach((t=>{t.classList.remove(`${this.cssPrefix}-row-active`)}));const t=this.getActiveRow();t&&(t.classList.add(`${this.cssPrefix}-row-active`),this.ensureRowVisibility(this.activeRowIndex))}}getActiveRow(){return this.getDataRow(this.activeRowIndex)}getDataRow(t){const e=Array.from(this.bodyCellContainerDiv.querySelectorAll(`.${this.cssPrefix}-row:not(.${this.cssPrefix}-row-totals)`));return t>=0&&t<e.length?e[t]:null}focus(){this.bodyViewportDiv.focus()}resizeColumns(){if(this.options.columnWidths.autoResize===X.Never)return;const t=this.bodyCellContainerDiv.style.width;this.bodyCellContainerDiv.style.visibility="hidden",this.bodyCellContainerDiv.style.width="1px",this.headerRowDiv.style.width="1px";let e=0;const i=this.columns.getItems(),s=this.headerCellContainerDiv.querySelectorAll(`.${this.cssPrefix}-header-cell`);let n=0;for(let t=0;t<this.columns.count;t++){const a=i[t];if(!a.isVisible)continue;const o=this.options.columnWidths.autoResize!==X.Always&&a.dataColumn?a.dataColumn.calculatedWidth:0,r=this.bodyCellContainerDiv.querySelectorAll(`.${this.cssPrefix}-cell[data-col-idx="${t}"] > .${this.cssPrefix}-cell-value`);let l=0;if(o>0)e+=o,a.width=o,r.forEach((t=>{t.parentElement.style.width=`${o}px`})),s[n].style.width=`${o}px`;else if(0==r.length&&(s[n].style.width=null,s[n].style.whiteSpace="nowrap"),l=s[n].offsetWidth,r.length>0){r.forEach((t=>{t.parentElement.style.width=null;const e=t.parentElement.offsetWidth;e>l&&(l=e)})),l+=3;const t=a.isRowNum?this.options.columnWidths.rowNumColumn.max||500:this.options.columnWidths[a.dataColumn.type].max||2e3,i=a.isRowNum?this.options.columnWidths.rowNumColumn.min||0:this.options.columnWidths[a.dataColumn.type].min||20;l>t&&(l=t),l<i&&(l=i),E.isNumericType(a.type)&&(l=Math.round(1.3*l)),e+=l,a.width=l,r.forEach((t=>{t.parentElement.style.width=`${l}px`})),s[n].style.width=`${l}px`,a.dataColumn&&(a.dataColumn.calculatedWidth=l)}else e+=l;n++}e>0?(this.bodyCellContainerDiv.style.width=`${e}px`,this.headerCellContainerDiv.style.width=`${e}px`):(this.bodyCellContainerDiv.style.width=t,this.headerCellContainerDiv.style.width=t),this.bodyCellContainerDiv.style.visibility=null,this.headerRowDiv.removeAttribute("style")}},EqDragEvent:j,GridCellRendererStore:lt,GridColumn:Z,get GridColumnAlign(){return Q},GridColumnList:tt,get JUMP_TO(){return Ct},get PRE_SELECT(){return vt},TimePicker:ut,TimeSpanPicker:Tt,addCssClass:function(t,e){t.className=t.className?t.className+" "+e:e},addElement:function(t,e,i){let s=document.createElement(e),n=i||{};return n.cssClass&&(s.className=n.cssClass),t.appendChild(s),s},get browserUtils(){return M},createBrowserEvent:function(t){var e;return"function"==typeof Event?e=new Event(t):(e=document.createEvent("Event")).initEvent(t,!0,!0),e},dialogs:bt,domel:Y,eqCssMobile:"eqjs-mobile",eqCssPrefix:B,eqDragManager:J,getDocSize:function(){return M.IsIE()?$():{width:Math.max(document.documentElement.clientWidth,document.body.clientWidth||0),height:Math.max(document.documentElement.clientHeight,document.body.clientHeight||0)}},getElementAbsolutePos:F,getScrollPos:L,getViewportSize:function(){return{width:Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),height:Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)}},getWinSize:$,hideElement:P,isVisible:function(t){return"none"!=t.style.display&&0!=t.offsetWidth&&0!=t.offsetHeight},mask:H,showElement:N,showTimeSpanPicker:t=>new Tt(t).open(),slideDown:function(t,e,i){t.style.removeProperty("display");let s=window.getComputedStyle(t).display;"none"===s&&(s="block"),t.style.display=s;let n=t.offsetHeight;t.style.overflow="hidden",t.style.height="0px",t.style.paddingTop="0px",t.style.paddingBottom="0px",t.style.marginTop="0px",t.style.marginBottom="0px",t.offsetHeight,t.style.boxSizing="border-box",t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=e+"ms",t.style.height=n+"px",t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),window.setTimeout((()=>{t.style.removeProperty("height"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property"),t.style.removeProperty("box-sizing"),i&&i()}),e)},slideUp:function(t,e,i){t.style.transitionProperty="height, margin, padding",t.style.transitionDuration=e+"ms",t.style.boxSizing="border-box",t.style.height=t.offsetHeight+"px",t.offsetHeight,t.style.overflow="hidden",t.style.height="0px",t.style.paddingTop="0px",t.style.paddingBottom="0px",t.style.marginTop="0px",t.style.marginBottom="0px",window.setTimeout((()=>{t.style.display="none",t.style.removeProperty("height"),t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property"),t.style.removeProperty("box-sizing"),i&&i()}),e)},toggleVisibility:function(t,e,i){i||(i={}),i.display||(i.display=""),i.duration||(i.duration=200),P(t),N(e,i.display),i.complete&&i.complete()},wrapInner:function(t,e){for(t.appendChild(e);t.firstChild!==e;)e.appendChild(t.firstChild)}});
/*!
	 * EasyData.JS CRUD
	 * Copyright 2024 Korzh.com
	 * Licensed under MIT
	 !*/
/*!
	 * EasyData.JS Core
	 * Copyright 2023 Korzh.com
	 * Licensed under MIT
	 !*/!function(t){t[t.Unknown=0]="Unknown",t[t.String=1]="String",t[t.Byte=2]="Byte",t[t.Word=3]="Word",t[t.Int32=4]="Int32",t[t.Int64=5]="Int64",t[t.Bool=6]="Bool",t[t.Float=7]="Float",t[t.Currency=8]="Currency",t[t.BCD=9]="BCD",t[t.Date=10]="Date",t[t.Time=11]="Time",t[t.DateTime=12]="DateTime",t[t.Autoinc=13]="Autoinc",t[t.Memo=14]="Memo",t[t.Blob=15]="Blob",t[t.FixedChar=16]="FixedChar",t[t.Guid=17]="Guid",t[t.Geometry=18]="Geometry",t[t.Geography=19]="Geography"}(Et||(Et={})),function(t){t[t.Data=0]="Data",t[t.Virtual=1]="Virtual",t[t.Lookup=2]="Lookup"}(xt||(xt={}));const St="Unknown",Mt="EDIT",Rt="DATETIME";var Ot,At,kt,Pt,Nt;!function(t){t.Trace="TRACE",t.Options="OPTIONS",t.Get="GET",t.Put="PUT",t.Post="POST",t.Delete="DELETE"}(Ot||(Ot={}));let Lt=class{constructor(t,e){this.xhr=t,this.method=e.method,this.url=e.url,this.headers=e.headers,this.queryParams=e.queryParams,this.data=e.data}setHeader(t,e){this.headers[t]=e}setQueryParam(t,e){this.queryParams[t]=e}getXMLHttpRequest(){return this.xhr}getResponseHeaders(){if(this.xhr.readyState==this.xhr.HEADERS_RECEIVED){const t=this.xhr.getAllResponseHeaders().trim().split(/[\r\n]+/),e={};for(const i of t){const t=i.split(": "),s=t.shift(),n=t.join(": ");e[s]=n}return e}return{}}open(){if(this.xhr.readyState!==this.xhr.UNSENT)return;let t=this.url;this.queryParams&&Object.keys(this.queryParams).length>0&&(t+=encodeURI("?"+Object.keys(this.queryParams).map((t=>t+"="+this.queryParams[t])).join("&"))),this.xhr.open(this.method,t,!0),this.xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");for(const t in this.headers)this.xhr.setRequestHeader(t,this.headers[t])}abort(){this.xhr.abort()}};!function(t){t.getAllDataTypes=function(){return Object.values(Et).filter((t=>"number"==typeof t))},t.getDateDataTypes=function(){return[Et.Time,Et.Date,Et.DateTime]},t.getStringDataTypes=function(){return[Et.String,Et.Memo,Et.FixedChar]};const e=[Et.Byte,Et.Word,Et.Int32,Et.Int64,Et.Float,Et.Currency,Et.Autoinc];t.getNumericDataTypes=function(){return e};const i=[Et.Byte,Et.Word,Et.Int32,Et.Int64,Et.Autoinc];function s(t,e,i){e||(e={});for(let a of i)if(a)for(let i in a)if(a.hasOwnProperty(i)){let o=a[i];null!==o&&"object"==typeof o?t.has(o)?e[i]=t.get(o):Array.isArray(o)?(e[i]=n(o),t.set(o,e[i])):(void 0!==e[i]&&null!=e[i]||(e[i]=Object.create(Object.getPrototypeOf(o))),t.set(o,e[i]),s(t,e[i],[o])):e[i]=o}return e}function n(t){let e=[];for(let i of t)e.push(i);return e}t.assign=function(t,...e){for(let i=0;i<e.length;i++){let s=e[i];if(s)for(let e in s)s.hasOwnProperty(e)&&(t[e]=s[e])}return t},t.assignDeep=function(t,...e){return s(new WeakMap,t,e)},t.getIfDefined=function(t,e){return void 0!==t?t:e},t.IsDefinedAndNotNull=function(t){return null!=t},t.copyArrayTo=function(t,e){const i=t.length,s=e.length;for(let n=0;n<i&&n<s;n++)e[n]=t[n]},t.createArrayFrom=n,t.findItemById=function(t,e){for(var i=t.length,s=0;s<i;s++)if(t[s].id===e)return t[s];return null},t.findItemIndexById=function(t,e){for(var i=t.length,s=0;s<i;s++)if(t[s].id===e)return s;return-1},t.indexOfArrayItem=function(t,e){if(t.indexOf)return t.indexOf(e);{let i=t.length;for(let s=0;s<i;s++)if(e==t[s])return s;return-1}},t.moveArrayItem=function(t,e,i){if(e>=t.length)throw"Index out of bounds: "+e;i>=t.length&&(i=t.length-1);let s=t.splice(e,1)[0];t.splice(i,0,s)},t.removeArrayItem=function(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1)[0]},t.insertArrayItem=function(t,e,i){t.splice(e,0,i)},t.fillArray=function(t,e,i=0,s){let n=t.length>>>0;var a=i>>0,o=a<0?Math.max(n+a,0):Math.min(a,n),r=void 0===s?n:s>>0;let l=r<0?Math.max(n+r,0):Math.min(r,n);for(;o<l;)t[o]=e,o++;return t},t.shiftToFitWindow=function(t,e){let i=document.getElementsByTagName("body")[0],s=window.innerWidth||document.documentElement.clientWidth||i.clientWidth;var n=t+e;let a=0;return n>s&&(a=s-n-10,t+a<0&&(a=10-t)),a},t.isObject=function(t){return null!==t&&("function"==typeof t||"object"==typeof t)},t.isNumericType=function(t){return e.indexOf(t)>=0},t.isIntType=function(t){return i.indexOf(t)>=0},t.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},t.areCompatibleDataTypes=function(t,e){return void 0===t||void 0===e||t==Et.Unknown||e==Et.Unknown||t==e||t==Et.Date&&e==Et.DateTime||t==Et.DateTime&&e==Et.Date},t.isPropSet=function(t,e){return t[e]||t[e.toLowerCase()]||t[e.toUpperCase()]};const a="0123456789abcdefghijklmnopqrstuvwxyz";function o(t,e){const i=t.length;if(i>e){let s=i/e,n="";n+=t[0];let a,o=s;for(let e=1;e<i;e++)a=t[e],e+1>o&&(n+=a,o+=s);return n}return t}function r(t,e){return Math.floor(Math.random()*(e-t))+t}function l(t){const e=parseInt(t);if(isNaN(e))throw`"${t}" is not a valid number`;return e}t.generateId=function(t){t||(t="easy");let e=t.length>4?function(t,e){let i=t.split("-"),s=1,n=4;i.length<4&&(s=4/i.length,n=i.length);let a="";for(let t=0;t<n;t++)a+=o(i[t],s);return a}(t):t;e&&e.length>0&&(e+="-");var i=a[r(0,36)]+a[r(0,36)]+a[r(0,36)],s=r(0,1e4);return e+i+function(t,e=36){var i="",s=t;do{i=a[s%e]+i,s=Math.floor(s/=e)}while(s>0);return i}(621355968e9+1e4*(new Date).getTime()-0x8d60e562e627800-s)},t.strToDateTime=function(t,e){if(!t||0==t.length)return new Date;const i=t.replace(/[^a-zA-Z0-9_]/g,"-"),s=e.replace(/[^a-zA-Z0-9_]/g,"-").split("-"),n=i.split("-"),a=s.indexOf("MM"),o=s.indexOf("dd"),r=s.indexOf("yyyy"),h=s.indexOf("HH"),d=s.indexOf("mm"),c=s.indexOf("ss"),u=new Date;try{const t=r>-1&&r<n.length?l(n[r]):u.getFullYear(),e=a>-1&&a<n.length?l(n[a])-1:u.getMonth()-1;if(e>11)throw"";const i=o>-1&&o<n.length?l(n[o]):u.getDate();if(i>function(t,e){return new Date(e,t+1,0).getDate()}(e,t))throw"";const s=h>-1&&h<n.length?l(n[h]):0;if(s>23)throw"";const g=d>-1&&d<n.length?l(n[d]):0;if(g>59)throw"";const p=c>-1&&c<n.length?l(n[c]):0;if(p>59)throw"";return new Date(t,e,i,s,g,p)}catch(e){throw`${t} is not a valid date.`}},t.strToTime=function(t){const e=t.split(":");try{const t=e.length>0?l(e[0]):0;if(t>23)throw"";const i=e.length>1?l(e[1]):0;if(i>59)throw"";const s=e.length>1?l(e[1]):0;if(s>59)throw"";return new Date(0,0,0,t,i,s)}catch(e){throw`${t} is not a valid time.`}}}(At||(At={}));class Ft{constructor(t,e){this.request=t,this.promise=e}getPromise(){return this.promise}getRequest(){return this.request}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}}class $t extends Error{constructor(t,e){super(e),this.status=t}}class Bt{get responseBody(){return this._responseBody}constructor(){this.defaultHeaders={},this.customPayload=void 0}get(t,e){return this.send(Ot.Get,t,null,e)}post(t,e,i){return this.send(Ot.Post,t,e,i)}put(t,e,i){return this.send(Ot.Put,t,e,i)}delete(t,e,i){return this.send(Ot.Delete,t,e,i)}send(t,e,i,s){const n=(s=s||{}).dataType||"json",a=s.contentType||"form-data"!==n?"application/json":null;i&&"form-data"!=n&&this.customPayload&&(i.data=At.assignDeep(i.data||{},this.customPayload));const o=new("onload"in new XMLHttpRequest?XMLHttpRequest:window.XDomainRequest),r={method:t,url:e,headers:Object.assign(Object.assign({},this.defaultHeaders),s.headers||{}),queryParams:s.queryParams||{},data:i};a&&(r.headers["Content-Type"]=a);const l=new Lt(o,r);this.beforeEachRequest&&(console.warn("HttpClient: 'beforeEachRequest' is deprecated and will be removed in future updates.\n            Use 'onRequest' instead"),this.beforeEachRequest(l)),this.onRequest&&this.onRequest(l);const h=l.data&&"string"!=typeof l.data&&"json"==n?JSON.stringify(l.data):l.data;return l.open(),new Ft(l,new Promise(((t,i)=>{s.responseType&&(o.responseType=s.responseType),o.onerror=t=>{i(new $t(o.status,o.responseText))},o.onreadystatechange=()=>{if(4!=o.readyState)return;const s=o.getResponseHeader("Content-Type")||"",n=o.status;if(0===n)i(new $t(n,"Network error or the request was aborted"));else if(n>=200&&n<400){const e="arraybuffer"===o.responseType||"blob"===o.responseType?o.response:0==s.indexOf("application/json")?JSON.parse(o.responseText):o.responseText;this._responseBody=e,this.onResponse&&this.onResponse(o),t(e)}else("arraybuffer"===o.responseType||"blob"===o.responseType?Bt.decodeArrayBuffer(o.response):Promise.resolve(o.responseText)).then((t=>{const a=0==s.indexOf("application/json")?JSON.parse(t):t;this._responseBody=a;const o=a.message||(404==n?`No such endpoint: ${e}`:a);i(new $t(n,o))}))},o.send(h)})))}static decodeArrayBuffer(t){var e=new FileReader;return new Promise((i=>{e.onloadend=function(){e.readyState==FileReader.DONE&&i(e.result)},e.readAsText(new Blob([t]))}))}}!function(t){let e,i={shortDateFormat:"MM/dd/yyyy",longDateFormat:"dd MMM, yyyy",editDateFormat:"MM/dd/yyyy",shortTimeFormat:"HH:mm",editTimeFormat:"HH:mm",longTimeFormat:"HH:mm:ss",shortMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longMonthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],shortWeekDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longWeekDayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],decimalSeparator:".",currency:"USD"},s={localeId:"en-US",englishName:"English",displayName:"English",texts:{ButtonOK:"OK",ButtonCancel:"Cancel",Yes:"Yes",No:"No",True:"True",False:"False"},settings:i},n={"en-US":s};const a=[];function o(t){for(const e of a)e(t)}function r(){return e.localeId}function l(t){const i=n[t];i?At.assignDeep(e,i):(e.englishName=t,e.displayName=t,e.texts=At.assignDeep({},s.texts)),e.localeId=t}function h(){return e.settings}function d(t){e.settings||(e.settings=At.assignDeep({},i)),e.settings=At.assignDeep(e.settings,t)}function c(t,i){o(i);let a=e;t&&(i.localeId||(i.localeId=t),a=n[t],a||(a=At.assignDeep({},s),n[t]=a)),At.assignDeep(a,i)}t.addMapper=function(t){a.push(t)},t.getLocales=function(){let t=[];for(let e in n)t.push({locale:e,englishName:n[e].englishName,displayName:n[e].displayName});return t.sort(((t,e)=>t.englishName>e.englishName?1:t.englishName===e.englishName?0:-1))},t.getCurrentLocale=r,t.setLocale=function(t){console.warn("This method is deprecated. Use setCurrentLocale instead"),l(t)},t.setCurrentLocale=l,t.getText=function(...t){let i=e.texts,s="";if(t&&t.length){const e=t.length;for(let n=0;n<e&&(s=i[t[n]],"object"==typeof s);n++)i=s}return s},t.getLocaleSettings=h,t.getOneLocaleSetting=function(t){return e.settings[t]},t.getShortMonthName=function(t){const e=h();if(t>0&&t<13)return e.shortMonthNames[t-1];throw"Wrong month number: "+t},t.getLongMonthName=function(t){const e=h();if(t>0&&t<13)return e.longMonthNames[t-1];throw"Wrong month number: "+t},t.getShortWeekDayName=function(t){const e=h();if(t>0&&t<8)return e.shortWeekDayNames.length>=t?e.shortWeekDayNames[t-1]:t.toString();throw"Wrong month number: "+t},t.getLongWeekDayName=function(t){const e=h();if(t>0&&t<8)return e.longWeekDayNames.length>=t?e.longWeekDayNames[t-1]:t.toString();throw"Wrong month number: "+t},t.updateLocaleSettings=d,t.updateLocaleTexts=function(t){"object"==typeof t?(o({localeId:e.localeId,texts:t}),At.assignDeep(e.texts,t)):console.error("Wrong parameter type in updateLocaleTexts function call.The first parameter (localeId) is not necessary. Use updateLocaleTexts(texts) instead")},t.updateDefaultTexts=function(t){for(let e in n){let i=n[e];i.texts=At.assignDeep({},t,i.texts)}e.texts=At.assignDeep({},t,e.texts)},t.updateLocaleInfo=c,t.addLocale=function(t,e){c(t,e)},t.resetLocales=function(){e||(e=At.assignDeep({},s),function(t){const i=new Date(2020,5,7,19,34,56,88),s=i.toLocaleDateString(t,{year:"numeric",month:"numeric",day:"numeric"}),n=i.toLocaleTimeString(t,{hour:"numeric",minute:"numeric",second:"numeric"});let a=s.replace("07","dd").replace("7","d").replace("06","MM").replace("6","M").replace("2020","yyyy").replace("20","yy"),o=n.replace("19","HH").replace("07","hh").replace("7","h").replace("34","mm").replace("56","ss").replace("PM","tt");e.settings||(e.settings={}),d({shortDateFormat:a,shortTimeFormat:o})}("object"==typeof navigator?navigator.language:void 0))};const u=/\[([^\]]+)]|y{2,4}|M{1,4}|d{1,2}|H{1,2}|h{1,2}|m{2}|s{2}|t{2}/g;function g(e,i){const s=e.getFullYear().toString(),n=e.getMonth()+1,a=e.getDate(),o=e.getHours(),r=e.getMinutes(),l=e.getSeconds(),h=o%12||12,d=o>11,c={yyyy:s,yy:s.substring(s.length-2),MMMM:t.getLongMonthName(n),MMM:t.getShortMonthName(n),MM:n<10?"0"+n:n.toString(),M:n.toString(),dd:a<10?"0"+a:a.toString(),d:a.toString(),HH:o<10?"0"+o:o.toString(),H:o.toString(),hh:h<10?"0"+h:h.toString(),h:h.toString(),tt:d?"PM":"AM",mm:r<10?"0"+r:r.toString(),ss:l<10?"0"+l:l.toString()};return i.replace(u,((t,e)=>e||c[t]))}function p(t){const e=h();let i;switch(t){case Et.Date:i=e.shortDateFormat;break;case Et.Time:i=e.shortTimeFormat;break;default:i=e.shortDateFormat+" "+e.shortTimeFormat}return i}function m(t){const e=h();let i;switch(t){case Et.Date:i=e.longDateFormat;break;case Et.Time:i=e.longTimeFormat;break;default:i=e.longDateFormat+" "+e.longTimeFormat}return i}t.dateTimeToStr=g,t.dateTimeToStrEx=function(t,e,i){return i?"d"==i?i=p(Et.Date):"D"==i?i=m(Et.Date):"f"==i?i=p(Et.DateTime):"F"==i&&(i=m(Et.DateTime)):i=p(e),g(t,i)},t.numberToStr=function(e,i,s){if(i&&i.length>0){const s=i.charAt(0).toUpperCase();if("S"===s)return function(e,i){if(!f[i]){const t=i.split("|").filter((t=>t.length>0)).map((t=>t.split("=")));if(f[i]={},t.length>0)if(t[0].length>1)for(const e of t)f[i][Number.parseInt(e[1])]=e[0];else t.forEach(((t,e)=>{f[i][e]=t[0]}))}const s=f[i];if(void 0!==s[e]){const i=s[e];return t.getText(i)||i}return e.toString()}(e,i.slice(1));if(["D","F","C"].indexOf(s)>=0){const t=r();return e.toLocaleString(t,function(t){const e=h(),i=t[0].toUpperCase(),s=t.length>1?Number.parseInt(t.slice(1)):"D"==i?1:2;switch(i){case"D":return{style:"decimal",useGrouping:!1,minimumIntegerDigits:s};case"C":return{style:"currency",currency:e.currency,minimumFractionDigits:s};default:return{style:"decimal",minimumFractionDigits:s,maximumFractionDigits:s}}}(i))}return function(t,e){let i=t.toString(),s="",n=i.length-1;for(let t=e.length-1;t>=0;t--){const a=e.charAt(t);"#"===a||"0"===a?n>=0?(s+=i.charAt(n),n--):"0"===a&&(s+=0):s+=a}return s.split("").reverse().join("")}(Math.trunc(e),i)}const n=h();return s=s||n.decimalSeparator,e.toString().replace(".",s)},t.booleanToStr=function(e,i){if(i&&i.length>0&&"S"===i.charAt(0).toUpperCase()){const s=i.slice(1).split("|");if(s.length>1){const i=s[e?1:0];return t.getText(i)||i}}return`${e}`};const f={}}(kt||(kt={}));class Ht{constructor(t){this.isEditable=!0,this.name="",this.caption="",this.description="",this.parent=t,this.attributes=new Array,this.subEntities=new Array}loadFromData(t,e){if(e){if(this.id=e.id,this.name=e.name,this.captionPlural=e.namePlur,this.caption=e.name,this.description=e.desc,void 0!==e.ied&&(this.isEditable=e.ied),this.subEntities=new Array,e.ents)for(let i=0;i<e.ents.length;i++){let s=t.createEntity(this);s.loadFromData(t,e.ents[i]),this.subEntities.push(s)}if(this.attributes=new Array,e.attrs)for(let i=0;i<e.attrs.length;i++){let s=t.createEntityAttr(this);s.loadFromData(t,e.attrs[i]),this.attributes.push(s)}}}scan(t,e){let i={stop:!1},s=n=>{if(e&&e(n,i),n.attributes){let e=n.attributes.length;for(let s=0;s<e&&!i.stop;s++){let e=n.attributes[s];if(t&&t(e,i),i.stop)return}}if(n.subEntities){let t=n.subEntities.length;for(let e=0;e<t&&!i.stop;e++)s(n.subEntities[e])}};s(this)}getFirstPrimaryAttr(){return this.getPrimaryAttrs()[0]}getPrimaryAttrs(){return this.attributes.filter((t=>t.isPrimaryKey))}}class _t{constructor(t){this.id="",this.caption="{Unrecognized attribute}",this.dataType=Et.String,this.size=0,this.isPrimaryKey=!1,this.isForeignKey=!1,this.isNullable=!0,this.showOnView=!0,this.isEditable=!0,this.showOnCreate=!0,this.showOnEdit=!0,this.showInLookup=!1,this.lookupAttr="",this.expr="",this.entity=t,this.kind=xt.Data}loadFromData(t,e){if(e){this.id=e.id,this.description=e.desc,this.caption=e.cptn,this.dataType=e.dtype,this.isPrimaryKey=e.ipk,this.isForeignKey=e.ifk,this.size=e.size,this.lookupAttr=e.lattr,this.lookupEntity=e.lent,this.dataAttr=e.dattr,this.lookupDataAttr=e.ldattr;const i=At.getDateDataTypes().indexOf(this.dataType);this.defaultValue=e.defVal&&i?new Date(e.defVal):e.defVal,this.isNullable=At.getIfDefined(e.nul,this.isNullable),this.isEditable=At.getIfDefined(e.ied,this.isEditable),this.showOnView=At.getIfDefined(e.ivis||e.sov,this.showOnView),this.showOnCreate=At.getIfDefined(e.soc,this.showOnCreate),this.showOnEdit=At.getIfDefined(e.soe,this.showOnEdit),this.showInLookup=At.getIfDefined(e.sil,this.showInLookup),this.kind=e.kind,this.displayFormat=e.dfmt,e.udata&&(this.userData=e.udata),e.edtr&&(this.defaultEditor=t.getEditorById(e.edtr)||t.createValueEditor())}}}class Wt{constructor(){this.id="",this.tag=St,this.resType=Et.Unknown,this.defValue=""}loadFromData(t){t&&(this.id=t.id,this.tag=t.tag,this.defValue=t.defval,this.resType=t.rtype,this.accept=t.accept,this.multiline=t.multiline,t.subType&&(this.resType=t.subType),t.name&&(this.name=t.name),t.values&&(this.values=t.values))}getValueText(t){let e="";if(!this.values)return e;if(Array.isArray(t))for(let i of this.values)t.indexOf(i.id)>=0&&(e+=i.text+",");else for(let i of this.values)i.id===t&&(e+=i.text+",");return e&&(e=e.substring(0,e.length-1)),e}}class Vt{constructor(){this.mainEntity=null,this.id="__none",this.name="Empty model",this.rootEntity=this.createEntity(),this.displayFormats=new Map}getMainEntity(){return this.mainEntity}createEntity(t){return new Ht(t)}createEntityAttr(t){return new _t(t)}createValueEditor(){return new Wt}loadFromJSON(t){let e=JSON.parse(t);this.loadFromData(e)}loadFromData(t){if(this.id=t.id,this.name=t.name,this.version=t.vers,this.editors=new Array,t.editors)for(let e=0;e<t.editors.length;e++){let i=this.createValueEditor();i.loadFromData(t.editors[e]),this.editors.push(i)}if(this.rootEntity.loadFromData(this,t.entroot),this.displayFormats=new Map,t.displayFormats)for(const e in t.displayFormats){const i=Et[e],s=t.displayFormats[e]||new Array;this.displayFormats.set(i,s)}}getDisplayFormats(){return this.displayFormats}getDisplayFormatsForType(t){return this.displayFormats.has(t)?this.displayFormats.get(t):[]}getDefaultFormat(t){return this.displayFormats.has(t)?this.displayFormats.get(t).filter((t=>t.isdef))[0]:null}setData(t){"string"==typeof t?this.loadFromJSON(t):this.loadFromData(t)}isEmpty(){return 0===this.rootEntity.subEntities.length&&0===this.rootEntity.attributes.length}getId(){return this.id}getName(){return this.name}getRootEntity(){return this.rootEntity}getEditorById(t){for(let e of this.editors)if(e.id===t)return e;return null}getAttributeById(t){return this.getEntityAttrById(this.getRootEntity(),t)||null}checkAttrProperty(t,e){let i=this.getAttributeById(t);if(i){if(void 0===i[e])throw"No such property: "+e;return!!i[e]||!!i.lookupAttr&&(t=i.lookupAttr,i=this.getAttributeById(t),i&&i[e])}return!1}getEntityAttrById(t,e){let i,s;if(t.attributes){let s=t.attributes.length;for(i=0;i<s;i++)if(t.attributes[i].id==e)return t.attributes[i]}if(t.subEntities){let n=t.subEntities.length;for(i=0;i<n;i++)if(s=this.getEntityAttrById(t.subEntities[i],e),s)return s}return null}listByEntityWithFilter(t,e){let i,s=new Array,n=null;if(t.subEntities){let a=t.subEntities.length;for(let o=0;o<a;o++)if(n=t.subEntities[o],!e||e(n,null)){i=kt.getText("Entities",n.name),i||(i=n.caption);let t=At.assign(this.createEntity(),{id:n.name,text:i,items:[],isEntity:!0});t.items=this.listByEntityWithFilter(n,e),t.items.length>0&&s.push(t)}}let a=null;if(t.attributes){let n=t.attributes.length;for(let o=0;o<n;o++)if(a=t.attributes[o],!e||e(t,a)){i=kt.getText("Attributes",a.id),i||(i=a.caption);let t=At.assign(this.createEntity(),{id:a.id,text:i,dataType:a.dataType});s.push(t)}}return s}listByEntity(t,e,i){e=e||{};let s,n=[],a=[],o=null;if(t.subEntities){let a=t.subEntities.length;for(let r=0;r<a;r++)if(o=t.subEntities[r],!i||i(o,null)){s=kt.getText("Entities",o.name)||o.caption;let t=At.assign(this.createEntity(),{id:o.name,text:s,items:[],isEntity:!0,description:o.description}),a=At.assign({},e);a.includeRootData=!1,t.items=this.listByEntity(o,a,i),t.items.length>0&&n.push(t)}}let r=null;if(t.attributes){let e=t.attributes.length;for(let n=0;n<e;n++)r=t.attributes[n],i&&!i(t,r)||(s=kt.getText("Attributes",r.id)||r.caption,a.push(At.assign(this.createEntityAttr(t),{id:r.id,text:s,dataType:r.dataType,lookupAttr:r.lookupAttr,description:r.description})))}let l,h=(t,e)=>t.text.toLowerCase()==e.text.toLowerCase()?0:t.text.toLowerCase()>e.text.toLowerCase()?1:-1;return e.sortEntities&&(n.sort(h),a.sort(h)),l=e.attrPlacement&&0!=e.attrPlacement?a.concat(n):n.concat(a),2==e.attrPlacement&&l.sort(h),e.includeRootData?(s=kt.getText("Entities",t.name),s||(s=t.caption),{id:t.name,text:s,items:l}):l}clear(){this.rootEntity=this.createEntity(),this.editors=[],this.version=""}addDefaultValueEditors(){let t;t=this.addOrUpdateValueEditor("_DTE",Mt,Et.String),t.defValue="",this.addOrUpdateValueEditor("_DPDE",Rt,Et.DateTime),this.addOrUpdateValueEditor("_DPTE",Rt,Et.DateTime)}addOrUpdateValueEditor(t,e,i){let s=At.findItemById(this.editors,t);return s||(s=this.createValueEditor(),s.id=t,this.editors.push(s)),s.tag=e,s.resType=i,s}getEntitiesTree(t,e){return this.listByEntity(this.getRootEntity(),t,e)}getEntitiesTreeWithFilter(t){return this.listByEntityWithFilter(this.getRootEntity(),t)}getFullEntityPathByAttr(t,e){return e=e||" ",this.getEntityPathByAttr(this.getRootEntity(),t,e,!0)}getEntityPathByAttr(t,e,i,s){if(!t)return"";i=i||" ";let n="";if(t.caption&&!s&&(n=kt.getText("Entities",t.caption)||t.caption),t.attributes){let i=t.attributes.length;for(let s=0;s<i;s++)if(t.attributes[s].id==e)return n}if(t.subEntities){let s=t.subEntities.length;for(let a=0;a<s;a++){let s=t.subEntities[a],o=this.getEntityPathByAttr(s,e,i,!1);if(""!==o)return""!==n&&(o=n+i+o),o}}return""}getAttributeText(t,e){let i=kt.getText("Attributes",t.id);if(i||(i=t.caption),!e)return i;let s="",n=this.getFullEntityPathByAttr(t.id," ");return n?(s=e.replace(new RegExp("{attr}","g"),i),s=s.replace(new RegExp("{entity}","g"),n)):s=i,s.trim()}runThroughEntities(t,e){this.getRootEntity().scan(t,e)}getFirstAttributeByFilter(t){let e=null;return this.runThroughEntities((function(i,s){t(i)&&(s.stop=!0,e=i)}),null),e}}!function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Center=2]="Center",t[t.Right=3]="Right"}(Pt||(Pt={}));class Gt{constructor(t){if(!t)throw Error("Options are required");if(!t.id)throw Error("Field Id is required");if(!t.label)throw Error("Label is required");this.id=t.id,this.type=At.getIfDefined(t.type,Et.String),this.label=t.label,this.originAttrId=t.originAttrId,this.isAggr=t.isAggr||!1,this.displayFormat=t.dfmt,this.groupFooterColumnTemplate=t.gfct,this.style=t.style||{},this.description=t.description,this.calculatedWidth=0}}class Yt{constructor(){this.items=[],this.mapper={},this._dateColumnIdx=[]}get count(){return this.items.length}add(t){let e;e=t instanceof Gt?t:new Gt(t);const i=this.items.length;return this.items.push(e),this.mapper[e.id]=i,[Et.Date,Et.DateTime,Et.Time].indexOf(e.type)>=0&&this._dateColumnIdx.push(i),i}updateDateColumnIdx(){this._dateColumnIdx=this.getItems().filter((t=>[Et.Date,Et.DateTime,Et.Time].indexOf(t.type)>=0)).map(((t,e)=>e))}put(t,e){t>=0&&t<this.count&&(this.items[t]=e,this.updateDateColumnIdx())}move(t,e){let i=this.items.indexOf(t);i>=0&&i!=e&&(At.moveArrayItem(this.items,i,e),this.updateDateColumnIdx())}get(t){return t>=0&&t<this.count?this.items[t]:null}getIndex(t){return this.mapper[t]}getItems(){return this.items}getDateColumnIndexes(){return this._dateColumnIdx}removeAt(t){const e=this.get(t);this.items.splice(t,1);const i=this._dateColumnIdx.indexOf(t);i>=0&&this._dateColumnIdx.splice(i,1),delete this.mapper[e.id]}clear(){this.items=[],this._dateColumnIdx=[],this.mapper={}}}class zt{constructor(t,e){this.columns=t,this.values=e}toArray(){return Array.from(this.values)}size(){return this.values.length}getValue(t){let e;if("string"==typeof t){if(e=this.columns.getIndex(t),void 0===e)throw new RangeError(`No column with id '${t}'`)}else e=t;if(e>=this.values.length)throw new RangeError("Out of range: "+e);return this.values[e]}setValue(t,e){let i;if("string"==typeof t){if(i=this.columns.getIndex(t),void 0===i)throw new RangeError(`No column with id '${t}'`)}else i=t;if(i>=this.values.length)throw new RangeError("Out of range: "+i);this.values[i]=e}}let Ut=class{constructor(t){if(this._chunkSize=1e3,this._elasticChunks=!1,this.cachedRows=[],this.total=0,this.loader=null,this.needTotal=!0,this.isInMemory=!1,t=t||{},this._chunkSize=t.chunkSize||this._chunkSize,this._elasticChunks=t.elasticChunks||this._elasticChunks,this.loader=t.loader,void 0!==t.inMemory&&(this.isInMemory=t.inMemory),this.isInMemory&&(this.needTotal=!1),this._columns=new Yt,this.onUpdate=t.onUpdate,t.columns)for(const e of t.columns)this._columns.add(e);if(t.rows)for(const e of t.rows){const t=this.createRow(e);this.addRow(t)}this.needTotal=!this._elasticChunks}get columns(){return this._columns}get chunkSize(){return this._chunkSize}set chunkSize(t){this._chunkSize=t,this.total=0,this.needTotal=!this.elasticChunks,this.cachedRows=[]}get elasticChunks(){return this._elasticChunks}set elasticChunks(t){this._elasticChunks=t,this.total=0,this.needTotal=!this.elasticChunks,this.cachedRows=[]}getRows(t){let e=0,i=this._chunkSize;t&&("page"in t?(e=t.pageSize*(t.page-1),i=t.pageSize):(e=t.offset,i=t.limit));let s=e+i;if(!this.needTotal&&!this.elasticChunks){if(e>=this.total)return Promise.resolve([]);s>this.total&&(s=this.total)}if(this.isInMemory&&s>this.cachedRows.length&&(s=this.cachedRows.length),s<=this.cachedRows.length)return Promise.resolve(this.cachedRows.slice(e,s));if(!this.loader)throw`Loader is not defined. Can't get the rows from ${e} to ${s}`;const n=this.needTotal;this.needTotal&&(this.needTotal=!1);let a=this.cachedRows.length,o=s-a;return o<this._chunkSize&&(o=this._chunkSize),this.loader.loadChunk({offset:a,limit:o,needTotal:n}).then((t=>(n&&(this.total=t.total),Array.prototype.push.apply(this.cachedRows,t.table.getCachedRows()),s>this.cachedRows.length&&(s=this.cachedRows.length),this.elasticChunks&&t.table.getCachedCount()<o&&(this.total=this.cachedRows.length),this.fireUpdated(),this.cachedRows.slice(e,s))))}getRow(t){return this.getRows({offset:t,limit:1}).then((t=>t.length>0?t[0]:null))}getTotal(){return this.total}setTotal(t){this.total=t,this.needTotal=!1}getCachedCount(){return this.cachedRows.length}clear(){this.columns.clear(),this.cachedRows=[],this.total=0,this.needTotal=!this._elasticChunks,this.fireUpdated()}createRow(t){const e=this._columns.getDateColumnIndexes(),i=new Array(this._columns.count),s=t instanceof zt?e=>t.getValue(e):e=>t[e];return t&&this.columns.getItems().forEach((t=>{const n=s(t.id),a=this.columns.getIndex(t.id);i[a]=e.indexOf(a)>=0?this.mapDate(n,t.type):n})),new zt(this._columns,i)}mapDate(t,e){if(t){let i=new Date(t);return isNaN(i.getTime())&&e==Et.Time&&(i=At.strToTime(t)),i}return null}addRow(t){let e;if(Array.isArray(t)){let i=t;const s=this._columns.getDateColumnIndexes();if(s.length>0)for(const t of s)i[t]&&(i[t]=this.mapDate(i[t],this._columns.get(t).type));e=new zt(this._columns,i)}else e=this.createRow(t);this.cachedRows.push(e);const i=this.getCachedCount();return i>this.total&&(this.total=i),e}getCachedRows(){return this.cachedRows}totalIsKnown(){return this.elasticChunks?this.getCachedCount()===this.total:!this.needTotal}fireUpdated(){this.onUpdate&&this.onUpdate(this)}};function jt(t,e){let i=t;return null!=i&&i.length>0?("/"!=i.charAt(i.length-1)&&(i+="/"),i+=e):i=e,i}(Nt||(Nt={})).renderLiquidTemplate=function(t,e){let i=t;if(e)for(let t in e){const s=new RegExp("{{"+t+"}}","g");i=i.replace(s,e[t])}return i},kt.resetLocales(),"function"!=typeof Object.values&&(Object.values=function(t){return Object.keys(t).map((e=>t[e]))}),"function"!=typeof Math.trunc&&(Math.trunc=function(t){return isNaN(t)?NaN:t>0?Math.floor(t):Math.ceil(t)});class qt{constructor(t,e,i,s=!1){this.loader=t,this.sourceTable=e,this.sourceId=i,this.isLookup=s,this.filterValue="",this.justServerSide=!1}getValue(){return this.filterValue}apply(t){return this.filterValue=t,this.filterValue?this.applyCore():this.clear()}clear(){return this.filterValue="",Promise.resolve(this.sourceTable)}applyCore(){if(this.sourceTable.getTotal()!=this.sourceTable.getCachedCount()||this.justServerSide){const t=[{class:"__substring",value:this.filterValue}];return this.loader.loadChunk({offset:0,limit:this.sourceTable.chunkSize,needTotal:!0,filters:t,sourceId:this.sourceId,lookup:this.isLookup}).then((e=>{const i=new Ut({chunkSize:this.sourceTable.chunkSize,loader:{loadChunk:e=>this.loader.loadChunk(Object.assign(Object.assign({},e),{filters:t,sourceId:this.sourceId,lookup:this.isLookup}))}});for(const t of this.sourceTable.columns.getItems())i.columns.add(t);i.setTotal(e.total);for(const t of e.table.getCachedRows())i.addRow(t);return i}))}return this.applyInMemoryFilter()}applyInMemoryFilter(){return new Promise(((t,e)=>{const i=new Ut({chunkSize:this.sourceTable.chunkSize,inMemory:!0});for(const t of this.sourceTable.columns.getItems())i.columns.add(t);const s=this.filterValue.split("||").map((t=>t.trim().toLowerCase())),n=this.sourceTable.columns.getItems().filter((t=>At.isNumericType(t.type)||At.getStringDataTypes().indexOf(t.type)>=0)),a=t=>{for(const e of n){const i=t.getValue(e.id);if(i){const t=i.toString().toLowerCase();for(const e of s)if(t.indexOf(e)>=0)return!0}}return!1};for(const t of this.sourceTable.getCachedRows())a(t)&&i.addRow(t);i.setTotal(i.getCachedCount()),t(i)}))}}
/*!
	 * EasyData.JS UI
	 * Copyright 2020 - 2024 Korzh.com
	 * Licensed under MIT
	 !*/
/*!
	 * EasyData.JS Core
	 * Copyright 2023 Korzh.com
	 * Licensed under MIT
	 !*/var Kt,Jt,Xt,Qt,Zt,te,ee,ie;!function(t){t[t.Unknown=0]="Unknown",t[t.String=1]="String",t[t.Byte=2]="Byte",t[t.Word=3]="Word",t[t.Int32=4]="Int32",t[t.Int64=5]="Int64",t[t.Bool=6]="Bool",t[t.Float=7]="Float",t[t.Currency=8]="Currency",t[t.BCD=9]="BCD",t[t.Date=10]="Date",t[t.Time=11]="Time",t[t.DateTime=12]="DateTime",t[t.Autoinc=13]="Autoinc",t[t.Memo=14]="Memo",t[t.Blob=15]="Blob",t[t.FixedChar=16]="FixedChar",t[t.Guid=17]="Guid",t[t.Geometry=18]="Geometry",t[t.Geography=19]="Geography"}(Kt||(Kt={})),function(t){t[t.Data=0]="Data",t[t.Virtual=1]="Virtual",t[t.Lookup=2]="Lookup"}(Jt||(Jt={})),function(t){t.Trace="TRACE",t.Options="OPTIONS",t.Get="GET",t.Put="PUT",t.Post="POST",t.Delete="DELETE"}(Xt||(Xt={})),function(t){t.getAllDataTypes=function(){return Object.values(Kt).filter((t=>"number"==typeof t))},t.getDateDataTypes=function(){return[Kt.Time,Kt.Date,Kt.DateTime]},t.getStringDataTypes=function(){return[Kt.String,Kt.Memo,Kt.FixedChar]};const e=[Kt.Byte,Kt.Word,Kt.Int32,Kt.Int64,Kt.Float,Kt.Currency,Kt.Autoinc];t.getNumericDataTypes=function(){return e};const i=[Kt.Byte,Kt.Word,Kt.Int32,Kt.Int64,Kt.Autoinc];function s(t,e,i){e||(e={});for(let a of i)if(a)for(let i in a)if(a.hasOwnProperty(i)){let o=a[i];null!==o&&"object"==typeof o?t.has(o)?e[i]=t.get(o):Array.isArray(o)?(e[i]=n(o),t.set(o,e[i])):(void 0!==e[i]&&null!=e[i]||(e[i]=Object.create(Object.getPrototypeOf(o))),t.set(o,e[i]),s(t,e[i],[o])):e[i]=o}return e}function n(t){let e=[];for(let i of t)e.push(i);return e}t.assign=function(t,...e){for(let i=0;i<e.length;i++){let s=e[i];if(s)for(let e in s)s.hasOwnProperty(e)&&(t[e]=s[e])}return t},t.assignDeep=function(t,...e){return s(new WeakMap,t,e)},t.getIfDefined=function(t,e){return void 0!==t?t:e},t.IsDefinedAndNotNull=function(t){return null!=t},t.copyArrayTo=function(t,e){const i=t.length,s=e.length;for(let n=0;n<i&&n<s;n++)e[n]=t[n]},t.createArrayFrom=n,t.findItemById=function(t,e){for(var i=t.length,s=0;s<i;s++)if(t[s].id===e)return t[s];return null},t.findItemIndexById=function(t,e){for(var i=t.length,s=0;s<i;s++)if(t[s].id===e)return s;return-1},t.indexOfArrayItem=function(t,e){if(t.indexOf)return t.indexOf(e);{let i=t.length;for(let s=0;s<i;s++)if(e==t[s])return s;return-1}},t.moveArrayItem=function(t,e,i){if(e>=t.length)throw"Index out of bounds: "+e;i>=t.length&&(i=t.length-1);let s=t.splice(e,1)[0];t.splice(i,0,s)},t.removeArrayItem=function(t,e){let i=t.indexOf(e);if(-1!=i)return t.splice(i,1)[0]},t.insertArrayItem=function(t,e,i){t.splice(e,0,i)},t.fillArray=function(t,e,i=0,s){let n=t.length>>>0;var a=i>>0,o=a<0?Math.max(n+a,0):Math.min(a,n),r=void 0===s?n:s>>0;let l=r<0?Math.max(n+r,0):Math.min(r,n);for(;o<l;)t[o]=e,o++;return t},t.shiftToFitWindow=function(t,e){let i=document.getElementsByTagName("body")[0],s=window.innerWidth||document.documentElement.clientWidth||i.clientWidth;var n=t+e;let a=0;return n>s&&(a=s-n-10,t+a<0&&(a=10-t)),a},t.isObject=function(t){return null!==t&&("function"==typeof t||"object"==typeof t)},t.isNumericType=function(t){return e.indexOf(t)>=0},t.isIntType=function(t){return i.indexOf(t)>=0},t.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},t.areCompatibleDataTypes=function(t,e){return void 0===t||void 0===e||t==Kt.Unknown||e==Kt.Unknown||t==e||t==Kt.Date&&e==Kt.DateTime||t==Kt.DateTime&&e==Kt.Date},t.isPropSet=function(t,e){return t[e]||t[e.toLowerCase()]||t[e.toUpperCase()]};const a="0123456789abcdefghijklmnopqrstuvwxyz";function o(t,e){const i=t.length;if(i>e){let s=i/e,n="";n+=t[0];let a,o=s;for(let e=1;e<i;e++)a=t[e],e+1>o&&(n+=a,o+=s);return n}return t}function r(t,e){return Math.floor(Math.random()*(e-t))+t}function l(t){const e=parseInt(t);if(isNaN(e))throw`"${t}" is not a valid number`;return e}t.generateId=function(t){t||(t="easy");let e=t.length>4?function(t,e){let i=t.split("-"),s=1,n=4;i.length<4&&(s=4/i.length,n=i.length);let a="";for(let t=0;t<n;t++)a+=o(i[t],s);return a}(t):t;e&&e.length>0&&(e+="-");var i=a[r(0,36)]+a[r(0,36)]+a[r(0,36)],s=r(0,1e4);return e+i+function(t,e=36){var i="",s=t;do{i=a[s%e]+i,s=Math.floor(s/=e)}while(s>0);return i}(621355968e9+1e4*(new Date).getTime()-0x8d60e562e627800-s)},t.strToDateTime=function(t,e){if(!t||0==t.length)return new Date;const i=t.replace(/[^a-zA-Z0-9_]/g,"-"),s=e.replace(/[^a-zA-Z0-9_]/g,"-").split("-"),n=i.split("-"),a=s.indexOf("MM"),o=s.indexOf("dd"),r=s.indexOf("yyyy"),h=s.indexOf("HH"),d=s.indexOf("mm"),c=s.indexOf("ss"),u=new Date;try{const t=r>-1&&r<n.length?l(n[r]):u.getFullYear(),e=a>-1&&a<n.length?l(n[a])-1:u.getMonth()-1;if(e>11)throw"";const i=o>-1&&o<n.length?l(n[o]):u.getDate();if(i>function(t,e){return new Date(e,t+1,0).getDate()}(e,t))throw"";const s=h>-1&&h<n.length?l(n[h]):0;if(s>23)throw"";const g=d>-1&&d<n.length?l(n[d]):0;if(g>59)throw"";const p=c>-1&&c<n.length?l(n[c]):0;if(p>59)throw"";return new Date(t,e,i,s,g,p)}catch(e){throw`${t} is not a valid date.`}},t.strToTime=function(t){const e=t.split(":");try{const t=e.length>0?l(e[0]):0;if(t>23)throw"";const i=e.length>1?l(e[1]):0;if(i>59)throw"";const s=e.length>1?l(e[1]):0;if(s>59)throw"";return new Date(0,0,0,t,i,s)}catch(e){throw`${t} is not a valid time.`}}}(Qt||(Qt={})),function(t){let e,i={shortDateFormat:"MM/dd/yyyy",longDateFormat:"dd MMM, yyyy",editDateFormat:"MM/dd/yyyy",shortTimeFormat:"HH:mm",editTimeFormat:"HH:mm",longTimeFormat:"HH:mm:ss",shortMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longMonthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],shortWeekDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],longWeekDayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],decimalSeparator:".",currency:"USD"},s={localeId:"en-US",englishName:"English",displayName:"English",texts:{ButtonOK:"OK",ButtonCancel:"Cancel",Yes:"Yes",No:"No",True:"True",False:"False"},settings:i},n={"en-US":s};const a=[];function o(t){for(const e of a)e(t)}function r(){return e.localeId}function l(t){const i=n[t];i?Qt.assignDeep(e,i):(e.englishName=t,e.displayName=t,e.texts=Qt.assignDeep({},s.texts)),e.localeId=t}function h(){return e.settings}function d(t){e.settings||(e.settings=Qt.assignDeep({},i)),e.settings=Qt.assignDeep(e.settings,t)}function c(t,i){o(i);let a=e;t&&(i.localeId||(i.localeId=t),a=n[t],a||(a=Qt.assignDeep({},s),n[t]=a)),Qt.assignDeep(a,i)}t.addMapper=function(t){a.push(t)},t.getLocales=function(){let t=[];for(let e in n)t.push({locale:e,englishName:n[e].englishName,displayName:n[e].displayName});return t.sort(((t,e)=>t.englishName>e.englishName?1:t.englishName===e.englishName?0:-1))},t.getCurrentLocale=r,t.setLocale=function(t){console.warn("This method is deprecated. Use setCurrentLocale instead"),l(t)},t.setCurrentLocale=l,t.getText=function(...t){let i=e.texts,s="";if(t&&t.length){const e=t.length;for(let n=0;n<e&&(s=i[t[n]],"object"==typeof s);n++)i=s}return s},t.getLocaleSettings=h,t.getOneLocaleSetting=function(t){return e.settings[t]},t.getShortMonthName=function(t){const e=h();if(t>0&&t<13)return e.shortMonthNames[t-1];throw"Wrong month number: "+t},t.getLongMonthName=function(t){const e=h();if(t>0&&t<13)return e.longMonthNames[t-1];throw"Wrong month number: "+t},t.getShortWeekDayName=function(t){const e=h();if(t>0&&t<8)return e.shortWeekDayNames.length>=t?e.shortWeekDayNames[t-1]:t.toString();throw"Wrong month number: "+t},t.getLongWeekDayName=function(t){const e=h();if(t>0&&t<8)return e.longWeekDayNames.length>=t?e.longWeekDayNames[t-1]:t.toString();throw"Wrong month number: "+t},t.updateLocaleSettings=d,t.updateLocaleTexts=function(t){"object"==typeof t?(o({localeId:e.localeId,texts:t}),Qt.assignDeep(e.texts,t)):console.error("Wrong parameter type in updateLocaleTexts function call.The first parameter (localeId) is not necessary. Use updateLocaleTexts(texts) instead")},t.updateDefaultTexts=function(t){for(let e in n){let i=n[e];i.texts=Qt.assignDeep({},t,i.texts)}e.texts=Qt.assignDeep({},t,e.texts)},t.updateLocaleInfo=c,t.addLocale=function(t,e){c(t,e)},t.resetLocales=function(){e||(e=Qt.assignDeep({},s),function(t){const i=new Date(2020,5,7,19,34,56,88),s=i.toLocaleDateString(t,{year:"numeric",month:"numeric",day:"numeric"}),n=i.toLocaleTimeString(t,{hour:"numeric",minute:"numeric",second:"numeric"});let a=s.replace("07","dd").replace("7","d").replace("06","MM").replace("6","M").replace("2020","yyyy").replace("20","yy"),o=n.replace("19","HH").replace("07","hh").replace("7","h").replace("34","mm").replace("56","ss").replace("PM","tt");e.settings||(e.settings={}),d({shortDateFormat:a,shortTimeFormat:o})}("object"==typeof navigator?navigator.language:void 0))};const u=/\[([^\]]+)]|y{2,4}|M{1,4}|d{1,2}|H{1,2}|h{1,2}|m{2}|s{2}|t{2}/g;function g(e,i){const s=e.getFullYear().toString(),n=e.getMonth()+1,a=e.getDate(),o=e.getHours(),r=e.getMinutes(),l=e.getSeconds(),h=o%12||12,d=o>11,c={yyyy:s,yy:s.substring(s.length-2),MMMM:t.getLongMonthName(n),MMM:t.getShortMonthName(n),MM:n<10?"0"+n:n.toString(),M:n.toString(),dd:a<10?"0"+a:a.toString(),d:a.toString(),HH:o<10?"0"+o:o.toString(),H:o.toString(),hh:h<10?"0"+h:h.toString(),h:h.toString(),tt:d?"PM":"AM",mm:r<10?"0"+r:r.toString(),ss:l<10?"0"+l:l.toString()};return i.replace(u,((t,e)=>e||c[t]))}function p(t){const e=h();let i;switch(t){case Kt.Date:i=e.shortDateFormat;break;case Kt.Time:i=e.shortTimeFormat;break;default:i=e.shortDateFormat+" "+e.shortTimeFormat}return i}function m(t){const e=h();let i;switch(t){case Kt.Date:i=e.longDateFormat;break;case Kt.Time:i=e.longTimeFormat;break;default:i=e.longDateFormat+" "+e.longTimeFormat}return i}t.dateTimeToStr=g,t.dateTimeToStrEx=function(t,e,i){return i?"d"==i?i=p(Kt.Date):"D"==i?i=m(Kt.Date):"f"==i?i=p(Kt.DateTime):"F"==i&&(i=m(Kt.DateTime)):i=p(e),g(t,i)},t.numberToStr=function(e,i,s){if(i&&i.length>0){const s=i.charAt(0).toUpperCase();if("S"===s)return function(e,i){if(!f[i]){const t=i.split("|").filter((t=>t.length>0)).map((t=>t.split("=")));if(f[i]={},t.length>0)if(t[0].length>1)for(const e of t)f[i][Number.parseInt(e[1])]=e[0];else t.forEach(((t,e)=>{f[i][e]=t[0]}))}const s=f[i];if(void 0!==s[e]){const i=s[e];return t.getText(i)||i}return e.toString()}(e,i.slice(1));if(["D","F","C"].indexOf(s)>=0){const t=r();return e.toLocaleString(t,function(t){const e=h(),i=t[0].toUpperCase(),s=t.length>1?Number.parseInt(t.slice(1)):"D"==i?1:2;switch(i){case"D":return{style:"decimal",useGrouping:!1,minimumIntegerDigits:s};case"C":return{style:"currency",currency:e.currency,minimumFractionDigits:s};default:return{style:"decimal",minimumFractionDigits:s,maximumFractionDigits:s}}}(i))}return function(t,e){let i=t.toString(),s="",n=i.length-1;for(let t=e.length-1;t>=0;t--){const a=e.charAt(t);"#"===a||"0"===a?n>=0?(s+=i.charAt(n),n--):"0"===a&&(s+=0):s+=a}return s.split("").reverse().join("")}(Math.trunc(e),i)}const n=h();return s=s||n.decimalSeparator,e.toString().replace(".",s)},t.booleanToStr=function(e,i){if(i&&i.length>0&&"S"===i.charAt(0).toUpperCase()){const s=i.slice(1).split("|");if(s.length>1){const i=s[e?1:0];return t.getText(i)||i}}return`${e}`};const f={}}(Zt||(Zt={})),function(t){t[t.None=0]="None",t[t.Left=1]="Left",t[t.Center=2]="Center",t[t.Right=3]="Right"}(te||(te={}));class se{constructor(t,e){this.columns=t,this.values=e}toArray(){return Array.from(this.values)}size(){return this.values.length}getValue(t){let e;if("string"==typeof t){if(e=this.columns.getIndex(t),void 0===e)throw new RangeError(`No column with id '${t}'`)}else e=t;if(e>=this.values.length)throw new RangeError("Out of range: "+e);return this.values[e]}setValue(t,e){let i;if("string"==typeof t){if(i=this.columns.getIndex(t),void 0===i)throw new RangeError(`No column with id '${t}'`)}else i=t;if(i>=this.values.length)throw new RangeError("Out of range: "+i);this.values[i]=e}}class ne{static newGuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}}class ae{constructor(t){this.silentMode=0,this.events=new Array,this.source=t}subscribe(t,e){let i=this.getEventRecByType(t);const s={id:ne.newGuid(),callback:e};return i?i.eventCallbacks.push(s):(i={type:t,eventCallbacks:new Array(s)},this.events.push(i)),s.id}unsubscribe(t,e){let i=this.getEventRecByType(t);if(i){let t=-1;for(t=0;t<i.eventCallbacks.length&&i.eventCallbacks[t].id!==e;t++);t>=0&&i.eventCallbacks.splice(t,1)}}fire(t,e,i=0,s=!1){if(this.silentMode&&!s)return;let n=this.getEventRecByType(t);if(n){const s={type:t,source:this.source,data:e};let a=()=>{for(let t of n.eventCallbacks)t.callback(s)};i>0?setTimeout(a,i):a()}}enterSilentMode(){this.silentMode++}exitSilentMode(){this.silentMode&&this.silentMode--}isSilent(){return this.silentMode>0}getEventRecByType(t){for(let e of this.events)if(e.type==t)return e;return null}}function oe(t){let e={x:0,y:0};if(null!==t){const i=function(t){const e={top:0,right:0,bottom:0,left:0,width:0,height:0};let i;try{i=t.getBoundingClientRect()}catch(t){i=e}const s=document.body,n=document.documentElement,a=function(){const t=document.body,e=document.documentElement;return{top:window.pageYOffset||e.scrollTop||t.scrollTop,left:window.pageXOffset||e.scrollLeft||t.scrollLeft}}(),o=a.top,r=a.left,l=n.clientTop||s.clientTop||0,h=n.clientLeft||s.clientLeft||0,d=i.top+o-l,c=i.left+r-h;return{top:Math.round(d),left:Math.round(c)}}(t);e={x:i.left,y:i.top}}return e}(ee||(ee={})).renderLiquidTemplate=function(t,e){let i=t;if(e)for(let t in e){const s=new RegExp("{{"+t+"}}","g");i=i.replace(s,e[t])}return i},Zt.resetLocales(),"function"!=typeof Object.values&&(Object.values=function(t){return Object.keys(t).map((e=>t[e]))}),"function"!=typeof Math.trunc&&(Math.trunc=function(t){return isNaN(t)?NaN:t>0?Math.floor(t):Math.ceil(t)}),function(t){let e=null,i=null;function s(){if(null===i){const t=navigator.userAgent;i=t.indexOf("MSIE ")>-1||t.indexOf("Trident/")>-1}return i}t.IsIE=s,t.IsEdge=function(){const t=window.navigator.userAgent;return!s()&&t.includes("Edge/")},t.IsFirefox=function(){if(null===e){const t=navigator.userAgent;e=t.toLowerCase().indexOf("firefox")>-1}return e};let n,a,o=!1,r=()=>{const t=l();o=window.matchMedia("only screen and (max-width: 840px)").matches||window.matchMedia("only screen and (max-height: 420px)").matches;const e=l();e!==t&&a&&a(e)};function l(){return void 0!==n?n:o}r(),window.addEventListener("resize",(()=>r())),t.isMobileMode=l,t.setIsMobileMode=function(t){const e=l();n=t;const i=l();i!==e&&a&&a(i)},t.onMobileModeChanged=function(t){a=t},t.getMobileCssClass=function(){return l()?"k-mobile":null}}(ie||(ie={}));const re="eqjs";class le{constructor(t,e){this.element="string"==typeof t?document.createElement(t):t,e&&this.element.parentElement!==e&&e.appendChild(this.element)}addChild(t,e){const i=ue(t,this.element);return e&&e(i),this}addChildElement(t){return t&&this.element.appendChild(t),this}attr(t,e){return this.element.setAttribute(t,e),this}id(t){return this.attr("id",t)}focus(){return this.element.focus(),this}title(t){return this.attr("title",t)}data(t,e=null){return null===e?(this.element.removeAttribute("data-"+t),this):this.attr("data-"+t,e)}show(){return this.removeStyle("display")}hide(t=!0){return t?this.setStyle("display","none"):this}visible(t=!0){return t?this.setStyle("visibility","visible"):this.setStyle("visibility","hidden")}isVisible(){return!!(this.element.offsetWidth||this.element.offsetHeight||this.element.getClientRects().length)}addClass(t,...e){if(t){const i=[...t.trim().split(" "),...e];for(let t=0;t<i.length;t++)this.element.classList.add(i[t])}return this}removeClass(t,...e){if(t){const i=[...t.trim().split(" "),...e];for(let t=0;t<i.length;t++)this.element.classList.remove(i[t])}return this}toggleClass(t,e=void 0){return t&&this.element.classList.toggle(t,e),this}on(t,e){const i=t.split(" ");for(let t=0;t<i.length;t++)this.element.addEventListener(i[t],e);return this}off(t,e){const i=t.split(" ");for(let t=0;t<i.length;t++)this.element.removeEventListener(i[t],e);return this}setStyle(t,e){return this.element.style.setProperty(t,e),this}removeStyle(t){return this.element.style.removeProperty(t),this}text(t){return this.element.innerText=t,this}html(t){return this.element.innerHTML=t,this}clear(){const t=this.element;this.element=document.createElement(this.element.tagName),t.replaceWith(this.element)}addText(t){const e=document.createTextNode(t);return this.element.appendChild(e),this}addHtml(t){return this.element.innerHTML+=t,this}toDOM(){return this.element}appendTo(t){return t&&t.appendChild(this.element),this}}class he extends le{constructor(t,e){super(t||"textarea",e)}name(t){return this.element.name=t,this}rows(t){return this.element.rows=t,this}cols(t){return this.element.cols=t,this}value(t){return this.element.value=t,this}}class de extends le{constructor(t,e){super(t||"input",e)}name(t){return this.element.name=t,this}type(t){return this.element.type=t,this}size(t){return this.element.size=t,this}value(t){return t instanceof Date?this.element.valueAsDate=t:"number"==typeof t?this.element.valueAsNumber=t:this.element.value=t,this}mask(t){return function(t,e){const i={9:"[0-9]",a:"[a-z]"},s=e.split(""),n=e=>{if("focus"===e.type&&""!==t.value)return;let n=[],a=t.selectionStart;s.forEach(((e,s)=>{if(i[e]){let a=new RegExp(i[e],"i").test(t.value.charAt(s));n.push(a?t.value.charAt(s):"_")}else n.push(e)})),t.value=n.join(""),t.selectionStart=t.selectionEnd=a};t.addEventListener("keydown",(e=>{if(8===e.keyCode||46===e.keyCode){e.preventDefault();let n=[],a=t.selectionStart;if(0==a)return;let o=a,r=!0;for(let e=s.length-1;e>=0;e--){const l=s[e];if(i[l]){let s=new RegExp(i[l],"i").test(t.value.charAt(e));s&&e!=a-1&&(r=!1),e===a-1&&o--,n.push(s&&e!=a-1?t.value.charAt(e):"_")}else e===o-1&&o--,a-1===e&&a--,n.push(l)}t.value=r?"":n.reverse().join(""),t.selectionStart=t.selectionEnd=o<0?0:o;const l=document.createEvent("Event");l.initEvent("input",!0,!0),t.dispatchEvent(l)}})),t.addEventListener("keypress",(e=>{const n=String.fromCharCode(e.charCode);if(n){e.preventDefault();let a=[],o=t.selectionStart,r=o;s.forEach(((e,s)=>{if(i[e]){const l=s!=o?t.value.charAt(s):n;let h=new RegExp(i[e],"i").test(l);a.push(h?l:"_"),h&&o===s&&r++}else a.push(e),r===s&&r++,o===s&&o++})),t.value=a.join(""),t.selectionStart=t.selectionEnd=r;const l=document.createEvent("Event");l.initEvent("input",!0,!0),t.dispatchEvent(l)}})),t.addEventListener("input",n),t.addEventListener("focus",n)}(this.element,t),this}}class ce extends le{constructor(t,e){super(t||"select",e)}addOption(t){const e=document.createElement("option");return"string"==typeof t?(e.value=t,e.innerHTML=t):(e.value=t.value,e.innerHTML=t.title||t.value,e.selected=t.selected||!1),this.element.appendChild(e),this}value(t){return this.element.value=t,this}}function ue(t,e){return"div"===t||t instanceof HTMLDivElement||"span"===t||t instanceof HTMLSpanElement||"a"===t||t instanceof HTMLAnchorElement||"button"===t||t instanceof HTMLButtonElement||"img"===t||t instanceof HTMLImageElement?new le(t,e):"input"===t||t instanceof HTMLInputElement?new de(t instanceof HTMLInputElement?t:null,e):"textarea"===t||t instanceof HTMLTextAreaElement?new he(t instanceof HTMLTextAreaElement?t:null,e):"select"===t||t instanceof HTMLSelectElement?new ce(t instanceof HTMLSelectElement?t:null,e):new le(t,e)}const ge="undefined"!=typeof TouchEvent;var pe;!function(t){t.None="none",t.Allow="allow",t.Forbid="forbid"}(pe||(pe={}));class me{constructor(t,e,i){this.dropEffect=pe.Allow,this.pageX=0,this.pageY=0,this.item=t,this.dragImage=e,this.data=t.data,this.sourceEvent=i,i&&i instanceof MouseEvent&&(this.pageX=i.pageX,this.pageY=i.pageY),i&&ge&&i instanceof TouchEvent&&i.touches[0]&&(this.pageX=i.touches[0].pageX,this.pageY=i.touches[0].pageY)}}class fe{constructor(t){t&&t instanceof MouseEvent&&(this.x=t.pageX,this.y=t.pageY),t&&ge&&t instanceof TouchEvent&&t.touches[0]&&(this.x=t.touches[0].pageX,this.y=t.touches[0].pageY)}}const ye=new class{constructor(){this.delta=5,this.draggableItem=null,this.dragImage=null,this.finishedSuccessfully=!1,this.mouseDownPosition=null,this.containerDescriptors=[],this.containerDescriptorIndex=-1,this.dropEffect=pe.None,this.classPrefix="eqjs-drop",this.DRAG_DISABLED_ATTR="drag-disabled"}registerDraggableItem(t){const e=t.element;if(!e)throw Error("Element in draggle item is null or undefined");e.ondragstart=function(){return!1};const i=t=>{if(e.hasAttribute(this.DRAG_DISABLED_ATTR))return;t.preventDefault(),t instanceof MouseEvent&&t.stopPropagation();const i=new fe(t);(Math.abs(i.x-this.mouseDownPosition.x)>this.delta||Math.abs(i.y-this.mouseDownPosition.y)>this.delta)&&n(t)},s=t=>{this.mouseMoveDragListener(t)},n=n=>{n.preventDefault(),n.stopPropagation(),e.removeEventListener("mousemove",i),e.removeEventListener("touchmove",i),this.finishedSuccessfully=!1,t.beforeDragStart&&t.beforeDragStart(),this.dragImage=ue("div").setStyle("position","absolute").setStyle("z-index","65530").toDOM(),document.body.appendChild(this.dragImage),this.dragImage.appendChild(e.cloneNode(!0)),t.renderer&&t.renderer(this.dragImage),this.dropEffect=pe.None,this.updateCusror(this.dropEffect),this.updateImageClass(this.dropEffect),this.draggableItem={element:e,scope:t.scope,data:t.data},this.updateDragItemPosition(n);const a=new me(this.draggableItem,this.dragImage,n);a.dropEffect=this.dropEffect,t.onDragStart&&t.onDragStart(a),this.dropEffect!==a.dropEffect&&(this.dropEffect=a.dropEffect,this.updateImageClass(this.dropEffect)),document.addEventListener("mousemove",s,!0),document.addEventListener("touchmove",s,!0)},a=t=>{ge&&t instanceof TouchEvent&&t.preventDefault(),this.mouseDownPosition=new fe(t),e.addEventListener("mousemove",i),e.addEventListener("touchmove",i),document.addEventListener("mouseup",o),document.addEventListener("touchend",o)};e.addEventListener("mousedown",a),e.addEventListener("touchstart",a);const o=t=>{this.mouseDownPosition=null,e.removeEventListener("mousemove",i),e.removeEventListener("touchmove",i),document.removeEventListener("mousemove",s,!0),document.removeEventListener("touchmove",s,!0),this.draggableItem&&r(t)},r=e=>{try{if(this.containerDescriptorIndex>=0){const t=this.containerDescriptors[this.containerDescriptorIndex],i={element:t.element,scopes:t.scopes,data:t.data},s=new me(this.draggableItem,this.dragImage,e);try{i.scopes.indexOf(this.draggableItem.scope)>=0&&this.dropEffect===pe.Allow&&(this.finishedSuccessfully=!0,t.onDrop&&t.onDrop(i,s))}finally{t.onDragLeave&&t.onDragLeave(i,s)}}}finally{try{const i=new me(this.draggableItem,this.dragImage,e);i.data.finishedSuccessfully=this.finishedSuccessfully,t.onDragEnd&&t.onDragEnd(i)}finally{this.draggableItem=null,this.dragImage&&this.dragImage.parentElement&&this.dragImage.parentElement.removeChild(this.dragImage),this.dragImage=null,this.finishedSuccessfully=!1,document.removeEventListener("mouseup",o),document.removeEventListener("touchend",o)}}}}registerDropContainer(t){if(!t.element)throw Error("Element in drop container is null or undefined");this.containerDescriptors.push(t)}removeDropContainer(t){const e=this.containerDescriptors.filter((e=>e===t||e.element==t));if(e)for(const t of e)Qt.removeArrayItem(this.containerDescriptors,t)}mouseMoveDragListener(t){if(t instanceof MouseEvent&&t.preventDefault(),t.stopPropagation(),this.updateDragItemPosition(t),-1==this.containerDescriptorIndex){for(let e=0;e<this.containerDescriptors.length;e++){const i=this.containerDescriptors[e];if(this.detectDragEnterEvent(i.element,t)){this.containerDescriptorIndex=e;break}}this.containerDescriptorIndex>=0&&this.dragEnterEvent(t)}else{const e=this.containerDescriptors[this.containerDescriptorIndex];this.detectDragLeaveEvent(e.element,t)&&(this.dragLeaveEvent(t),this.containerDescriptorIndex=-1)}if(this.containerDescriptorIndex>=0){const e=this.containerDescriptors[this.containerDescriptorIndex],i={element:e.element,scopes:e.scopes,data:e.data};if(i.scopes.indexOf(this.draggableItem.scope)>=0){const s=new me(this.draggableItem,this.dragImage,t);s.dropEffect=this.dropEffect,e.onDragOver&&e.onDragOver(i,s)}}}updateCusror(t){switch(t){case pe.Allow:this.setCursorStyle(this.dragImage,"grabbing");break;case pe.Forbid:this.setCursorStyle(this.dragImage,"no-drop");break;default:this.setCursorStyle(this.dragImage,"grabbing")}}updateImageClass(t){switch(this.dragImage.classList.remove(`${this.classPrefix}-allow`),this.dragImage.classList.remove(`${this.classPrefix}-forbid`),this.dragImage.classList.remove(`${this.classPrefix}-none`),t){case pe.Allow:this.dragImage.classList.add(`${this.classPrefix}-allow`);break;case pe.None:this.dragImage.classList.add(`${this.classPrefix}-none`);break;case pe.Forbid:this.dragImage.classList.add(`${this.classPrefix}-forbid`);break;default:this.dragImage.classList.add(`${this.classPrefix}-none`)}}setCursorStyle(t,e){if(t){t.style.cursor=e;for(let i=0;i<t.children.length;i++)this.setCursorStyle(t.children[i],e)}}updateDragItemPosition(t){if(this.dragImage){const e=new fe(t);this.dragImage.style.top=e.y-this.dragImage.offsetHeight/2+"px",this.dragImage.style.left=e.x-this.dragImage.offsetWidth/2+"px"}}dragEnterEvent(t){const e=this.containerDescriptors[this.containerDescriptorIndex],i={element:e.element,scopes:e.scopes,data:e.data};if(i.scopes.indexOf(this.draggableItem.scope)>=0){const s=new me(this.draggableItem,this.dragImage,t);s.dropEffect=pe.Allow,e.onDragEnter&&e.onDragEnter(i,s),this.dropEffect=s.dropEffect,this.updateCusror(this.dropEffect),this.updateImageClass(this.dropEffect)}else this.dropEffect!==pe.Forbid&&(this.dropEffect=pe.None,this.updateCusror(this.dropEffect),this.updateImageClass(this.dropEffect))}dragLeaveEvent(t){const e=this.containerDescriptors[this.containerDescriptorIndex],i={element:e.element,scopes:e.scopes,data:e.data};if(i.scopes.indexOf(this.draggableItem.scope)>=0){const s=new me(this.draggableItem,this.dragImage,t);s.dropEffect=pe.None,e.onDragLeave&&e.onDragLeave(i,s),this.dropEffect=s.dropEffect,this.updateCusror(this.dropEffect),this.updateImageClass(this.dropEffect)}}detectDragEnterEvent(t,e){const i=oe(t),s=new fe(e);return!(s.y<i.y||s.y>i.y+t.offsetHeight||s.x<i.x||s.x>i.x+t.offsetWidth)}detectDragLeaveEvent(t,e){const i=oe(t),s=new fe(e);return!(s.y>i.y&&s.y<i.y+t.offsetHeight&&s.x>i.x&&s.x<i.x+t.offsetWidth)}};var De,we;!function(t){t[t.Always=0]="Always",t[t.Once=1]="Once",t[t.Never=2]="Never"}(De||(De={})),function(t){t[t.NONE=1]="NONE",t[t.LEFT=2]="LEFT",t[t.CENTER=3]="CENTER",t[t.RIGHT=4]="RIGHT"}(we||(we={}));class ve{constructor(t,e,i=!1){this._label=null,this._description=null,this.align=we.NONE,this.isVisible=!0,this.isRowNum=!1,this.dataColumn=t,this.grid=e;const s=e.options.columnWidths||{};t?(t.style.alignment&&(this.align=function(t){switch(t){case te.Left:return we.LEFT;case te.Center:return we.CENTER;case te.Right:return we.RIGHT;default:return we.NONE}}(t.style.alignment)),this.width=s&&s[this.type]?s[this.type].default:250,this._description=t.description):i&&(this.isRowNum=!0,this.width=s&&s.rowNumColumn?s.rowNumColumn.default:60,this._label="")}get label(){return this._label?this._label:this.isRowNum?"":this.dataColumn.label}set label(t){this._label=this.label}get description(){return this._description}get type(){return this.dataColumn?this.dataColumn.type:null}}class Ce{constructor(t,e){this.items=[],this.grid=e,this.sync(t)}sync(t,e=!0){this.clear();const i=new ve(null,this.grid,!0);if(this.add(i),e||(i.isVisible=!1),t)for(let e of t.getItems()){const t=new ve(e,this.grid);this.grid.options.onSyncGridColumn&&this.grid.options.onSyncGridColumn(t),this.add(t)}}get count(){return this.items.length}add(t){const e=this.items.length;return this.items.push(t),e}put(t,e){t>=0&&t<this.items.length&&(this.items[t]=e)}move(t,e){let i=this.items.indexOf(t);i>=0&&i!=e&&Qt.moveArrayItem(this.items,i,e)}get(t){return t>=0&&t<this.items.length?this.items[t]:null}getItems(){return this.items}removeAt(t){this.get(t),this.items.splice(t,1)}clear(){this.items=[]}}const Te="keg",be=/{0:(.*?)}/g;var Ee;!function(t){t[t.STRING=1]="STRING",t[t.NUMBER=2]="NUMBER",t[t.DATETIME=3]="DATETIME",t[t.BOOL=4]="BOOL"}(Ee||(Ee={}));const xe=(t,e,i,s)=>{const n=t?t.toString().replace(/\n/g,"↵ "):"";i.innerText=n,i.title=n,e.align==we.NONE&&i.classList.add(`${Te}-cell-value-align-left`)},Ie=(t,e,i,s)=>{let n=(t||"").toString();"number"==typeof t&&(n=e.dataColumn&&e.dataColumn.displayFormat&&be.test(e.dataColumn.displayFormat)?e.dataColumn.displayFormat.replace(be,((e,i)=>Zt.numberToStr(t,i))):t.toLocaleString()),i.innerText=n,i.title=n,e.align==we.NONE&&i.classList.add(`${Te}-cell-value-align-right`)},Se=(t,e,i,s)=>{const n="[object Date]"===Object.prototype.toString.call(t);let a=(t||"").toString();if(n)if(e.dataColumn&&e.dataColumn.displayFormat&&be.test(e.dataColumn.displayFormat))a=e.dataColumn.displayFormat.replace(be,((i,s)=>Zt.dateTimeToStrEx(t,e.type,s)));else{const i=Zt.getCurrentLocale(),s={hour:"numeric",minute:"numeric",second:"numeric"};switch(e.type){case Kt.Date:a=t.toLocaleDateString(i);break;case Kt.Time:a=t.toLocaleTimeString(i,s);break;case Kt.DateTime:a=`${t.toLocaleDateString(i)} ${t.toLocaleTimeString(i,s)}`}}i.innerText=a,i.title=a,e.align==we.NONE&&i.classList.add(`${Te}-cell-value-align-right`)},Me=(t,e,i,s)=>{if(e.dataColumn&&e.dataColumn.displayFormat&&be.test(e.dataColumn.displayFormat)){const s=e.dataColumn.displayFormat.replace(be,((e,i)=>Zt.booleanToStr(t,i)));return xe(s,e,i)}i.classList.add(`${Te}-cell-value-bool`),i.classList.add(`${Te}-${t?"cell-value-true":"cell-value-false"}`)};class Re{constructor(t){this.renderers={},this.defaultRenderers={},this.registerRenderer("StringDefault",xe),this.setDefaultRenderer(Ee.STRING,xe),this.registerRenderer("NumberDefault",Ie),this.setDefaultRenderer(Ee.NUMBER,Ie),this.registerRenderer("DateTimeDefault",Se),this.setDefaultRenderer(Ee.DATETIME,Se),this.registerRenderer("BoolDefault",Me),this.setDefaultRenderer(Ee.BOOL,Me)}getDefaultRenderer(t){const e=this.getCellType(t);return this.defaultRenderers[Ee[e]]}getDefaultRendererByType(t){return this.defaultRenderers[Ee[t]]}setDefaultRenderer(t,e){e&&(this.defaultRenderers[Ee[t]]=e)}getRenderer(t){return this.renderers[t]}registerRenderer(t,e){this.renderers[t]=e}getCellType(t){switch(t){case Kt.Autoinc:case Kt.Byte:case Kt.Word:case Kt.Currency:case Kt.Float:case Kt.Int32:case Kt.Int64:return Ee.NUMBER;case Kt.Date:case Kt.DateTime:case Kt.Time:return Ee.DATETIME;case Kt.Bool:return Ee.BOOL;default:return Ee.STRING}}}class Oe{constructor(t){if(this.cssPrefix="keg",this.pagination={page:1,pageSize:30,total:0},this.paginationOptions={maxButtonCount:10,useBootstrap:!1},this.defaultDataGridOptions={slot:null,dataTable:null,fixHeightOnFirstRender:!1,syncGridColumns:!0,useRowNumeration:!0,allowDragDrop:!1,aggregates:{settings:null,calculator:null},paging:{enabled:!0,pageSize:30,pageSizeItems:[20,30,50,100,200]},columnWidths:{autoResize:De.Always,stringColumns:{min:100,max:500,default:250},numberColumns:{min:60,default:120},boolColumns:{min:50,default:80},dateColumns:{min:80,default:200},otherColumns:{min:100,max:500,default:250},rowNumColumn:{min:40,default:60}},showPlusButton:!1,viewportRowsCount:null,showActiveRow:!0},this.rowsOnPagePromise=null,this.containerInitialHeight=0,this.firstRender=!0,this.prevRowTotals=null,this.landingIndex=-1,this.landingSlot=ue("div").addClass(`${this.cssPrefix}-col-landing-slot`).addChildElement(ue("div").toDOM()).toDOM(),this._activeRowIndex=-1,t&&t.paging&&(t.paging=Qt.assign(this.defaultDataGridOptions.paging,t.paging)),this.options=this.mergeOptions(t),this.processColumnWidthsOptions(),!this.options.slot)throw Error('"slot" parameter is required to initialize EasyDataGrid');if(!this.options.dataTable)throw Error('"dataTable" parameter is required to initialize EasyDataGrid');this.dataTable=t.dataTable,this.eventEmitter=new ae(this),this.cellRendererStore=new Re(t),this.columns=new Ce(this.dataTable.columns,this),this.setSlot(this.options.slot),this.init(this.options)}mergeOptions(t){const e=Qt.assignDeep({},this.defaultDataGridOptions.columnWidths,t.columnWidths),i=Qt.assignDeep({},this.defaultDataGridOptions.paging,t.paging),s=Qt.assign({},this.defaultDataGridOptions,t);return s.columnWidths=e,s.paging=i,s}processColumnWidthsOptions(){const t=this.options.columnWidths;if(!t)return;Qt.getStringDataTypes().forEach((e=>{t[e]=Object.assign(Object.assign({},t.stringColumns),t[e])})),Qt.getNumericDataTypes().forEach((e=>{t[e]=Object.assign(Object.assign({},t.numberColumns),t[e])})),t[Kt.Bool]=Object.assign(Object.assign({},t.boolColumns),t[Kt.Bool]),Qt.getDateDataTypes().forEach((e=>{t[e]=Object.assign(Object.assign({},t.dateColumns),t[e])}));const e=[...Qt.getStringDataTypes(),...Qt.getNumericDataTypes(),...Qt.getDateDataTypes(),Kt.Bool];Qt.getAllDataTypes().forEach((i=>{i in e||(t[i]=Object.assign(Object.assign({},t.otherColumns),t[i]))})),t[Kt.Unknown]=t.otherColumns}setSlot(t){if("string"==typeof t){if(t.length)if("#"===t[0])this.slot=document.getElementById(t.substring(1));else{if("."!==t[0])throw Error("Unrecognized slot parameter (Must be id, class or HTMLElement): "+t);{const e=document.getElementsByClassName(t.substring(1));e.length&&(this.slot=e[0])}}}else this.slot=t}init(t){t.onInit&&this.addEventListener("init",t.onInit),t.onRowClick&&this.addEventListener("rowClick",t.onRowClick),t.onRowDbClick&&this.addEventListener("rowDbClick",t.onRowDbClick),t.onPlusButtonClick&&this.addEventListener("plusButtonClick",t.onPlusButtonClick),t.onColumnChanged&&this.addEventListener("columnChanged",t.onColumnChanged),t.onColumnDeleted&&this.addEventListener("columnDeleted",t.onColumnDeleted),t.onColumnMoved&&this.addEventListener("columnMoved",t.onColumnMoved),t.onPageChanged&&this.addEventListener("pageChanged",t.onPageChanged),t.onActiveRowChanged&&this.addEventListener("activeRowChanged",t.onActiveRowChanged),this.addEventListener("pageChanged",(t=>this.activeRowIndex=-1)),Qt.assignDeep(this.paginationOptions,t.pagination),this.pagination.pageSize=this.options.paging.pageSize||this.pagination.pageSize,this.options.allowDragDrop&&ye.registerDropContainer({element:this.slot,scopes:["gridColumnMove"],onDragEnter:(t,e)=>{this.slot.classList.add(`${re}-drophover`),this.showLandingSlot(e.pageX,e.pageY)},onDragOver:(t,e)=>{this.showLandingSlot(e.pageX,e.pageY)},onDragLeave:(t,e)=>{e.dropEffect=pe.Forbid,this.slot.classList.remove(`${re}-drophover`),this.hideLandingSlot()},onDrop:(t,e)=>{this.dataTable.columns.move(e.data.column,this.landingIndex),this.refresh(),this.fireEvent({type:"columnMoved",columnId:e.data.column.id,newIndex:this.landingIndex})}}),this.refresh(),this.fireEvent("init")}fireEvent(t){"string"==typeof t?this.eventEmitter.fire(t):this.eventEmitter.fire(t.type,t)}setData(t){this.dataTable=t,this.clear(),this.refresh()}getData(){return this.dataTable}getColumns(){return this.columns}destroy(){this.slot.innerHTML=""}refresh(){this.clearDOM(),this.render()}clearDOM(){this.slot.innerHTML=""}clear(){this.pagination.page=1,this.clearDOM()}render(){if(!this.hasData()&&!this.options.showPlusButton)return;this.containerInitialHeight=this.slot.clientHeight,this.rootDiv=document.createElement("div"),this.rootDiv.style.width="100%",this.rootDiv.classList.add(`${this.cssPrefix}-root`),this.columns.sync(this.dataTable.columns,this.options.useRowNumeration),this.renderHeader(),this.rootDiv.appendChild(this.headerDiv),this.renderBody(),this.rootDiv.appendChild(this.bodyDiv),this.renderFooter(),this.rootDiv.appendChild(this.footerDiv);let t=document.createElement("div");t.classList.add(`${this.cssPrefix}-container`),t.appendChild(this.rootDiv),this.slot.appendChild(t);const e=this.options.columnWidths.autoResize!==De.Never;this.rowsOnPagePromise?this.rowsOnPagePromise.then((()=>this.updateHeight())).then((()=>{this.firstRender=!1,this.rowsOnPagePromise=null})):setTimeout((()=>{this.updateHeight().then((()=>{this.firstRender=!1,e&&this.resizeColumns()}))}),100)}updateHeight(){return new Promise((t=>{if(this.options.viewportRowsCount){const e=this.bodyCellContainerDiv.firstElementChild;let i=(e?e.offsetHeight:36)*this.options.viewportRowsCount;return ue(this.bodyViewportDiv).setStyle("height",`${i}px`),void setTimeout((()=>{const e=this.bodyViewportDiv.offsetHeight-this.bodyViewportDiv.clientHeight;i+=e,ue(this.bodyViewportDiv).setStyle("height",`${i}px`),t()}),100)}this.containerInitialHeight,t()})).then((()=>{this.options.fixHeightOnFirstRender&&this.firstRender&&(this.slot.style.height=`${this.slot.offsetHeight}px`)}))}getContainerWidth(){return this.columns.getItems().filter((t=>t.isVisible)).map((t=>t.width)).reduce(((t,e)=>t+e))}renderHeader(){this.headerDiv=ue("div").addClass(`${this.cssPrefix}-header`).toDOM(),this.headerViewportDiv=ue("div",this.headerDiv).addClass(`${this.cssPrefix}-header-viewport`).toDOM(),this.headerCellContainerDiv=ue("div",this.headerViewportDiv).addClass(`${this.cssPrefix}-header-cell-container`).toDOM(),this.headerRowDiv=ue("div",this.headerCellContainerDiv).addClass(`${this.cssPrefix}-header-row`).toDOM(),this.columns.getItems().forEach(((t,e)=>{if(!t.isVisible)return;let i=this.renderColumnHeader(t,e);this.headerRowDiv.appendChild(i),t.isRowNum&&ue(i).addChildElement(this.renderHeaderButtons())}));const t=this.getContainerWidth();ue(this.headerCellContainerDiv).setStyle("width",`${t}px`)}hasData(){return this.dataTable.columns.count>0}renderColumnHeader(t,e){let i=ue("div").addClass(`${this.cssPrefix}-header-cell`).data("col-idx",`${e}`).setStyle("width",`${t.width}px`);t.dataColumn&&i.data("col-id",`${t.dataColumn.id}`);let s=i.toDOM();return ue("div",s).addClass(`${this.cssPrefix}-header-cell-resize`),t.isRowNum||ue("div",s).addClass(`${this.cssPrefix}-header-cell-label`).text(t.label),t.description&&ue("div",s).addClass("question-mark").title(t.description),this.options.allowDragDrop&&ye.registerDraggableItem({element:s,scope:"gridColumnMove",data:{column:t},renderer:e=>{e.innerHTML="";const i=document.createElement("div");i.innerText=t.label,e.classList.add(`${this.cssPrefix}-sortable-helper`),e.appendChild(i)},onDragStart:t=>{t.dropEffect=pe.Allow}}),s}renderBody(){this.bodyDiv=ue("div").addClass(`${this.cssPrefix}-body`).toDOM(),this.bodyViewportDiv=ue("div",this.bodyDiv).addClass(`${this.cssPrefix}-body-viewport`).attr("tabIndex","0").toDOM(),this.bodyCellContainerDiv=ue("div",this.bodyViewportDiv).addClass(`${this.cssPrefix}-cell-container`).toDOM();const t=this.canShowAggregates();this.dataTable&&(this.showProgress(),this.rowsOnPagePromise=this.getRowsToRender().then((e=>{this.pagination.total=this.dataTable.getTotal(),this.hideProgress(),this.bodyCellContainerDiv.innerHTML="",this.prevRowTotals=null;let i=0;if(e.length){const s=t?this.options.aggregates.settings.getGroups():[];i=e.length<this.pagination.pageSize?e.length:this.pagination.pageSize,e.forEach(((e,n)=>{if(t&&this.updateTotalsState(s,e),n<i){const t=this.renderRow(e,n);this.bodyCellContainerDiv.appendChild(t)}}));const n=this.options.aggregates&&this.options.aggregates.showGrandTotalsOnEachPage;if(t&&(this.isLastPage()||n)){const t=new se(this.dataTable.columns,new Array(this.dataTable.columns.count));this.updateTotalsState(s,t,!0)}}if(this.options.columnWidths.autoResize!==De.Never)this.resizeColumns();else{const t=this.getContainerWidth();ue(this.bodyCellContainerDiv).setStyle("width",`${t}px`)}return i})).catch((t=>(console.error(t),0)))),this.bodyViewportDiv.addEventListener("scroll",(t=>{ue(this.headerViewportDiv).setStyle("margin-left",`-${this.bodyViewportDiv.scrollLeft}px`)})),this.bodyViewportDiv.addEventListener("keydown",this.onViewportKeydown.bind(this))}isLastPage(){return this.dataTable.elasticChunks?this.dataTable.totalIsKnown()&&this.pagination.page*this.pagination.pageSize>=this.pagination.total:this.pagination.page*this.pagination.pageSize>=this.pagination.total}canShowAggregates(){if(!this.options||!this.options.aggregates||!this.options.aggregates.settings)return!1;const t=this.options.aggregates.settings;return(t.hasAggregates()||t.hasRecordCount())&&(t.hasGroups()||t.hasGrandTotals())}updateTotalsState(t,e,i=!1){const s=this.options.aggregates.settings;if(this.prevRowTotals&&s.hasGroups()){let i=-1;for(let n=1;n<=t.length;n++){const a=t[n-1];for(const t of a.columns)if(!s.compareValues(this.prevRowTotals.getValue(t),e.getValue(t))){i=n;break}if(-1!==i)break}if(-1!==i)for(let e=t.length;e>=i;e--){const t=new se(this.dataTable.columns,this.prevRowTotals.toArray()),i=this.renderTotalsRow(e,t);this.bodyCellContainerDiv.appendChild(i)}}if(i&&s.hasGrandTotals()&&s.hasAggregates()){const t=this.renderTotalsRow(0,e);this.bodyCellContainerDiv.appendChild(t)}this.prevRowTotals=e}applyGroupColumnTemplate(t,e,i){let s=t.replace(/{{\s*GroupValue\s*}}/g,e?`${e}`:"-");return s=s.replace(/{{\s*GroupCount\s*}}/g,i?`${i}`:"-"),s}renderTotalsRow(t,e){const i=this.options.aggregates.settings,s=t>0?i.getGroups()[t-1]:{columns:[],aggregates:i.getAggregates()},n=ue("div").addClass(`${this.cssPrefix}-row`).addClass(`${this.cssPrefix}-row-totals`).addClass(`${this.cssPrefix}-totals-lv${t}`).data("totals-level",`${t}`).attr("tabindex","-1").toDOM();this.columns.getItems().forEach(((t,i)=>{if(!t.isVisible)return;let a="";const o=t.isRowNum?-1:this.dataTable.columns.getIndex(t.dataColumn.id);!t.isRowNum&&t.dataColumn&&s.columns.indexOf(t.dataColumn.id)>=0&&(a=e.getValue(o)),o==this.dataTable.columns.count-1&&(a=".  .  .  .  .  ."),n.appendChild(this.renderCell(t,i,a,n))}));const a=this.options.aggregates.calculator.getAggrContainer(),o=i.getAggregates().map((t=>t.colId)),r=i.buildGroupKey(s,e);return a.getAggregateData(t,r).then((a=>{for(const t of o)e.setValue(t,a[t]);n.innerHTML="",this.columns.getItems().forEach(((r,l)=>{if(!r.isVisible)return;let h="";const d=r.isRowNum?-1:this.dataTable.columns.getIndex(r.dataColumn.id);if(!r.isRowNum){let c=!1;if(r.dataColumn){const i=s.columns.indexOf(r.dataColumn.id),n=o.indexOf(r.dataColumn.id);c=t>0?i==s.columns.length-1:0==d,(i>=0||n>=0)&&(h=e.getValue(d))}let u="";t>0&&(u=r.dataColumn.groupFooterColumnTemplate,!u&&i.hasRecordCount()&&c&&(u="{{GroupValue}} ({{GroupCount}})")),u&&(h=this.renderCell(r,l,h,n).firstChild.innerHTML,h=this.applyGroupColumnTemplate(u,h,a[i.COUNT_FIELD_NAME]))}const c=this.renderCell(r,l,h,n);n.appendChild(c)}))})).catch((t=>console.error(t))),n}onViewportKeydown(t){if(this.options.showActiveRow){const e=this.bodyCellContainerDiv.querySelectorAll(`.${this.cssPrefix}-row`).length;let i;switch(t.key){case"ArrowLeft":case"ArrowRight":break;case"ArrowUp":t.preventDefault(),i=this.activeRowIndex<0||this.activeRowIndex>=e?e-1:this.activeRowIndex-1,this.activeRowIndex=i>=0?i:0;break;case"ArrowDown":t.preventDefault(),i=this.activeRowIndex<0||this.activeRowIndex>=e?0:this.activeRowIndex+1,this.activeRowIndex=i<e?i:e-1}}}ensureRowVisibility(t){const e="number"==typeof t?this.getDataRow(t):t;if(e){let t=e.getBoundingClientRect();const i=this.bodyViewportDiv.getBoundingClientRect(),s=t.top-i.top,n=t.bottom-i.top,a=this.bodyViewportDiv.clientHeight,o=window.innerHeight||document.documentElement.clientHeight;if(s>0&&n<=a&&t.top>0&&t.bottom<o)return;s<0?this.bodyViewportDiv.scrollTop=this.bodyViewportDiv.scrollTop+s:n>a&&(this.bodyViewportDiv.scrollTop=this.bodyViewportDiv.scrollTop+n-a),t=e.getBoundingClientRect(),t.top<0?document.documentElement.scrollTop=document.documentElement.scrollTop+t.top:t.bottom>o&&(document.documentElement.scrollTop=document.documentElement.scrollTop+t.bottom-o)}}getRowsToRender(){return!1===this.options.paging.enabled?Promise.resolve(this.dataTable.getCachedRows()):this.dataTable.getRows({offset:(this.pagination.page-1)*this.pagination.pageSize,limit:this.pagination.pageSize+1}).catch((t=>(console.error(t),[])))}renderFooter(){this.footerDiv=ue("div").addClass(`${this.cssPrefix}-footer`).toDOM(),this.rowsOnPagePromise&&this.rowsOnPagePromise.then((t=>{this.footerDiv.innerHTML="",this.footerPaginateDiv=this.renderPageNavigator(),this.footerDiv.appendChild(this.footerPaginateDiv);const e=this.renderPageInfoBlock(t);this.footerDiv.appendChild(e)}))}renderPageInfoBlock(t){const e=ue("div").addClass(`${this.cssPrefix}-page-info`).toDOM();if(this.dataTable.getTotal()>0){const i=t?(this.pagination.page-1)*this.pagination.pageSize+1:0,s=t?i+t-1:0;let n=this.dataTable.getTotal().toString();this.dataTable.elasticChunks&&this.dataTable.getCachedCount()!==this.dataTable.getTotal()&&(n="?"),e.innerHTML=Zt.getText("GridPageInfo").replace("{FirstPageRecordNum}",`<span>${i.toString()}</span>`).replace("{LastPageRecordNum}",`<span>${s.toString()}</span>`).replace("{Total}",`<span>${n}</span>`)}return e}showProgress(){}hideProgress(){}getLocalIndexByGlobal(t){return this.pagination?t%this.pagination.pageSize:t}getGlobalIndexByLocal(t){return this.pagination?(this.pagination.page-1)*this.pagination.pageSize+t:t}renderRow(t,e){let i=this.getGlobalIndexByLocal(e),s=ue("div").addClass(`${this.cssPrefix}-row`).addClass(`${this.cssPrefix}-row-${e%2==1?"odd":"even"}`).data("row-idx",`${i}`).attr("tabindex","-1").on("click",(i=>{this.activeRowIndex=e,this.fireEvent({type:"rowClick",row:t,rowIndex:e,sourceEvent:i})})).on("dblclick",(i=>{this.fireEvent({type:"rowDbClick",row:t,rowIndex:e,sourceEvent:i})}));0==e&&s.addClass(`${this.cssPrefix}-row-first`);let n=s.toDOM();return this.options.showActiveRow&&e==this.activeRowIndex&&s.addClass(`${this.cssPrefix}-row-active`),this.columns.getItems().forEach(((e,s)=>{if(!e.isVisible)return;const a=e.isRowNum?-1:this.dataTable.columns.getIndex(e.dataColumn.id);let o=e.isRowNum?i+1:t.getValue(a);n.appendChild(this.renderCell(e,s,o,n))})),n}renderCell(t,e,i,s){const n=ue("div").addClass(`${this.cssPrefix}-cell`).data("col-idx",`${e}`).attr("tabindex","-1").setStyle("width",`${t.width}px`);t.align==we.LEFT?n.addClass(`${this.cssPrefix}-cell-align-left`):t.align==we.RIGHT?n.addClass(`${this.cssPrefix}-cell-align-right`):t.align==we.CENTER&&n.addClass(`${this.cssPrefix}-cell-align-center`);const a=n.toDOM(),o=a.appendChild(ue("div").addClass(`${this.cssPrefix}-cell-value`).toDOM()),r=this.getCellRenderer(t);return r&&r(i,t,o,s),a}getCellRenderer(t){let e;return e=t.isRowNum?this.cellRendererStore.getDefaultRendererByType(Ee.NUMBER):this.cellRendererStore.getDefaultRenderer(t.type),this.options&&this.options.onGetCellRenderer&&(e=this.options.onGetCellRenderer(t,e)||e),e}setPage(t){this.pagination.page=t,this.fireEvent({type:"pageChanged",page:t}),this.refresh(),this.bodyViewportDiv.focus()}renderPageNavigator(){let t=document.createElement("div");t.className=`${this.cssPrefix}-pagination-wrapper`;const e=this.dataTable.getTotal();if(this.options.paging&&this.options.paging.enabled&&e>0){const e=this.paginationOptions.useBootstrap?"":`${this.cssPrefix}-`,i=t=>{const e=t.target;if(e.hasAttribute("data-page")){const t=parseInt(e.getAttribute("data-page"));this.setPage(t)}},s=(t,s,n,a,o)=>{const r=document.createElement("li");if(r.className=`${e}page-item`,!a){o&&(r.className+=" active");const n=document.createElement("a");return n.setAttribute("href","javascript:void(0)"),n.innerHTML=s||t.toString(),n.setAttribute("data-page",`${t}`),n.className=`${e}page-link`,n.addEventListener("click",i),r.appendChild(n),r}let l=document.createElement("span");if(l.setAttribute("aria-hidden","true"),l.className=`${e}page-link`,n)r.className+=" disabled";else{if(this.paginationOptions.useBootstrap)l=document.createElement("a"),l.setAttribute("href","javascript:void(0)"),l.setAttribute("data-page",`${t}`);else{let e=document.createElement("a");e.setAttribute("href","javascript:void(0)"),e.setAttribute("data-page",`${t}`),l=e}l.className=`${e}page-link`,l.addEventListener("click",i)}return l.innerHTML=s,r.appendChild(l),r};if(this.dataTable.elasticChunks){const i=this.pagination.page||1;let n=document.createElement("ul");n.className=`${e}pagination`;let a=s(i-1,"&laquo;",1==i,!0,!1);n.appendChild(a),a=s(i+1,"&raquo;",this.isLastPage(),!0,!1),n.appendChild(a),t.appendChild(n)}else if(this.pagination.total>this.pagination.pageSize){const i=this.pagination.page||1,n=Math.ceil(this.pagination.total/this.pagination.pageSize)||1,a=this.paginationOptions.maxButtonCount||10,o=i-1;let r=o-o%a+1,l=r+a-1;l>n&&(l=n);let h=document.createElement("ul");h.className=`${e}pagination`;let d=s(r-1,"&laquo;",1==r,!0,!1);h.appendChild(d);for(let t=r;t<=l;t++)d=s(t,t.toString(),!1,!1,t==i),h.appendChild(d);d=s(l+1,"&raquo;",l==n,!0,!1),h.appendChild(d),t.appendChild(h)}if(this.options.paging.allowPageSizeChange){const e=t=>{const e=parseInt(t.target.value);this.pagination.pageSize=e,this.pagination.page=1,this.refresh()},i=document.createElement("div");i.className=`${this.cssPrefix}-page-sizes`;const s=document.createElement("div");s.className=`kfrm-select ${this.cssPrefix}-page-sizes-select`,i.appendChild(s);const n=document.createElement("select"),a=this.options.paging.pageSizeItems||[],o=new Set(a);o.add(this.options.paging.pageSize||20),Array.from(o).forEach((t=>{const e=document.createElement("option");e.value=t.toString(),e.text=t.toString(),n.appendChild(e)})),n.value=(this.pagination.pageSize||20).toString(),s.appendChild(n),n.addEventListener("change",e);const r=document.createElement("div");r.className=`${this.cssPrefix}-page-sizes-label`,i.appendChild(r);const l=document.createElement("span");l.innerText=Zt.getText("GridItemsPerPage"),r.appendChild(l),t.appendChild(i)}}return t}addEventListener(t,e){return this.eventEmitter.subscribe(t,(t=>e(t.data)))}removeEventListener(t,e){this.eventEmitter.unsubscribe(t,e)}renderHeaderButtons(){return this.options.showPlusButton?ue("div").addClass(`${this.cssPrefix}-header-btn-plus`).title(this.options.plusButtonTitle||"Add").addChild("a",(t=>t.attr("href","javascript:void(0)").on("click",(t=>{t.preventDefault(),this.fireEvent({type:"plusButtonClick",sourceEvent:t})})))).toDOM():ue("span").addText("#").toDOM()}showLandingSlot(t,e){const i=this.headerRowDiv.querySelectorAll(`[class*=${this.cssPrefix}-table-col]`),s=[];for(let t=1;t<i.length;t++){const e=i[t];"none"!==e.style.display&&s.push(e)}if(0===s.length)return this.landingIndex=0,void this.headerRowDiv.appendChild(this.landingSlot);const n=oe(this.landingSlot);if(t>=n.x&&t<=n.x+this.landingSlot.offsetWidth)return;let a=this.landingIndex;for(let e of s){const i=oe(e),s=e.offsetWidth;t>i.x&&t<i.x+s&&(a=parseInt(e.getAttribute("data-col-idx"))-1)}a!=this.landingIndex&&(this.landingIndex=a,this.landingIndex<s.length?this.headerRowDiv.insertBefore(this.landingSlot,s[this.landingIndex]):this.headerRowDiv.appendChild(this.landingSlot))}hideLandingSlot(){this.landingIndex=-1,setTimeout((()=>{this.landingSlot.parentElement&&this.landingSlot.parentElement.removeChild(this.landingSlot)}),10)}get activeRowIndex(){return this._activeRowIndex}set activeRowIndex(t){if(t!==this._activeRowIndex){const e=this._activeRowIndex;this._activeRowIndex=t,this.updateActiveRow(),this.fireEvent({type:"activeRowChanged",oldValue:e,newValue:this.activeRowIndex,rowIndex:this.getGlobalIndexByLocal(this.activeRowIndex)})}}updateActiveRow(){if(this.options.showActiveRow){this.bodyCellContainerDiv.querySelectorAll(`[class*=${this.cssPrefix}-row-active]`).forEach((t=>{t.classList.remove(`${this.cssPrefix}-row-active`)}));const t=this.getActiveRow();t&&(t.classList.add(`${this.cssPrefix}-row-active`),this.ensureRowVisibility(this.activeRowIndex))}}getActiveRow(){return this.getDataRow(this.activeRowIndex)}getDataRow(t){const e=Array.from(this.bodyCellContainerDiv.querySelectorAll(`.${this.cssPrefix}-row:not(.${this.cssPrefix}-row-totals)`));return t>=0&&t<e.length?e[t]:null}focus(){this.bodyViewportDiv.focus()}resizeColumns(){if(this.options.columnWidths.autoResize===De.Never)return;const t=this.bodyCellContainerDiv.style.width;this.bodyCellContainerDiv.style.visibility="hidden",this.bodyCellContainerDiv.style.width="1px",this.headerRowDiv.style.width="1px";let e=0;const i=this.columns.getItems(),s=this.headerCellContainerDiv.querySelectorAll(`.${this.cssPrefix}-header-cell`);let n=0;for(let t=0;t<this.columns.count;t++){const a=i[t];if(!a.isVisible)continue;const o=this.options.columnWidths.autoResize!==De.Always&&a.dataColumn?a.dataColumn.calculatedWidth:0,r=this.bodyCellContainerDiv.querySelectorAll(`.${this.cssPrefix}-cell[data-col-idx="${t}"] > .${this.cssPrefix}-cell-value`);let l=0;if(o>0)e+=o,a.width=o,r.forEach((t=>{t.parentElement.style.width=`${o}px`})),s[n].style.width=`${o}px`;else if(0==r.length&&(s[n].style.width=null,s[n].style.whiteSpace="nowrap"),l=s[n].offsetWidth,r.length>0){r.forEach((t=>{t.parentElement.style.width=null;const e=t.parentElement.offsetWidth;e>l&&(l=e)})),l+=3;const t=a.isRowNum?this.options.columnWidths.rowNumColumn.max||500:this.options.columnWidths[a.dataColumn.type].max||2e3,i=a.isRowNum?this.options.columnWidths.rowNumColumn.min||0:this.options.columnWidths[a.dataColumn.type].min||20;l>t&&(l=t),l<i&&(l=i),Qt.isNumericType(a.type)&&(l=Math.round(1.3*l)),e+=l,a.width=l,r.forEach((t=>{t.parentElement.style.width=`${l}px`})),s[n].style.width=`${l}px`,a.dataColumn&&(a.dataColumn.calculatedWidth=l)}else e+=l;n++}e>0?(this.bodyCellContainerDiv.style.width=`${e}px`,this.headerCellContainerDiv.style.width=`${e}px`):(this.bodyCellContainerDiv.style.width=t,this.headerCellContainerDiv.style.width=t),this.bodyCellContainerDiv.style.visibility=null,this.headerRowDiv.removeAttribute("style")}}class Ae{get cssPrefix(){return"kdtp-cal"}constructor(t,e){this.slot=t,this.options=e||{},this.options.yearRange||(this.options.yearRange="c-10:c+10")}setDate(t){this.currentDate=new Date(t)}getDate(){return new Date(this.currentDate)}dateChanged(t){this.options.onDateChanged&&this.options.onDateChanged(this.currentDate,t)}}class ke{get cssPrefix(){return"kdtp"}constructor(t){this.calendar=null,this.timePicker=null,this.options=t,this.render()}setDateTime(t){this.currentDateTime=new Date(t),this.calendar&&this.calendar.setDate(this.currentDateTime),this.timePicker&&this.timePicker.setTime(this.currentDateTime)}getDateTime(){return new Date(this.currentDateTime)}render(){this.options.showCalendar&&(this.calendar=this.createCalendar({yearRange:this.options.yearRange,showDateTimeInput:this.options.showDateTimeInput,timePickerIsUsed:this.options.showTimePicker,oneClickDateSelection:this.options.oneClickDateSelection,onDateChanged:(t,e)=>{this.currentDateTime=t,this.timePicker&&this.timePicker.setTime(this.currentDateTime),this.options.showTimePicker&&this.dateTimeChanged(),e&&this.apply(this.currentDateTime)}}),this.calendar&&this.calendar.render()),this.options.showTimePicker&&(this.timePicker=this.createTimePicker({onTimeChanged:t=>{this.currentDateTime.setHours(t.getHours()),this.currentDateTime.setMinutes(t.getMinutes()),this.calendar&&this.calendar.setDate(this.currentDateTime),this.dateTimeChanged()}}),this.timePicker&&this.timePicker.render()),this.setDateTime(new Date)}createCalendar(t){return null}createTimePicker(t){return null}show(t){this.options.beforeShow&&this.options.beforeShow();const e=oe(t||document.body);this.slot.style.top=e.y+t.clientHeight+"px",this.slot.style.left=e.x+"px"}apply(t){this.options.onApply&&this.options.onApply(t),this.destroy()}cancel(){this.options.onCancel&&this.options.onCancel(),this.destroy()}destroy(){this.slot&&this.slot.parentElement&&this.slot.parentElement.removeChild(this.slot)}dateTimeChanged(){this.options.onDateTimeChanged&&this.options.onDateTimeChanged(this.currentDateTime)}}class Pe extends Ae{constructor(t,e){super(t,e),this.daysOfWeek=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this.months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.calendarBody=null,this.isManualInputChanging=!1;for(let t=0;t<this.daysOfWeek.length;t++)this.daysOfWeek[t]=Zt.getShortWeekDayName(t+1);for(let t=0;t<this.months.length;t++)this.months[t]=Zt.getLongMonthName(t+1)}setDate(t){super.setDate(t),this.selectedMonth=this.currentDate.getMonth(),this.selectedYear=this.currentDate.getFullYear(),this.rerenderMonth()}render(){const t=ue("div",this.slot).addClass(`${this.cssPrefix}-header`);this.options.showDateTimeInput?t.addChildElement(this.renderManualDateInput()):t.addChild("span",(t=>this.headerTextElem=t.toDOM())),ue(this.slot).addChildElement(this.renderCalendarButtons()),this.calendarBody=ue("div",this.slot).addClass(`${this.cssPrefix}-body`).toDOM()}getInputDateFormat(){const t=Zt.getLocaleSettings();return this.options.timePickerIsUsed?`${t.editDateFormat} ${t.editTimeFormat}`:t.editDateFormat}renderManualDateInput(){const t=this.getInputDateFormat(),e=ue("input").attr("placeholder",t).addClass(`${this.cssPrefix}-header-input`);return e.mask(t.replace("yyyy","9999").replace("MM","99").replace("dd","99").replace("HH","99").replace("mm","99").replace("ss","99")).on("input",(i=>{e.removeClass("error");try{this.isManualInputChanging=!0;const e=Qt.strToDateTime(this.manualInputElem.value,t);this.currentDate=e,this.jump(this.currentDate.getFullYear(),this.currentDate.getMonth()),this.dateChanged(!1)}catch(t){e.addClass("error")}finally{this.isManualInputChanging=!1}})).on("keydown",(t=>{13===t.keyCode&&(t.preventDefault(),t.stopPropagation(),this.manualInputElem.className.indexOf("error")<0&&!this.isManualInputChanging&&this.dateChanged(!0))})).on("focus",(()=>{setTimeout((()=>{this.manualInputElem.selectionStart=0,this.manualInputElem.selectionEnd=0}),50)})),this.manualInputElem=e.toDOM(),this.manualInputElem}updateDisplayedDateValue(){if(this.manualInputElem){if(!this.isManualInputChanging){const t=this.getInputDateFormat();this.manualInputElem.value=Zt.dateTimeToStr(this.currentDate,t),this.manualInputElem.focus()}}else if(this.headerTextElem){const t=Zt.getCurrentLocale();this.headerTextElem.innerText=this.currentDate.toLocaleString("en"==t?void 0:t,{year:"numeric",month:"long",day:"numeric"})}}renderCalendarButtons(){return ue("nav").addClass(`${this.cssPrefix}-nav`).addChild("div",(t=>t.addClass(`${this.cssPrefix}-nav-prev`).on("click",(()=>{this.prev()})).addChild("span",(t=>t.html("&lsaquo;"))))).addChild("div",(t=>t.addClass(`${this.cssPrefix}-nav-selectors`).addChild("div",(t=>t.addClass(`${this.cssPrefix}-nav-month`).addChild("select",(t=>{t.on("change",(()=>{this.jump(this.selectedYear,parseInt(this.selectMonthElem.value))}));for(let e=0;e<this.months.length;e++)t.addChild("option",(t=>t.attr("value",e.toString()).text(this.months[e])));this.selectMonthElem=t.toDOM()})))).addChild("div",(t=>t.addClass(`${this.cssPrefix}-nav-year`).addChild("select",(t=>this.selectYearElem=t.on("change",(()=>{this.jump(parseInt(this.selectYearElem.value),this.selectedMonth)})).toDOM())))))).addChild("div",(t=>t.addClass(`${this.cssPrefix}-nav-next`).on("click",(()=>{this.next()})).addChild("span",(t=>t.html("&rsaquo;"))))).toDOM()}prev(){this.selectedYear=0===this.selectedMonth?this.selectedYear-1:this.selectedYear,this.selectedMonth=0===this.selectedMonth?11:this.selectedMonth-1,this.rerenderMonth()}next(){this.selectedYear=11===this.selectedMonth?this.selectedYear+1:this.selectedYear,this.selectedMonth=(this.selectedMonth+1)%12,this.rerenderMonth()}rerenderSelectYear(){const t=/c-(\d*):c\+(\d*)/g.exec(this.options.yearRange);let e=0,i=1;null!==t&&(e=parseInt(t[1]),i=parseInt(t[2])),this.selectYearElem.innerHTML="";for(let t=0;t<=e+i;t++){let i=document.createElement("option"),s=this.selectedYear-e+t;i.value=s.toString(),i.innerText=s.toString(),this.selectYearElem.appendChild(i)}}jump(t,e){this.selectedYear=t,this.selectedMonth=e,this.rerenderMonth()}rerenderMonth(){this.updateDisplayedDateValue(),this.rerenderSelectYear();let t=new Date(this.selectedYear,this.selectedMonth).getDay(),e=new Date(this.selectedYear,this.selectedMonth+1,0).getDate();this.calendarBody.innerHTML="",this.selectYearElem.value=this.selectedYear.toString(),this.selectMonthElem.value=this.selectedMonth.toString(),this.daysOfWeek.forEach(((t,e)=>{ue("div",this.calendarBody).addClass(`${this.cssPrefix}-weekday`).addClass(0==e||6==e?`${this.cssPrefix}-weekend`:"").text(t)}));for(let e=0;e<t;e++)ue("div",this.calendarBody).addClass(`${this.cssPrefix}-day-empty`);const i=new Date;for(let s=1;s<=e;s++){const e=ue("div",this.calendarBody).addClass(`${this.cssPrefix}-day`).attr("data-date",s.toString()).text(s.toString()).on("click",(t=>{this.currentDate.setFullYear(this.selectedYear),this.currentDate.setMonth(this.selectedMonth),this.currentDate.setDate(parseInt(t.target.getAttribute("data-date"))),this.dateChanged(this.options.oneClickDateSelection)}));s===i.getDate()&&this.selectedYear===i.getFullYear()&&this.selectedMonth===i.getMonth()&&e.addClass(`${this.cssPrefix}-day-current`),s===this.currentDate.getDate()&&this.selectedYear===this.currentDate.getFullYear()&&this.selectedMonth===this.currentDate.getMonth()&&e.addClass(`${this.cssPrefix}-day-selected`);const n=(t+s-1)%7;0!=n&&6!=n||e.addClass(`${this.cssPrefix}-weekend`),"function"==typeof this.options.onDrawDay&&this.options.onDrawDay.apply(e.toDOM(),[e.toDOM(),new Date(this.selectedYear,this.selectedMonth,s)])}const s=(t+e)%7,n=0==s?0:7-s;for(let t=0;t<n;t++)ue("div",this.calendarBody).addClass(`${this.cssPrefix}-day-empty`)}dateChanged(t){super.dateChanged(t),this.rerenderMonth()}}class Ne{get cssPrefix(){return"kdtp-tp"}constructor(t,e){this.slot=t,this.options=e||{}}setTime(t){this.currentTime=new Date(t)}getTime(){return new Date(this.currentTime)}timeChanged(){this.options.onTimeChanged&&this.options.onTimeChanged(this.currentTime)}}class Le extends Ne{setTime(t){super.setTime(t),this.updateDisplayedTime(),this.hoursInput.valueAsNumber=t.getHours(),this.minutesInput.valueAsNumber=t.getMinutes()}render(){ue("div",this.slot).addClass(`${this.cssPrefix}-time`).addChild("span",(t=>this.timeText=t.toDOM())).toDOM();const t=ue("div",this.slot).addClass(`${this.cssPrefix}-sliders`);return t.addChild("div",(t=>t.addClass(`${this.cssPrefix}-time-row`).title("Hours").addChild("input",(t=>this.hoursInput=t.addClass(`${this.cssPrefix}-input-hours`).type("range").attr("min","0").attr("max","23").attr("step","1").on("input",(t=>{this.currentTime.setHours(this.hoursInput.valueAsNumber),this.updateDisplayedTime(),this.timeChanged()})).toDOM())))),t.addChild("div",(t=>t.addClass(`${this.cssPrefix}-time-row`).title("Minutes").addChild("input",(t=>this.minutesInput=t.addClass(`${this.cssPrefix}-input-minutes`).type("range").attr("min","0").attr("max","59").attr("step","1").on("input",(t=>{this.currentTime.setMinutes(this.minutesInput.valueAsNumber),this.updateDisplayedTime(),this.timeChanged()})).toDOM())))),this.slot}updateDisplayedTime(){const t=Zt.getCurrentLocale(),e=this.currentTime.toLocaleString("en"==t?void 0:t,{hour:"numeric",minute:"numeric"});this.timeText.innerText=e}}class Fe extends ke{render(){const t=ue("div",document.body).addClass(`${this.cssPrefix}`).attr("tabIndex","0").setStyle("position","absolute").setStyle("top","-1000px").setStyle("left","-1000px").on("keydown",(t=>(27===t.keyCode?this.cancel():13===t.keyCode&&this.apply(this.getDateTime()),!1)));this.options.zIndex&&t.setStyle("z-index",`${this.options.zIndex}`),this.slot=t.toDOM(),super.render(),this.renderButtons(),this.globalMouseDownHandler=t=>{let e=window.event||t;return e.srcElement||e.target,!this.slot.contains(e.target)&&(document.removeEventListener("mousedown",this.globalMouseDownHandler,!0),this.cancel()),!0}}renderButtons(){const t=ue("div",this.slot).addClass(`${this.cssPrefix}-buttons`).addChild("button",(t=>this.nowButton=t.addClass(`${this.cssPrefix}-button ${this.cssPrefix}-button-now`).text(Zt.getText("ButtonNow")).on("click",(()=>(this.setDateTime(new Date),this.dateTimeChanged(),!1))).toDOM()));!this.options.showTimePicker&&this.options.oneClickDateSelection||t.addChild("button",(t=>this.submitButton=t.addClass(`${this.cssPrefix}-button ${this.cssPrefix}-button-apply`).text(Zt.getText("ButtonApply")).on("click",(()=>(this.apply(this.getDateTime()),!1))).toDOM())),t.addChild("button",(t=>this.submitButton=t.addClass(`${this.cssPrefix}-button ${this.cssPrefix}-button-cancel`).text(Zt.getText("ButtonCancel")).on("click",(()=>(this.cancel(),!1))).toDOM()))}createCalendar(t){return this.calendarSlot=ue("div",this.slot).addClass(`${this.cssPrefix}-cal`).toDOM(),new Pe(this.calendarSlot,t)}createTimePicker(t){return this.timePickerSlot=ue("div",this.slot).addClass(`${this.cssPrefix}-tp`).toDOM(),new Le(this.timePickerSlot,t)}show(t){if(this.options.showDateTimeInput){this.options.beforeShow&&this.options.beforeShow();const e=oe(t||document.body),i=oe(t?t.parentElement||t:document.body);this.slot.style.top=i.y+"px",this.slot.style.left=e.x+"px"}else super.show(t),this.slot.focus();setTimeout((()=>{document.addEventListener("mousedown",this.globalMouseDownHandler,!0)}),1)}}var $e;!function(t){t[t.Left=1]="Left",t[t.Center=2]="Center",t[t.Right=3]="Right"}($e||($e={}));const Be="kdlg";class He{openConfirm(t,e,i){const s={title:t,closable:!1,submitable:!0,cancelable:!0,body:`<div id="${Be}-dialog-confirm">${e}</div>`};return i?(s.onSubmit=()=>{i(!0)},s.onCancel=()=>{i(!1)},void this.open(s)):new Promise((t=>{s.onSubmit=()=>{t(!0)},s.onCancel=()=>{t(!1)},this.open(s)}))}openPrompt(t,e,i,s){const n={title:t,submitable:!0,closable:!0,cancelable:!0,submitOnEnter:!0,body:`<div id="${Be}-dialog-form" class="kfrm-form">\n            <div class="kfrm-fields label-above">\n                <label for="${Be}-dialog-form-input" id="${Be}-dialog-form-content">${e}</label>\n                <input type="text" name="${Be}-dialog-form-input" id="${Be}-dialog-form-input" />\n            </div>\n        </div>`,arrangeParents:!1,beforeOpen:()=>{const t=document.getElementById(`${Be}-dialog-form-input`);i&&(t.value=i),t.focus()}},a=t=>{const e=document.getElementById(`${Be}-dialog-form-input`),i=e.value;return i&&i.replace(/\s/g,"").length>0?(t(i),!0):(e.classList.add("eqjs-invalid"),!1)};return s?(n.onSubmit=()=>a(s),n.onCancel=()=>{s("")},void this.open(n)):new Promise((t=>{n.onSubmit=()=>a(t),n.onCancel=()=>{t("")},this.open(n)}))}open(t,e){const i=new _e(t,e),s=t.onDestroy;return t.onDestroy=t=>{this.untrack(t),s&&s(t)},i.open(),this.track(i),i}createSet(t){return new Ve(t,this)}untrack(t){const e=He.openDialogs.indexOf(t);e>=0&&He.openDialogs.splice(e,1)}track(t){He.openDialogs.push(t)}openProgress(t){const e=new We(t),i=t.onDestroy;return t.onDestroy=t=>{this.untrack(t),i&&i(t)},e.open(),this.track(e),e}getAllDialogs(){return Array.from(He.openDialogs)}closeAllDialogs(){for(const t of Array.from(He.openDialogs))t.close()}}He.openDialogs=[];class _e{constructor(t,e){this.options=t,this.submitHandler=t=>!(this.options.onSubmit&&!1===this.options.onSubmit(this,t)||(this.destroy(),0)),this.cancelHandler=()=>{this.options.onCancel&&this.options.onCancel(this),this.destroy()},this.keydownHandler=t=>13!=t.keyCode||!this.isActiveDialog()||(t.preventDefault(),t.stopPropagation(),!this.submitHandler())||(window.removeEventListener("keydown",this.keydownHandler,!1),!1),this.dialogId=Qt.generateId("dlg"),this.data=e,this.slot=ue("div",document.body).attr("tab-index","-1").data("dialog-id",this.dialogId).addClass(`${Be}-modal`,"is-active").focus().addChild("div",(t=>t.addClass("kdlg-modal-background"))).addChild("div",(i=>this.windowElement=i.addClass(`${Be}-modal-window`).addChild("header",(e=>{this.headerElement=e.addClass(`${Be}-header`).addChild("p",(e=>e.addClass(`${Be}-header-title`).addText(t.title))).toDOM(),!1!==t.closable&&e.addChild("button",(t=>t.addClass(`${Be}-modal-close`).on("click",(()=>{this.cancelHandler()})).focus()))})).addChild("div",(t=>{t.addClass(`${Be}-alert-container`),this.alertElement=t.toDOM()})).addChild("section",(i=>{if(this.bodyElement=i.addClass(`${Be}-body`).toDOM(),"string"==typeof t.body){const s=ee.renderLiquidTemplate(t.body,e);i.addHtml(s)}else i.addChildElement(t.body)})).addChild("footer",(e=>{let i=null;i=t.footerAlignment&&t.footerAlignment==$e.Center?"align-center":"align-right",this.footerElement=e.addClass(`${Be}-footer`).toDOM(),e.addClass(i),!1!==t.submitable&&(e.addChild("button",(e=>{e.id(this.dialogId+"-btn-submit").addClass("kfrm-button","is-info").addText(t.submitButtonText||Zt.getText("ButtonOK")),t.recaptchaSiteKey?(e.data("sitekey",t.recaptchaSiteKey),e.addClass("g-recaptcha"),e.on("click",(e=>{grecaptcha?grecaptcha.ready((()=>{grecaptcha.execute(t.recaptchaSiteKey,{action:"submit"}).then((t=>{this.submitHandler(t)}))})):this.submitHandler()}))):e.on("click",(t=>{this.submitHandler()})),e.focus()})),!1!==t.cancelable&&e.addChild("button",(e=>e.id(this.dialogId+"-btn-cancel").addClass("kfrm-button").addText(t.cancelButtonText||Zt.getText("ButtonCancel")).on("click",(t=>{this.cancelHandler()})))))})).toDOM())).toDOM()}getData(){return this.data}getRootElement(){return this.slot}getSubmitButtonElement(){return document.getElementById(this.dialogId+"-btn-submit")}getCancelButtonElement(){return document.getElementById(this.dialogId+"-btn-cancel")}open(){this.options.beforeOpen&&this.options.beforeOpen(this),ue(this.slot).show(),this.options.arrangeParents&&this.arrangeParents(!0);const t=this.slot.querySelector(`.${Be}-modal-window`);this.options.height&&(t.style.height="string"==typeof this.options.height?this.options.height:`${this.options.height}px`),this.options.width&&(t.style.width="string"==typeof this.options.width?this.options.width:`${this.options.width}px`),this.options.submitOnEnter&&window.addEventListener("keydown",this.keydownHandler,!1),this.slot.querySelectorAll("input").forEach((t=>t.addEventListener("input",(()=>{this.clearAlert(),this.options.onInput&&this.options.onInput(this)})))),this.options.onShow&&this.options.onShow(this)}submit(){this.submitHandler()}cancel(){this.cancelHandler()}close(){this.destroy()}disableButtons(){this.slot.querySelectorAll("button").forEach((t=>t.disabled=!0))}enableButtons(){this.slot.querySelectorAll("button").forEach((t=>t.disabled=!1))}showAlert(t,e,i){let s=ue("div").addClass(`${Be}-alert ${e||""}`).addChild("span",(t=>t.addClass(`${Be}-alert-closebtn`).text("×").on("click",(t=>{const e=t.target.parentElement;e.parentElement.removeChild(e)})))).addText(t).toDOM();!0===i&&this.clearAlert(),this.alertElement.appendChild(s)}clearAlert(){this.alertElement.innerHTML=""}destroy(){document.querySelectorAll(`[data-dialog-id="${this.dialogId}"]`).length<=0||(this.options.arrangeParents&&this.arrangeParents(!1),document.body.removeChild(this.slot),this.options.submitOnEnter&&window.removeEventListener("keydown",this.keydownHandler,!1),this.options.onDestroy&&this.options.onDestroy(this))}isActiveDialog(){const t=document.documentElement.querySelectorAll(".kdlg-modal");return t[t.length-1]===this.slot}arrangeParents(t){const e=document.documentElement.querySelectorAll(".kdlg-modal-window");for(let i=0;i<e.length-1;i++)if(t){const t=0==i?20:40*i+20;ue(e[i]).setStyle("margin-top",`${t}px`).setStyle("margin-left",`${t}px`)}else ue(e[i]).removeStyle("margin-top").removeStyle("margin-left")}}class We extends _e{constructor(t,e){let i,s;const n=ue("div").addChild("div",(e=>i=e.text(t.content||"").toDOM())).addChild("div",(e=>{e.addClass(`${Be}-progress-line`).addChild("div",(e=>{s=e.addClass("fill").toDOM(),t.determinated?e.setStyle("width","0%"):e.addClass("indeterminate")}))})).toDOM();super({title:t.title,body:n,beforeOpen:t.beforeOpen,onSubmit:t.onSubmit,width:t.width,height:t.height,submitable:!1,cancelable:!1,closable:!1,onDestroy:t.onDestroy},e),this.contentElement=i,this.progressElement=s}updateContent(t){this.contentElement.innerText=t}updateProgress(t){t=this.in01(t),this.progressElement.style.width=100*t+"%",1===t&&setTimeout((()=>{this.submit()}),500)}in01(t){return t>1?1:t<0?0:t}}class Ve{constructor(t,e){this.options=t,this.dialogService=e,this.currentDialog=null,this.currentIndex=0,this.options=t,this.dialogService=e}getCurrent(){return this.currentDialog}openNext(t){return this.open(this.currentIndex+1,t)}openPrev(t){return this.open(this.currentIndex-1,t)}open(t,e){if(t<0?this.currentIndex=0:t>=this.options.length?this.currentIndex=this.options.length-1:this.currentIndex=t,this.currentDialog)try{this.currentDialog.close()}catch(t){}const i=this.options[this.currentIndex];return this.currentDialog=this.dialogService.open(i,e),this.currentDialog}close(){this.currentDialog&&(this.currentDialog.close(),this.currentDialog=null)}}var Ge,Ye;Zt.updateDefaultTexts({GridPageInfo:"{FirstPageRecordNum} - {LastPageRecordNum} of {Total} records",GridItemsPerPage:"items per page",ButtonOK:"OK",ButtonCancel:"Cancel",ButtonApply:"Apply",ButtonNow:"Now",LblTotal:"Total"}),function(t){t[t.THIS_WEEK=0]="THIS_WEEK",t[t.LAST_WEEK=1]="LAST_WEEK",t[t.THIS_MONTH=2]="THIS_MONTH",t[t.FIRST_MONTH=3]="FIRST_MONTH",t[t.LAST_MONTH=4]="LAST_MONTH",t[t.THIS_YEAR=5]="THIS_YEAR",t[t.QUARTER_1=6]="QUARTER_1",t[t.QUARTER_2=7]="QUARTER_2",t[t.QUARTER_3=8]="QUARTER_3",t[t.QUARTER_4=9]="QUARTER_4"}(Ge||(Ge={})),function(t){t.UNDEF="-1",t.TODAY="1",t.YESTERDAY="2",t.TOMORROW="3",t.WEEK_START="4",t.WEEK_END="5",t.MONTH_START="6",t.MONTH_END="7",t.YEAR_START="8",t.YEAR_END="9"}(Ye||(Ye={}));const ze="yyyy-MM-dd",Ue="HH:mm",je=t=>{const e=kt.getLocaleSettings();return t==Et.Date?e.editDateFormat:t==Et.Time?e.editTimeFormat:`${e.editDateFormat} ${e.editTimeFormat}`},qe=t=>{const e=window.history.state;history.pushState(e,document.title,t),window.dispatchEvent(new Event("ed_set_location"))};class Ke{}class Je extends Ke{constructor(){super(),this.name="DateTime"}validate(t,e){if(!At.IsDefinedAndNotNull(e)||""==e)return{successed:!0};if(At.getDateDataTypes().indexOf(t.dataType)>=0)try{const i=je(t.dataType);At.strToDateTime(e,i)}catch(t){return{successed:!1,messages:[kt.getText("DateTimeError")]}}return{successed:!0}}}class Xe{constructor(t){this.context=t,this.validators=[new Je]}getHtml(){return this.html}setHtmlInt(t){this.html=t,this.errorsDiv=this.html.querySelector(".errors-block")}validate(){this.clearErrors();const t=Array.from(this.html.querySelectorAll("input, select"));let e=!0;for(const i of t){const t=this.context.getMetaData().getAttributeById(i.name);if("checkbox"===i.type)continue;const s=this.validateValue(t,i.value);if(!s.successed){e&&ue(this.errorsDiv).addChild("ul"),e=!1;for(const e of s.messages)this.errorsDiv.firstElementChild.innerHTML+=`<li>${t.caption}: ${e}</li>`}this.markInputValid(i,s.successed)}return e}getData(){return new Promise(((t,e)=>{const i=[],s=Array.from(this.html.querySelectorAll("input, select, textarea"));let n={};for(const t of s){const e=t.name.substring(t.name.lastIndexOf(".")+1),s=this.context.getMetaData().getAttributeById(t.name);"checkbox"===t.type?n[e]=t.checked:"file"===t.type?i.push(this.fileToBase64(t.files[0]).then((t=>n[e]=t))):n[e]=this.mapValue(s.dataType,t.value)}Promise.all(i).then((()=>t(n))).catch((t=>e(t)))}))}fileToBase64(t){return new Promise(((e,i)=>{const s=new FileReader;s.readAsDataURL(t),s.onload=()=>{const t=s.result.toString();e(t.substring(t.indexOf(",")+1))},s.onerror=t=>i(t)}))}useValidator(...t){this.useValidators(t)}useValidators(t){this.validators=this.validators.concat(t)}mapValue(t,e){if(At.getDateDataTypes().indexOf(t)>=0){if(t!==Et.Time&&e&&e.length){const s=je(t),n=(i=t)==Et.Date?ze:i==Et.Time?Ue:`${ze}T${Ue}`,a=At.strToDateTime(e,s);return kt.dateTimeToStr(a,n)}return e&&e.length?e:null}var i;return At.isIntType(t)?parseInt(e):At.isNumericType(t)?parseFloat(e):e}clearErrors(){this.errorsDiv.innerHTML="",this.html.querySelectorAll("input, select").forEach((t=>{t.classList.remove("is-valid"),t.classList.remove("is-invalid")}))}markInputValid(t,e){t.classList.add(e?"is-valid":"is-invalid")}validateValue(t,e){const i={successed:!0,messages:[]};for(const s of this.validators){const n=s.validate(t,e);n.successed||(i.successed=!1,i.messages=i.messages.concat(n.messages))}return i}}class Qe{constructor(t,e,i,s){this.slot=t,this.grid=e,this.filter=i,this.options={focus:!1,instantMode:!1,instantTimeout:1e3},this.options=At.assignDeep(this.options,s||{});const n=this.grid.cellRendererStore.getDefaultRendererByType(Ee.STRING);this.grid.cellRendererStore.setDefaultRenderer(Ee.STRING,((t,e,i,s)=>this.highlightCellRenderer(n,t,e,i,s)));const a=this.grid.cellRendererStore.getDefaultRendererByType(Ee.NUMBER);this.grid.cellRendererStore.setDefaultRenderer(Ee.NUMBER,((t,e,i,s)=>this.highlightCellRenderer(a,t,e,i,s))),this.render()}render(){const t=ie.IsIE()?"kfrm-fields-ie is-horizontal":"kfrm-fields is-horizontal",e=ie.IsIE()||ie.IsEdge();ue(this.slot).addClass(t).addChild("div",(t=>{t.addClass("control").addChild("input",(t=>{this.filterInput=t.toDOM(),t.attr("placeholder",kt.getText("SearchInputPlaceholder")).type("text"),t.on("keydown",this.inputKeydownHandler.bind(this)),this.options.instantMode&&t.on("keyup",this.inputKeyupHandler.bind(this))})),e||t.addClass("has-icons-right").addChild("span",(t=>{t.addClass("icon").addClass("is-right").addClass("is-clickable").html("&#x1F5D9;").on("click",this.clearButtonClickHander.bind(this))}))})),this.options.instantMode||ue(this.slot).addChild("button",(t=>t.addClass("kfrm-button").addText(kt.getText("SearchBtn")).on("click",this.searchButtonClickHandler.bind(this)))),this.options.focus&&this.filterInput.focus()}inputKeydownHandler(t){13==t.keyCode&&this.applyFilter(!0)}inputKeyupHandler(){this.applyFilterTimeout&&clearTimeout(this.applyFilterTimeout),this.applyFilterTimeout=setTimeout((()=>{this.applyFilter(!0)}),this.options.instantTimeout)}clearButtonClickHander(){this.filterInput.value="",this.filterInput.focus(),this.applyFilter(!0)}searchButtonClickHandler(){this.applyFilter(!0)}applyFilter(t){this.applyFilterTimeout&&clearTimeout(this.applyFilterTimeout);const e=this.filter.getValue();return!(t&&e==this.filterInput.value||(this.filter.apply(this.filterInput.value).then((t=>{this.grid.setData(t)})),0))}highlightCellRenderer(t,e,i,s,n){if((At.isNumericType(i.type)||At.getStringDataTypes().indexOf(i.type)>=0)&&e){e=i.dataColumn&&i.dataColumn.displayFormat&&be.test(i.dataColumn.displayFormat)?i.dataColumn.displayFormat.replace(be,((t,i)=>kt.numberToStr(e,i))):e.toLocaleString();const t=this.highlightText(e.toString());if(t instanceof HTMLElement)return s.title=e,void s.appendChild(t)}t(e,i,s,n)}highlightText(t){const e=t.toLowerCase(),i=this.filter.getValue().toString();if(i&&i.length>0&&t&&t.length>0){const s=[],n=i.split("||").map((t=>t.trim().toLowerCase()));for(let i=0;i<n.length;i++){let a=0;const o=n[i];if(o.length){if(o===e){const e=document.createElement("span");return e.style.backgroundColor="yellow",e.innerText=t,e}for(;a<t.length-1;){const t=e.indexOf(o,a);t>=0?(s.push({index:t,length:n[i].length}),a=t+o.length):a++}}}if(s.length>0){s.sort(((t,e)=>t.index>e.index?1:t.index==e.index2?0:-1));for(let t=0;t<s.length-1;){const e=s[t+1].index-(s[t].index+s[t].length);if(e<0){const i=s[t+1].length+e;i>0&&(s[t].length+=i),s.splice(t+1,1)}else t++}const e=document.createElement("div");for(let i=0;i<s.length;i++){if(0===i){const n=document.createTextNode(t.substring(0,s[i].index));e.appendChild(n)}const n=document.createElement("span");n.style.backgroundColor="yellow",n.innerText=t.substring(s[i].index,s[i].index+s[i].length),e.appendChild(n);const a=i<s.length-1?document.createTextNode(t.substring(s[i].index+s[i].length,s[i+1].index)):document.createTextNode(t.substring(s[i].index+s[i].length));e.appendChild(a)}return e}}return t}}const Ze=ie.IsIE();class ti{constructor(t,e){this.context=t,this.params=e,this.params=e||{},this.reset()}reset(){this.form=new Xe(this.context)}setupLookupField(t,e,i,s){const n=this.context.getMetaData().getRootEntity().subEntities.filter((t=>t.id==e.lookupEntity))[0],a=this.context.getMetaData().getAttributeById(e.dataAttr);if(!a)return;i=i||!a.isEditable,s=this.params.values?this.params.values.getValue(a.id):void 0;const o=Ze?"kfrm-fields-ie is-horizontal":"kfrm-fields is-horizontal";let r;ue(t).addChild("div",(t=>{t.addClass(o).addChild("input",(t=>{r=t.toDOM(),t.attr("readonly",""),t.name(a.id),t.type(this.resolveInputType(a.dataType)),t.value(At.IsDefinedAndNotNull(s)?s.toString():"")})),i||t.addChild("button",(t=>t.addClass("kfrm-button").attr("title",kt.getText("NavigationBtnTitle")).addText("...").on("click",(i=>{const s=new Ut({loader:{loadChunk:t=>this.context.getDataLoader().loadChunk(Object.assign(Object.assign({},t),{id:n.id}))}});this.context.getDataLoader().loadChunk({offset:0,limit:1e3,needTotal:!0,sourceId:n.id}).then((i=>{for(const t of i.table.columns.getItems()){n.attributes.filter((e=>e.id==t.id&&(e.isPrimaryKey||e.showInLookup))).length&&s.columns.add(t)}s.setTotal(i.total);for(const t of i.table.getCachedRows())s.addRow(t);const a=new He;let o,l=null,h=null;const d=ue("div").addClass("kfrm-form").addChild("div",(t=>t.addClass("kfrm-field").addChild("label",(t=>t.addText(kt.getText("LookupSelectedItem")).toDOM())).addChild("div",(t=>h=t.addText("None").toDOM())))).addChild("div",(t=>o=t.toDOM())).addChild("div",(t=>t.addClass("kfrm-control").addChild("div",(t=>l=t.toDOM())))).toDOM();let c=r.value;const u=t=>{h.innerHTML=s.columns.getItems().map((e=>`<b>${e.label}:</b> ${((t,e)=>t instanceof zt?t.getValue(e):t[e.substring(e.lastIndexOf(".")+1)])(t,e.id)}`)).join(", ")};if(c){const t=n.getFirstPrimaryAttr(),e=t.id.substring(t.id.lastIndexOf(".")+1);this.context.fetchRecord({[e]:c},n.id).then((t=>{t.entity&&u(t.entity)})).catch((t=>{console.error(t)}))}const g=new Oe({slot:l,dataTable:s,fixHeightOnFirstRender:!0,paging:{pageSize:10},onActiveRowChanged:t=>{g.getData().getRow(t.rowIndex).then((t=>{c=t.getValue(e.lookupDataAttr),u(t)}))}});a.open({title:kt.getText("LookupDlgCaption").replace("{entity}",n.caption),body:d,arrangeParents:!0,beforeOpen:()=>{const t=this.context.createFilter(n.id,g.getData(),!0);new Qe(o,g,t,{instantMode:!0,focus:!0})},onSubmit:()=>(r.value=c,!0),onDestroy:()=>{g.destroy(),t.toDOM().focus()}})}))}))))}))}setupDateTimeField(t,e,i,s,n){const a=Ze?"kfrm-fields-ie is-horizontal":"kfrm-fields is-horizontal",o=je(e.dataType);let r;const l=o.replace("yyyy","9999").replace("MM","99").replace("dd","99").replace("HH","99").replace("mm","99").replace("ss","99");ue(t).addChild("div",(t=>{t.addClass(a).addChild("input",(t=>{r=t.toDOM(),t.name(e.id),t.type(n?"hidden":this.resolveInputType(e.dataType)),s?t.attr("readonly",""):(t.mask(l),t.on("keypress",(t=>this.applySumbit(t))).on("input",(e=>{t.removeClass("is-invalid");try{At.strToDateTime(r.value,o)}catch(e){t.addClass("is-invalid")}})).on("blur",(t=>{r.value===l.replace(/[9]/g,"_")&&(r.value="")}))),t.value(At.IsDefinedAndNotNull(i)?kt.dateTimeToStr(i,o):"")})),s||t.addChild("button",(t=>t.addClass("kfrm-button").attr("title",kt.getText(e.dataType!==Et.Time?"CalendarBtnTitle":"TimerBtnTitle")).addChild("i",(t=>t.addClass(e.dataType!==Et.Time?"ed-calendar-icon":"ed-timer-icon"))).on("click",(t=>{let i;try{i=r.value.length?e.dataType!==Et.Time?At.strToDateTime(r.value,o):At.strToTime(r.value):new Date((new Date).setSeconds(0))}catch(t){i=new Date((new Date).setSeconds(0))}const s={zIndex:9999999999,showCalendar:e.dataType!==Et.Time,showTimePicker:e.dataType!==Et.Date,onApply:t=>{t.setSeconds(0),t.setMilliseconds(0),r.value=kt.dateTimeToStr(t,o)}},n=new Fe(s);n.setDateTime(i),n.show(t.target)})).toDOM()))}))}setupListField(t,e,i,s,n){ue(t).addChild("div",(t=>t.addClass("kfrm-select full-width").addChild("select",(t=>{if(n&&t.attr("readonly",""),t.attr("name",e.id),t.on("keypress",(t=>this.applySumbit(t))),s)for(let e=0;e<s.length;e++){const i=s[e];t.addOption({value:i.id,title:i.text,selected:0===e})}t.value(i)}))))}setupFileField(t,e,i,s){ue(t).addChild("input",(t=>{i&&t.attr("readonly",""),t.name(e.id).type(this.resolveInputType(e.dataType)),t.attr("accept",s)}))}setupTextField(t,e,i,s,n){ue(t).addChild("input",(t=>{s&&t.attr("readonly",""),t.type(n?"hidden":this.resolveInputType(e.dataType)),t.name(e.id).type(this.resolveInputType(e.dataType)),e.dataType==Et.Bool?i&&t.attr("checked",""):t.on("keypress",(t=>this.applySumbit(t))).value(At.IsDefinedAndNotNull(i)?i.toString():"")}))}setupTextArea(t,e,i,s){ue(t).addChild("textarea",(t=>{s&&t.attr("readonly",""),t.attr("name",e.id),t.setStyle("height","120px"),t.value(At.IsDefinedAndNotNull(i)?i.toString():"")}))}addFormField(t,e){const i=this.params.values&&e.kind!==xt.Lookup?this.params.values.getValue(e.id):this.params.isEditForm?void 0:e.defaultValue,s=this.resolveEditor(e),n=this.params.isEditForm&&(e.isPrimaryKey||!e.isEditable),a=!e.isNullable;Ze&&(t=ue("div",t).addClass("kfrm-field-ie").toDOM()),ue(t).addChild("label",(t=>{t.attr("for",e.id),t.addHtml(`${e.caption} ${a?'<sup style="color: red">*</sup>':""}: `),e.description&&t.addChild("div",(t=>t.attr("title",e.description).addClass("question-mark").setStyle("vertical-align","middle").setStyle("display","inline-block")))}));const o=e.isPrimaryKey;if(e.kind!==xt.Lookup)switch(s.tag){case Rt:this.setupDateTimeField(t,e,i,n,o);break;case"LIST":this.setupListField(t,e,i,s.values,n);break;case"FILE":this.setupFileField(t,e,n,s.accept);break;default:s.multiline?this.setupTextArea(t,e,i,n):this.setupTextField(t,e,i,n,o)}else this.setupLookupField(t,e,n,i)}resolveInputType(t){return t===Et.Bool?"checkbox":t===Et.Blob?"file":"text"}resolveEditor(t){let e=t.defaultEditor||new Wt;return e.tag==St&&(At.getDateDataTypes().indexOf(t.dataType)>=0?e.tag=Rt:e.tag=Mt),e}applySumbit(t){return 13===t.keyCode&&(this.sumbitCallback&&this.sumbitCallback(),!1)}onSubmit(t){return this.sumbitCallback=t,this}build(){let t;const e=ue("div").addClass("kfrm-form").addChild("div",(t=>t.addClass("errors-block").toDOM())).addChild("div",(e=>{e.addClass(Ze?"kfrm-fields-ie col-ie-1-4 label-align-right":"kfrm-fields col-a-1 label-align-right"),t=e})).toDOM();this.form.setHtmlInt(e);for(const e of this.context.getActiveEntity().attributes)(this.params.isEditForm||e.showOnCreate)&&(e.isPrimaryKey||!this.params.isEditForm||e.showOnEdit)&&this.addFormField(t.toDOM(),e);return this.form}}class ei{constructor(t){this.slot=t,this.hide(),this.slot.classList.add("ed-progress-bar")}show(){this.slot.style.removeProperty("display")}hide(){this.slot.style.display="none"}}class ii{constructor(t){this.context=t}loadChunk(t){const e=this.context.resolveEndpoint("FetchDataset",{sourceId:t.sourceId||this.context.getActiveEntity().id});return delete t.sourceId,this.context.startProcess(),this.context.getHttpClient().post(e,t).then((e=>{const i=new Ut({chunkSize:1e3}),s=e.resultSet;for(const t of s.cols)i.columns.add(t);for(const t of s.rows)i.addRow(t);let n=0;return e.meta&&e.meta.totalRecords&&(n=e.meta.totalRecords),{table:i,total:n,hasNext:!t.needTotal||t.offset+t.limit<n}})).finally((()=>{this.context.endProcess()}))}}class si{constructor(t){this.endpoints=new Map,this.endpointVarsRegex=/\{.*?\}/g,this.options=t||{},this.http=new Bt,this.model=new Vt,this.model.id=t.metaDataId||"__default",this.dataLoader=new ii(this);const e=Object.assign({loader:this.dataLoader},t.dataTable);this.data=new Ut(e),this.setDefaultEndpoints(this.options.endpoint||"/api/easydata")}getActiveEntity(){return this.activeEntity}setActiveSource(t){this.activeEntity=this.model.getRootEntity().subEntities.filter((e=>e.id==t))[0]}getMetaData(){return this.model}getData(){return this.data}getDataLoader(){return this.dataLoader}createFilter(t,e,i){return new qt(this.dataLoader,e||this.getData(),t||this.activeEntity.id,i)}loadMetaData(){const t=this.resolveEndpoint("GetMetaData");return this.startProcess(),this.http.get(t).then((t=>(t.model&&this.model.loadFromData(t.model),this.model))).catch((t=>(console.error(`Error: ${t.message}. Source: ${t.sourceError}`),null))).finally((()=>{this.endProcess()}))}getHttpClient(){return this.http}fetchDataset(){return this.data.clear(),this.dataLoader.loadChunk({offset:0,limit:this.data.chunkSize,needTotal:!0}).then((t=>{for(const e of t.table.columns.getItems())this.data.columns.add(e);this.data.setTotal(t.total);for(const e of t.table.getCachedRows())this.data.addRow(e);return this.data}))}fetchRecord(t,e){const i=this.resolveEndpoint("FetchRecord",{sourceId:e||this.activeEntity.id});return this.startProcess(),this.http.get(i,{queryParams:t}).finally((()=>this.endProcess()))}createRecord(t,e){const i=this.resolveEndpoint("CreateRecord",{sourceId:e||this.activeEntity.id});return this.startProcess(),this.http.post(i,t,{dataType:"json"}).finally((()=>this.endProcess()))}updateRecord(t,e){const i=this.resolveEndpoint("UpdateRecord",{sourceId:e||this.activeEntity.id});return this.startProcess(),this.http.post(i,t,{dataType:"json"}).finally((()=>this.endProcess()))}deleteRecord(t,e){const i=this.resolveEndpoint("DeleteRecord",{sourceId:e||this.activeEntity.id});return this.startProcess(),this.http.post(i,t,{dataType:"json"}).finally((()=>this.endProcess()))}setEndpoint(t,e){this.endpoints.set(t,e)}setEnpointIfNotExist(t,e){this.endpoints.has(t)||this.endpoints.set(t,e)}resolveEndpoint(t,e){e=e||{};let i=this.endpoints.get(t);if(!i)throw t+" endpoint is not defined";let s=i.match(this.endpointVarsRegex);if(s)for(let t of s){let s=t.substring(1,t.length-1),n=e[s];if(!n)if("modelId"==s)n=this.model.getId();else{if("sourceId"!=s)throw`Parameter [${s}] is not defined`;n=this.activeEntity.id}i=i.replace(t,n)}return i}startProcess(){this.options.onProcessStart&&this.options.onProcessStart()}endProcess(){this.options.onProcessEnd&&this.options.onProcessEnd()}setDefaultEndpoints(t){this.setEnpointIfNotExist("GetMetaData",jt(t,"models/{modelId}")),this.setEnpointIfNotExist("FetchDataset",jt(t,"models/{modelId}/sources/{sourceId}/fetch")),this.setEnpointIfNotExist("FetchRecord",jt(t,"models/{modelId}/sources/{sourceId}/fetch")),this.setEnpointIfNotExist("CreateRecord",jt(t,"models/{modelId}/sources/{sourceId}/create")),this.setEnpointIfNotExist("UpdateRecord",jt(t,"models/{modelId}/sources/{sourceId}/update")),this.setEnpointIfNotExist("DeleteRecord",jt(t,"models/{modelId}/sources/{sourceId}/delete"))}}class ni extends Ke{constructor(){super(),this.name="Type"}validate(t,e){if(!At.IsDefinedAndNotNull(e)||""==e)return{successed:!0};if(At.isNumericType(t.dataType)){if(!At.isNumeric(e))return{successed:!1,messages:[kt.getText("NumberError")]};if(At.isIntType(t.dataType)&&!Number.isInteger(Number.parseFloat(e)))return{successed:!1,messages:[kt.getText("IntNumberError")]}}return{successed:!0}}}class ai extends Ke{constructor(){super(),this.name="Required"}validate(t,e){return t.isNullable||At.IsDefinedAndNotNull(e)&&""!==e?{successed:!0}:{successed:!1,messages:[kt.getText("RequiredError")]}}}class oi{constructor(t,e,i,s){this.slot=t,this.context=e,this.basePath=i,this.options={showFilterBox:!0,showBackToEntities:!0},this.defaultValidators=[new ai,new ni],this.options=At.assignDeep(this.options,s||{}),this.dlg=new He;const n=this.context.getActiveEntity();if(!n)throw"Can't find active entity for "+window.location.pathname;this.slot.innerHTML+=`<h1>${n.captionPlural||n.caption}</h1>`,this.options.showBackToEntities&&ue(this.slot).addChild("a",(t=>t.attr("href","javascript:void(0)").text(`← ${kt.getText("BackToEntities")}`).on("click",(t=>{t.preventDefault(),qe(this.basePath)})))),this.renderGrid()}syncGridColumnHandler(t){if(t.dataColumn){const e=this.context.getMetaData().getAttributeById(t.dataColumn.id);e&&(t.isVisible=e.showOnView)}}renderGrid(){this.context.fetchDataset().then((t=>{const e=document.createElement("div");if(this.slot.appendChild(e),e.id="Grid",this.grid=new Oe(At.assignDeep({slot:e,dataTable:t,paging:{pageSize:15,allowPageSizeChange:!0,pageSizeItems:[15,30,50,100,200]},showPlusButton:this.context.getActiveEntity().isEditable,plusButtonTitle:kt.getText("AddRecordBtnTitle"),showActiveRow:!1,onPlusButtonClick:this.addClickHandler.bind(this),onGetCellRenderer:this.manageCellRenderer.bind(this),onRowDbClick:this.rowDbClickHandler.bind(this),onSyncGridColumn:this.syncGridColumnHandler.bind(this)},this.options.grid||{})),this.options.showFilterBox){let t;const i=ue("div").addClass("kfrm-form").setStyle("margin","10px 0px").addChild("div",(e=>t=e.toDOM())).toDOM();this.slot.insertBefore(i,e);const s=this.context.createFilter();this.filterWidget=new Qe(t,this.grid,s)}}))}manageCellRenderer(t,e){if(t.isRowNum)return t.width=110,(t,e,i,s)=>{const n=ue("div",i).addClass("keg-cell-value");this.context.getActiveEntity().isEditable&&n.addChild("a",(t=>t.attr("href","javascript:void(0)").text(kt.getText("EditBtn")).on("click",(t=>this.editClickHandler(t,parseInt(s.getAttribute("data-row-idx"))))))).addChild("span",(t=>t.text(" | "))).addChild("a",(t=>t.attr("href","javascript:void(0)").text(kt.getText("DeleteBtn")).on("click",(t=>this.deleteClickHandler(t,parseInt(s.getAttribute("data-row-idx")))))))}}addClickHandler(){const t=this.context.getActiveEntity(),e=new ti(this.context).onSubmit((()=>i.submit())).build();e.useValidators(this.defaultValidators);const i=this.dlg.open({title:kt.getText("AddDlgCaption").replace("{entity}",t.caption),body:e.getHtml(),onSubmit:()=>{if(!e.validate())return!1;e.getData().then((t=>this.context.createRecord(t))).then((()=>this.refreshData())).catch((t=>{this.processError(t)}))}})}editClickHandler(t,e){this.grid.getData().getRow(e).then((t=>{t&&this.showEditForm(t)}))}showEditForm(t){const e=this.context.getActiveEntity(),i=new ti(this.context,{isEditForm:!0,values:t}).onSubmit((()=>s.submit())).build();i.useValidators(this.defaultValidators);const s=this.dlg.open({title:kt.getText("EditDlgCaption").replace("{entity}",e.caption),body:i.getHtml(),onSubmit:()=>{if(!i.validate())return!1;i.getData().then((t=>this.context.updateRecord(t))).then((()=>this.refreshData())).catch((t=>{this.processError(t)}))}})}rowDbClickHandler(t){this.context.getActiveEntity().isEditable&&this.showEditForm(t.row)}deleteClickHandler(t,e){this.grid.getData().getRow(e).then((t=>{if(t){const e=this.context.getActiveEntity(),i=e.getPrimaryAttrs(),s=i.map((e=>t.getValue(e.id))),n=i.reduce(((t,e,i)=>(t[e.id.substring(e.id.lastIndexOf(".")+1)]=s[i],t)),{});this.dlg.openConfirm(kt.getText("DeleteDlgCaption").replace("{entity}",e.caption),kt.getText("DeleteDlgMessage").replace("{recordId}",Object.keys(n).map((t=>`${t}:${n[t]}`)).join(";"))).then((t=>{t&&this.context.deleteRecord(n).then((()=>this.refreshData())).catch((t=>{this.processError(t)}))}))}}))}processError(t){this.dlg.open({title:"Ooops, something went wrong",body:t.message,closable:!0,cancelable:!1})}refreshData(){return this.context.fetchDataset().then((()=>{let t=!1;this.filterWidget&&(t=this.filterWidget.applyFilter(!1)),t||this.grid.refresh()}))}}class ri{constructor(t,e,i){this.slot=t,this.context=e,this.basePath=i,this.metaData=this.context.getMetaData(),this.slot.innerHTML+=`<h1>${kt.getText("RootViewTitle")}</h1>`,this.renderEntitySelector()}renderEntitySelector(){const t=this.metaData.getRootEntity().subEntities;this.slot&&ue(this.slot).addChild("div",(e=>e.addClass("ed-root").addChild("div",(t=>t.addClass("ed-menu-description").addText(kt.getText(this.metaData.isEmpty()?"ModelIsEmpty":"EntityMenuDesc")))).addChild("ul",(e=>{e.addClass("ed-entity-menu"),t.forEach((t=>{e.addChild("li",(e=>{e.addClass("ed-entity-item").on("click",(()=>{qe(`${this.basePath}/${decodeURIComponent(t.id)}`)})).addChild("div",(e=>{e.addClass("ed-entity-item-caption").addText(t.captionPlural||t.caption)})),t.description&&e.addChild("div",(e=>{e.addClass("ed-entity-item-descr").addText(`${t.description}`)}))}))}))}))))}}kt.updateDefaultTexts({RequiredError:"Value is required.",NumberError:"Value should be a number",IntNumberError:"Value should be an integer number",DateTimeError:"Invalid date or time value",LookupSelectedItem:"Selected item: ",LookupDlgCaption:"Select {entity}",None:"None",NavigationBtnTitle:"Navigation values",CalendarBtnTitle:"Open calendar",TimerBtnTitle:"Open timer",AddBtnTitle:"Add",AddRecordBtnTitle:"Add record",EditBtn:"Edit",DeleteBtn:"Delete",SelectLink:"[ select ]",AddDlgCaption:"Create {entity}",EditDlgCaption:"Edit {entity}",DeleteDlgCaption:"Delete {entity}",DeleteDlgMessage:"Are you sure you want to remove this record: {{recordId}}?",EntityMenuDesc:"Click on an entity to view/edit its content",BackToEntities:"Back to entities",SearchBtn:"Search",SearchInputPlaceholder:"Search...",RootViewTitle:"Entities",ModelIsEmpty:"No entity was found."});var li=Object.freeze({__proto__:null,DataContext:si,EasyDataServerLoader:ii,EasyDataViewDispatcher:class{constructor(t){this.options={container:"#EasyDataContainer",basePath:"easydata"},this.onSetLocation=()=>{this.setActiveView()},this.attach=()=>{window.addEventListener("ed_set_location",this.onSetLocation),window.addEventListener("popstate",this.onSetLocation)},this.options=At.assign(this.options,t||{}),this.options.rootEntity?(this.options.showBackToEntities=!1,this.basePath="/"):this.basePath=this.normalizeBasePath(this.options.basePath),this.setContainer(this.options.container);const e=document.createElement("div"),i=new ei(e),s=this.container.parentElement;s.insertBefore(e,s.firstElementChild),this.context=new si({endpoint:this.options.endpoint,dataTable:this.options.dataTable,onProcessStart:()=>i.show(),onProcessEnd:()=>i.hide()})}normalizeBasePath(t){t=this.trimSlashes(t);const e=decodeURIComponent(window.location.pathname),i=e.toLocaleLowerCase().indexOf(t);return i>=0?e.substring(0,i+t.length):"/"}trimSlashes(t){return t.replace(/^\/|\/$/g,"")}setContainer(t){if(!t)throw"Container is undefined";if("string"==typeof t){if(t.length){if("."===t[0]){const e=document.getElementsByClassName(t.substring(1));e.length&&(this.container=e[0])}else"#"===t[0]&&(t=t.substring(1)),this.container=document.getElementById(t);if(!this.container)throw Error("Unrecognized `container` parameter: "+t+"\nIt must be an element ID, a class name (starting with .) or an HTMLElement object itself.")}}else this.container=t}getActiveSourceId(){if(this.options.rootEntity)return this.options.rootEntity;const t=decodeURIComponent(window.location.pathname),e=this.basePath.length+1;return e<t.length?t.substring(e):null}run(){return this.attach(),this.context.loadMetaData().then((()=>{this.setActiveView()})).catch((t=>console.error(t)))}setActiveView(){this.clear();const t=this.getActiveSourceId();t?(this.context.setActiveSource(t),window.EDView=new oi(this.container,this.context,this.basePath,this.options)):window.EDView=new ri(this.container,this.context,this.basePath)}clear(){this.container.innerHTML="",this.context.getData().clear()}detach(){window.removeEventListener("ed_set_location",this.onSetLocation),window.removeEventListener("popstate",this.onSetLocation)}},EntityDataView:oi,EntityEditForm:Xe,EntityEditFormBuilder:ti,ProgressBar:ei,RequiredValidator:ai,RootDataView:ri,TextDataFilter:qt,TextFilterWidget:Qe,TypeValidator:ni,Validator:Ke});return t.core=R,t.crud=li,t.ui=It,t}({});
//# sourceMappingURL=easydata.min.js.map
